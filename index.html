<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¹ä¸ç”Ÿå­˜ - å¡ç‰Œç”Ÿå­˜æ¸¸æˆ</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- GSAP åŠ¨ç”»åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <!-- Tailwind é…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2D3748',
            secondary: '#4A5568',
            accent: '#805AD5',
            neutral: '#F7FAFC',
            'neutral-dark': '#2D3748',
            'ink-light': '#E2E8F0',
            'ink-medium': '#A0AEC0',
            'ink-dark': '#2D3748',
            'paper': '#F7FAFC',
            'paper-dark': '#1A202C',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            serif: ['"Noto Serif SC"', 'serif'],
          },
          boxShadow: {
            'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
          },
          animation: {
            'float': 'float 3s ease-in-out infinite',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            }
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow {
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
      }
      .card-border {
        border-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><path d="M0 0h4v4H0z" fill="none" stroke="%23A0AEC0" stroke-width="1"/></svg>') 1 repeat;
      }
      .ink-splash {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><circle cx="50" cy="50" r="40" fill="rgba(160, 174, 192, 0.1)"/></svg>');
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
      }
      .scroll-bg {
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M0 0h20v20H0z" fill="none" stroke="%23A0AEC0" stroke-width="1" stroke-dasharray="2,2"/></svg>');
        background-repeat: repeat;
      }
      .card-drag {
        cursor: grab;
      }
      .card-drag:active {
        cursor: grabbing;
      }
      .card-stack {
        position: relative;
      }
      .card-stack > div {
        position: absolute;
        transition: all 0.3s ease;
      }
      .card-stack > div:nth-child(1) { transform: translate(0, 0) rotate(0deg); z-index: 1; }
      .card-stack > div:nth-child(2) { transform: translate(8px, 8px) rotate(2deg); z-index: 2; }
      .card-stack > div:nth-child(3) { transform: translate(16px, 16px) rotate(4deg); z-index: 3; }
      .card-stack > div:nth-child(4) { transform: translate(24px, 24px) rotate(6deg); z-index: 4; }
      .card-stack > div:nth-child(5) { transform: translate(32px, 32px) rotate(8deg); z-index: 5; }
      .card-stack > div:nth-child(n+6) { transform: translate(40px, 40px) rotate(10deg); z-index: 6; }
    }
  </style>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Serif+SC:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', 'Noto Serif SC', sans-serif;
      background-color: #F7FAFC;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="%23E2E8F0" stroke-width="0.5" stroke-dasharray="5,5"/></svg>');
      background-repeat: repeat;
    }
    
    .card {
      transition: all 0.3s ease;
      border-radius: 0.5rem;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .card.resource {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
    }
    
    .card.location {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
    }
    
    .location-details {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.75rem;
    }
    
    .resource-type, .danger-level, .action-cost {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .danger-level.low {
      color: #38A169;
    }
    
    .danger-level.medium {
      color: #ECC94B;
    }
    
    .danger-level.high {
      color: #E53E3E;
    }
    
    .location-card.current {
      border-color: #38A169;
      box-shadow: 0 0 15px rgba(56, 161, 105, 0.5);
    }
    
    .card.status {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
    }
    
    .card.action {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
    }
    
    .card-image {
      width: 100%;
      height: 120px;
      object-fit: cover;
      background-color: #E2E8F0;
    }
    
    .location-card .card-image {
      height: 80px;
    }
    
    .card-content {
      padding: 0.75rem;
    }
    
    .card-title {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 0.25rem;
    }
    
    /* èµ„æºå¡ç‰Œç‰¹å®šæ ·å¼ - ç¼©å°å°ºå¯¸ä»¥é€‚åº”æ›´å¤šå¡ç‰Œ */
    .resource-card {
      width: 100px;
    }
    
    .resource-card .card-image {
      height: 80px;
    }
    
    .resource-card .card-title {
      font-size: 0.875rem;
    }
    
    .card-description {
      font-size: 0.75rem;
      color: #4A5568;
    }
    
    .card-footer {
      padding: 0.5rem 0.75rem;
      border-top: 1px solid #E2E8F0;
      font-size: 0.75rem;
      color: #4A5568;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .resource-count {
      background-color: #E2E8F0;
      border-radius: 9999px;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .progress-bar {
      height: 4px;
      background-color: #E2E8F0;
      border-radius: 9999px;
      overflow: hidden;
    }
    
    .progress-bar-fill {
      height: 100%;
      background-color: #805AD5;
      border-radius: 9999px;
      transition: width 0.3s ease;
    }
    
    .location-card {
      cursor: pointer;
    }
    
    .resource-card {
      cursor: grab;
    }
    
    .resource-card:active {
      cursor: grabbing;
    }
    
    .status-card {
      cursor: default;
    }
    
    .action-card {
      cursor: pointer;
    }
    
    .dragging {
      opacity: 0.8;
      transform: scale(1.05);
      z-index: 100;
    }
    
    .dropzone {
      border: 2px dashed #E2E8F0;
      border-radius: 0.5rem;
      padding: 1rem;
      min-height: 100px;
      transition: all 0.3s ease;
    }
    
    .dropzone.active {
      border-color: #805AD5;
      background-color: rgba(128, 90, 213, 0.05);
    }
    
    .game-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      margin-bottom: 1rem;
      border-bottom: 1px solid #E2E8F0;
    }
    
    .header-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2D3748;
    }
    
    .header-info {
      display: flex;
      gap: 1rem;
    }
    
    .info-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #4A5568;
    }
    
    .info-item-value {
      font-weight: 600;
      color: #2D3748;
    }
    
    .main-content {
      display: grid;
      grid-template-columns: 1fr 3fr;
      gap: 1rem;
    }
    
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .sidebar-section {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      padding: 1rem;
    }
    
    .sidebar-section-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #2D3748;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }
    
    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.5rem;
      padding: 0.5rem;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .main-area {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .location-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
    }
    
    .action-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
    
    .combination-area {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      padding: 1rem;
      min-height: 200px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .combination-title {
      font-size: 1rem;
      font-weight: 600;
      color: #2D3748;
    }
    
    .combination-slots {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    
    .combination-slot {
      width: 100px;
      height: 140px;
      border: 2px dashed #E2E8F0;
      border-radius: 0.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    .combination-slot.active {
      border-color: #805AD5;
      background-color: rgba(128, 90, 213, 0.05);
    }
    
    /* ç»„åˆæ§½ä¸­çš„å¡ç‰Œæ ·å¼ */
    .combination-card {
      width: 90px;
      height: 130px;
      cursor: grab;
    }
    
    .combination-card:active {
      cursor: grabbing;
    }
    
    .combination-card .card-image {
      height: 70px;
    }
    
    .combination-card .card-title {
      font-size: 0.75rem;
      text-align: center;
    }
    
    .combination-result {
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .combination-button {
      background-color: #805AD5;
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .combination-button:hover {
      background-color: #6B46C1;
    }
    
    .combination-button:disabled {
      background-color: #A0AEC0;
      cursor: not-allowed;
    }
    
    .event-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .event-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .event-modal-content {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      max-width: 500px;
      width: 90%;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .event-modal.active .event-modal-content {
      transform: translateY(0);
    }
    
    .event-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .event-modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #2D3748;
    }
    
    .event-modal-close {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: #4A5568;
    }
    
    .event-modal-body {
      margin-bottom: 1.5rem;
    }
    
    .event-modal-text {
      margin-bottom: 1rem;
      color: #2D3748;
    }
    
    .event-modal-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .event-modal-option {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      padding: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .event-modal-option:hover {
      background-color: #EDF2F7;
      border-color: #CBD5E0;
    }
    
    .event-modal-option-text {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #2D3748;
    }
    
    .event-modal-option-description {
      font-size: 0.75rem;
      color: #4A5568;
    }
    
    .tooltip {
      position: relative;
      display: inline-block;
    }
    
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 200px;
      background-color: #2D3748;
      color: #fff;
      text-align: center;
      border-radius: 0.25rem;
      padding: 0.5rem;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.75rem;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    .season-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: #4A5568;
    }
    
    .season-icon {
      font-size: 1rem;
    }
    
    .day-indicator {
      font-size: 0.875rem;
      color: #4A5568;
    }
    
    .day-number {
      font-weight: 600;
      color: #2D3748;
    }
    
    .notification {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      max-width: 300px;
    }
    
    .notification.active {
      transform: translateY(0);
      opacity: 1;
    }
    
    .notification-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #2D3748;
    }
    
    .notification-message {
      font-size: 0.875rem;
      color: #4A5568;
    }
    
    .notification-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      font-size: 0.875rem;
      cursor: pointer;
      color: #4A5568;
    }
    
    .recipe-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .recipe-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .recipe-modal-content {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .recipe-modal.active .recipe-modal-content {
      transform: translateY(0);
    }
    
    .recipe-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .recipe-modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #2D3748;
    }
    
    .recipe-modal-close {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: #4A5568;
    }
    
    .recipe-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }
    
    .recipe-card {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      padding: 1rem;
      transition: all 0.3s ease;
    }
    
    .recipe-card:hover {
      background-color: #EDF2F7;
      border-color: #CBD5E0;
    }
    
    .recipe-card-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2D3748;
    }
    
    .recipe-card-ingredients {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .recipe-card-ingredient {
      background-color: #EDF2F7;
      border-radius: 9999px;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      color: #4A5568;
    }
    
    .recipe-card-description {
      font-size: 0.75rem;
      color: #4A5568;
    }
    
    .recipe-card-discovered {
      font-size: 0.75rem;
      color: #805AD5;
      font-weight: 600;
    }
    
    .recipe-card-undiscovered {
      font-size: 0.75rem;
      color: #A0AEC0;
    }
    
    /* äº‹ä»¶ç»“æœæ¨¡æ€æ¡†æ ·å¼ */
    .event-result-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .event-result-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .event-result-modal.closing {
      opacity: 0;
    }
    
    .event-result-modal-content {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      max-width: 500px;
      width: 90%;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .event-result-modal.active .event-result-modal-content {
      transform: translateY(0);
    }
    
    .event-result-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .event-result-modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #2D3748;
    }
    
    .event-result-modal-close {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: #4A5568;
      transition: all 0.3s ease;
    }
    
    .event-result-modal-close:hover {
      color: #2D3748;
    }
    
    .event-result-modal-body {
      margin-bottom: 1rem;
    }
    
    .event-result-section {
      margin-bottom: 1rem;
    }
    
    .event-result-section:last-child {
      margin-bottom: 0;
    }
    
    .event-result-list {
      margin-top: 0.5rem;
      padding-left: 1.5rem;
      list-style-type: disc;
    }
    
    .event-result-list li {
      margin-bottom: 0.25rem;
      color: #2D3748;
    }
    
    .start-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #F7FAFC;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      transition: all 0.5s ease;
    }
    
    .start-screen-content {
      text-align: center;
      max-width: 600px;
      padding: 2rem;
    }
    
    .start-screen-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #2D3748;
    }
    
    .start-screen-subtitle {
      font-size: 1.25rem;
      margin-bottom: 2rem;
      color: #4A5568;
    }
    
    .start-screen-image {
      width: 100%;
      max-width: 400px;
      margin: 0 auto 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .start-screen-description {
      margin-bottom: 2rem;
      color: #4A5568;
    }
    
    .start-screen-button {
      background-color: #805AD5;
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .start-screen-button:hover {
      background-color: #6B46C1;
      transform: translateY(-2px);
    }
    
    .tutorial-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .tutorial-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .tutorial-modal-content {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .tutorial-modal.active .tutorial-modal-content {
      transform: translateY(0);
    }
    
    .tutorial-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .tutorial-modal-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #2D3748;
    }
    
    .tutorial-modal-close {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: #4A5568;
    }
    
    .tutorial-step {
      margin-bottom: 1.5rem;
      display: block !important;
    }
    
    .tutorial-step-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2D3748;
    }
    
    .tutorial-step-content {
      margin-bottom: 0.5rem;
      color: #4A5568;
    }
    
    .tutorial-step-image {
      width: 100%;
      max-width: 400px;
      margin: 0 auto 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .tutorial-navigation {
      display: flex;
      justify-content: center;
      margin-top: 1.5rem;
    }
    
    .tutorial-button {
      background-color: #805AD5;
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .tutorial-button:hover {
      background-color: #6B46C1;
    }
    
    .tutorial-button:disabled {
      background-color: #A0AEC0;
      cursor: not-allowed;
    }
    
    .game-over-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .game-over-modal.active {
      opacity: 1;
      visibility: visible;
    }
    
    .game-over-modal-content {
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      max-width: 600px;
      width: 90%;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-20px);
      transition: all 0.3s ease;
    }
    
    .game-over-modal.active .game-over-modal-content {
      transform: translateY(0);
    }
    
    .game-over-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .game-over-modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2D3748;
    }
    
    .game-over-modal-body {
      margin-bottom: 1.5rem;
    }
    
    .game-over-modal-text {
      margin-bottom: 1rem;
      color: #2D3748;
    }
    
    .game-over-stats {
      background-color: #EDF2F7;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .game-over-stats-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2D3748;
    }
    
    .game-over-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }
    
    .game-over-stat {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      color: #4A5568;
    }
    
    .game-over-stat-value {
      font-weight: 600;
      color: #2D3748;
    }
    
    .game-over-modal-options {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    
    .game-over-button {
      background-color: #805AD5;
      color: white;
      border: none;
      border-radius: 0.5rem;
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .game-over-button:hover {
      background-color: #6B46C1;
    }
    
    .achievement-modal {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background-color: #F7FAFC;
      border: 1px solid #E2E8F0;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
      max-width: 300px;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .achievement-modal.active {
      transform: translateX(0);
      opacity: 1;
    }
    
    .achievement-icon {
      font-size: 1.5rem;
      color: #805AD5;
    }
    
    .achievement-content {
      flex: 1;
    }
    
    .achievement-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: #2D3748;
    }
    
    .achievement-description {
      font-size: 0.875rem;
      color: #4A5568;
    }
    
    .achievement-close {
      background: none;
      border: none;
      font-size: 0.875rem;
      cursor: pointer;
      color: #4A5568;
    }
    
    /* æ°´å¢¨ç”»é£æ ¼çš„ç‰¹æ®Šæ•ˆæœ */
    .ink-border {
      position: relative;
      border: 1px solid #A0AEC0;
    }
    
    .ink-border::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      border: 1px solid #A0AEC0;
      border-radius: 0.5rem;
      z-index: -1;
      opacity: 0.5;
    }
    
    .ink-bg {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="none" stroke="%23E2E8F0" stroke-width="0.5" stroke-dasharray="5,5"/></svg>');
      background-repeat: repeat;
    }
    
    .ink-text {
      position: relative;
      display: inline-block;
    }
    
    .ink-text::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 1px;
      background-color: #A0AEC0;
      transform: scaleX(0.8) translateX(10%);
      opacity: 0.7;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .location-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .action-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 640px) {
      .location-grid {
        grid-template-columns: 1fr;
      }
      
      .action-grid {
        grid-template-columns: 1fr;
      }
      
      .resource-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
      
      .status-grid {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .header-info {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body class="ink-bg">
  <!-- å¼€å§‹å±å¹• -->
  <div class="start-screen" id="startScreen">
    <div class="start-screen-content">
      <h1 class="start-screen-title ink-text">ä¹ä¸ç”Ÿå­˜</h1>
      <p class="start-screen-subtitle">æ°´å¢¨ç”»é£æ ¼çš„å¡ç‰Œç”Ÿå­˜æ¸¸æˆ</p>
      <img src="https://p26-doubao-search-sign.byteimg.com/labis/image/ca34eef8faf2eaaa278d2cc70942e1fe~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779775073&x-signature=8D1SWhJmDtjETZt3j6%2BXhlYMVbM%3D" alt="æ¸¸æˆèƒŒæ™¯" class="start-screen-image">
      <p class="start-screen-description">
        åœ¨è¿™ä¸ªæ®‹é…·çš„å¤ä»£ä¸–ç•Œä¸­ï¼Œä½ æ‰®æ¼”ä¸€åä¹ä¸ï¼ŒæŒ£æ‰æ±‚ç”Ÿã€‚é€šè¿‡æ”¶é›†èµ„æºã€åˆ¶ä½œå·¥å…·ã€æ¢ç´¢åœ°ç‚¹å’Œåº”å¯¹äº‹ä»¶ï¼ŒåŠªåŠ›æ´»ä¸‹å»å¹¶å¯»æ‰¾æ”¹å˜å‘½è¿çš„æœºä¼šã€‚
      </p>
      <button class="start-screen-button" id="startGameButton">å¼€å§‹æ¸¸æˆ</button>
    </div>
  </div>

  <!-- æ•™ç¨‹æ¨¡æ€æ¡† -->
  <div class="tutorial-modal" id="tutorialModal">
    <div class="tutorial-modal-content ink-border">
      <div class="tutorial-modal-header">
        <h2 class="tutorial-modal-title ink-text">æ¸¸æˆæ•™ç¨‹</h2>
        <button class="tutorial-modal-close" id="closeTutorialButton">&times;</button>
      </div>
      <div class="tutorial-steps">
        <div class="tutorial-step" id="tutorialStep1">
          <h3 class="tutorial-step-title">æ¬¢è¿æ¥åˆ°ä¹ä¸ç”Ÿå­˜</h3>
          <p class="tutorial-step-content">åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä½ å°†æ‰®æ¼”ä¸€åå¤ä»£ä¹ä¸ï¼Œé€šè¿‡æ”¶é›†èµ„æºã€åˆ¶ä½œå·¥å…·å’Œåº”å¯¹å„ç§äº‹ä»¶æ¥ç”Ÿå­˜ä¸‹å»ã€‚</p>
          <p class="tutorial-step-content">æ¸¸æˆçš„æ ¸å¿ƒæ˜¯å¡ç‰Œç³»ç»Ÿï¼Œæ‰€æœ‰çš„èµ„æºã€åœ°ç‚¹ã€çŠ¶æ€å’Œè¡ŒåŠ¨éƒ½ä»¥å¡ç‰Œå½¢å¼å‘ˆç°ã€‚</p>
        </div>
        <div class="tutorial-step" id="tutorialStep2">
          <h3 class="tutorial-step-title">èƒŒåŒ…ç®¡ç†</h3>
          <p class="tutorial-step-content">ä½ éœ€è¦ç®¡ç†èƒŒåŒ…ä¸­çš„å¤šç§ç‰©å“ï¼ŒåŒ…æ‹¬é£Ÿç‰©ã€é’±å¸ã€ææ–™å’Œå·¥å…·ã€‚è¿™äº›ç‰©å“å¯ä»¥é€šè¿‡æ¢ç´¢åœ°ç‚¹ã€ä¹è®¨æˆ–åˆ¶ä½œè·å¾—ã€‚</p>
          <p class="tutorial-step-content">æ³¨æ„ï¼šé£Ÿç‰©ä¼šéšç€æ—¶é—´æ¶ˆè€—ï¼Œä½ éœ€è¦ä¿æŒè¶³å¤Ÿçš„é£Ÿç‰©æ¥ç»´æŒç”Ÿå­˜ã€‚</p>
        </div>
        <div class="tutorial-step" id="tutorialStep3">
          <h3 class="tutorial-step-title">å¡ç‰Œç»„åˆ</h3>
          <p class="tutorial-step-content">å°†ä¸åŒçš„å¡ç‰Œæ‹–æ”¾åˆ°ç»„åˆåŒºåŸŸå¯ä»¥åˆ›å»ºæ–°çš„ç‰©å“æˆ–æ‰§è¡Œç‰¹å®šè¡ŒåŠ¨ã€‚ä¾‹å¦‚ï¼š</p>
          <ul class="tutorial-step-content">
            <li>å°†"ç ´ç¢—"å’Œ"è¡—è§’"ç»„åˆå¯ä»¥è¿›è¡Œä¹è®¨</li>
            <li>å°†"æ®‹ç¾¹å‰©é¥­"å’Œ"ç ´ç¢—"ç»„åˆå¯ä»¥é£Ÿç”¨</li>
            <li>å°†"ç ´å¸ƒ"å’Œ"æœ¨æ£"ç»„åˆå¯ä»¥åˆ¶ä½œç®€æ˜“æ‹æ–</li>
          </ul>
          <p class="tutorial-step-content">å°è¯•ä¸åŒçš„ç»„åˆæ¥å‘ç°æ–°çš„é…æ–¹ï¼</p>
        </div>
        <div class="tutorial-step" id="tutorialStep4">
          <h3 class="tutorial-step-title">çŠ¶æ€ç®¡ç†</h3>
          <p class="tutorial-step-content">ä½ çš„è§’è‰²æœ‰å¤šç§çŠ¶æ€éœ€è¦å…³æ³¨ï¼š</p>
          <ul class="tutorial-step-content">
            <li>é¥¥é¥¿ï¼šéœ€è¦æ®‹ç¾¹å‰©é¥­æ¥ç¼“è§£</li>
            <li>å¯’å†·ï¼šéœ€è¦ä¿æš–ç‰©å“</li>
            <li>å¥åº·ï¼šé¿å…ç”Ÿç—…ï¼Œä¿æŒè‰¯å¥½çŠ¶æ€</li>
            <li>ç²¾ç¥ï¼šå½±å“ä½ çš„ä¹è®¨æ•ˆç‡å’Œå†³ç­–èƒ½åŠ›</li>
            <li>å£°æœ›ï¼šå½±å“NPCå¯¹ä½ çš„æ€åº¦å’Œå¯è®¿é—®çš„åœ°ç‚¹</li>
          </ul>
          <p class="tutorial-step-content">çŠ¶æ€è¿‡ä½ä¼šå½±å“ä½ çš„ç”Ÿå­˜èƒ½åŠ›ï¼Œç”šè‡³å¯¼è‡´æ­»äº¡ã€‚</p>
        </div>
        <div class="tutorial-step" id="tutorialStep5">
          <h3 class="tutorial-step-title">æ¢ç´¢åœ°ç‚¹</h3>
          <p class="tutorial-step-content">ä¸åŒçš„åœ°ç‚¹æä¾›ä¸åŒçš„èµ„æºå’Œäº‹ä»¶ï¼š</p>
          <ul class="tutorial-step-content">
            <li>è¡—è§’ï¼šä¹è®¨çš„ä¸»è¦åœ°ç‚¹</li>
            <li>åƒåœ¾å †ï¼šå¯»æ‰¾é£Ÿç‰©æ®‹æ¸£å’Œææ–™</li>
            <li>å¯ºåº™ï¼šå¯ä»¥è·å¾—å…è´¹æ®‹ç¾¹å‰©é¥­å’Œä¼‘æ¯</li>
            <li>å¯ŒäººåŒºï¼šä¹è®¨æ•ˆç‡é«˜ä½†é£é™©å¤§</li>
            <li>è´«æ°‘çªŸï¼šä¸å…¶ä»–ä¹ä¸äº’åŠ¨</li>
          </ul>
          <p class="tutorial-step-content">ç‚¹å‡»åœ°ç‚¹å¡ç‰Œå¯ä»¥æ¢ç´¢è¯¥åœ°ç‚¹ï¼Œè·å¾—èµ„æºæˆ–è§¦å‘äº‹ä»¶ã€‚</p>
        </div>
        <div class="tutorial-step" id="tutorialStep6">
          <h3 class="tutorial-step-title">æ—¶é—´ä¸å­£èŠ‚</h3>
          <p class="tutorial-step-content">æ¸¸æˆä»¥å›åˆåˆ¶è¿›è¡Œï¼Œæ¯ä¸ªå›åˆä»£è¡¨ä¸€å¤©ã€‚æ—¶é—´çš„æµé€ä¼šå½±å“ï¼š</p>
          <ul class="tutorial-step-content">
            <li>èµ„æºæ¶ˆè€—ï¼šæ®‹ç¾¹å‰©é¥­å’Œä¿æš–ç‰©å“ä¼šéšæ—¶é—´æ¶ˆè€—</li>
            <li>å­£èŠ‚å˜åŒ–ï¼šä¸åŒå­£èŠ‚æœ‰ä¸åŒçš„ç”Ÿå­˜æŒ‘æˆ˜</li>
            <li>äº‹ä»¶è§¦å‘ï¼šæŸäº›äº‹ä»¶åªåœ¨ç‰¹å®šæ—¶é—´æˆ–å­£èŠ‚å‘ç”Ÿ</li>
          </ul>
          <p class="tutorial-step-content">åˆç†è§„åˆ’ä½ çš„æ—¶é—´ï¼Œä¸ºå³å°†åˆ°æ¥çš„å­£èŠ‚åšå¥½å‡†å¤‡ã€‚</p>
        </div>
        <div class="tutorial-step" id="tutorialStep7">
          <h3 class="tutorial-step-title">ç›®æ ‡ä¸ç»“å±€</h3>
          <p class="tutorial-step-content">æ¸¸æˆæœ‰å¤šç§å¯èƒ½çš„ç»“å±€ï¼Œå–å†³äºä½ çš„é€‰æ‹©å’Œè¡ŒåŠ¨ï¼š</p>
          <ul class="tutorial-step-content">
            <li>ç”Ÿå­˜ç»“å±€ï¼šå°½å¯èƒ½é•¿æ—¶é—´åœ°æ´»ä¸‹å»</li>
            <li>è´¢å¯Œç»“å±€ï¼šç§¯ç´¯è¶³å¤Ÿçš„è´¢å¯Œæ‘†è„±ä¹ä¸èº«ä»½</li>
            <li>å£°æœ›ç»“å±€ï¼šè·å¾—è¶³å¤Ÿçš„å£°æœ›æˆä¸ºä¹ä¸ä¹‹ç‹</li>
            <li>çŸ¥è¯†ç»“å±€ï¼šå­¦ä¹ è¶³å¤Ÿçš„æŠ€èƒ½æ‰¾åˆ°å·¥ä½œ</li>
            <li>æ­»äº¡ç»“å±€ï¼šå› é¥¥é¥¿ã€å¯’å†·ã€ç–¾ç—…æˆ–å…¶ä»–åŸå› æ­»äº¡</li>
          </ul>
          <p class="tutorial-step-content">ä½ çš„æ¯ä¸€ä¸ªé€‰æ‹©éƒ½ä¼šå½±å“æœ€ç»ˆçš„ç»“å±€ã€‚</p>
        </div>
        <div class="tutorial-step" id="tutorialStep8">
          <h3 class="tutorial-step-title">å¼€å§‹ä½ çš„ç”Ÿå­˜ä¹‹æ—…</h3>
          <p class="tutorial-step-content">ç°åœ¨ä½ å·²ç»äº†è§£äº†æ¸¸æˆçš„åŸºæœ¬æœºåˆ¶ï¼Œæ˜¯æ—¶å€™å¼€å§‹ä½ çš„ç”Ÿå­˜ä¹‹æ—…äº†ã€‚</p>
          <p class="tutorial-step-content">è®°ä½ï¼šåœ¨è¿™ä¸ªæ®‹é…·çš„ä¸–ç•Œä¸­ï¼Œæ¯ä¸€ä¸ªé€‰æ‹©éƒ½è‡³å…³é‡è¦ã€‚ç¥ä½ å¥½è¿ï¼</p>
        </div>
      </div>
      <div class="tutorial-navigation">
        <button class="tutorial-button" id="closeTutorialBtn">å…³é—­</button>
      </div>
    </div>
  </div>

  <!-- æ¸¸æˆå®¹å™¨ -->
  <div class="game-container" id="gameContainer" style="display: none;">
    <!-- å¸®åŠ©æŒ‰é’® -->
    <button class="help-button" id="helpButton" style="position: absolute; top: 1rem; left: 1rem; background-color: rgba(255, 255, 255, 0.8); border: 1px solid #A0AEC0; border-radius: 50%; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; cursor: pointer; z-index: 1000; color: #2D3748;">?</button>
    <!-- å¤´éƒ¨ -->
    <header class="header">
      <h1 class="header-title ink-text">ä¹ä¸ç”Ÿå­˜</h1>
      <div class="header-info">
        <div class="day-indicator">
          ç¬¬ <span class="day-number" id="dayNumber">1</span> å¤©
        </div>
        <div class="season-indicator">
          <span class="season-icon" id="seasonIcon">ğŸŒ±</span>
          <span id="seasonName">æ˜¥å­£</span>
        </div>
        <div class="info-item tooltip">
          <i class="fa fa-cutlery" aria-hidden="true"></i>
          <span class="info-item-value" id="foodValue">50%</span>
          <span class="tooltip-text">é¥¥é¥¿åº¦ï¼šä½äº20%ä¼šå½±å“å¥åº·</span>
        </div>
        <div class="info-item tooltip">
          <i class="fa fa-home" aria-hidden="true"></i>
          <span class="info-item-value" id="warmthValue">60%</span>
          <span class="tooltip-text">ä¿æš–åº¦ï¼šä½äº30%ä¼šæ„Ÿåˆ°å¯’å†·</span>
        </div>
        <div class="info-item tooltip">
          <i class="fa fa-heart" aria-hidden="true"></i>
          <span class="info-item-value" id="healthValue">80%</span>
          <span class="tooltip-text">å¥åº·åº¦ï¼šä½äº0%ä¼šå¯¼è‡´æ­»äº¡</span>
        </div>
        <div class="info-item tooltip">
          <i class="fa fa-smile-o" aria-hidden="true"></i>
          <span class="info-item-value" id="spiritValue">70%</span>
          <span class="tooltip-text">ç²¾ç¥çŠ¶æ€ï¼šå½±å“ä¹è®¨æ•ˆç‡</span>
        </div>
        <div class="info-item tooltip">
          <i class="fa fa-star" aria-hidden="true"></i>
          <span class="info-item-value" id="reputationValue">20%</span>
          <span class="tooltip-text">å£°æœ›ï¼šå½±å“NPCäº’åŠ¨å’Œåœ°ç‚¹è®¿é—®</span>
        </div>
      </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="main-content">
      <!-- ä¾§è¾¹æ  -->
      <div class="sidebar">
        <!-- äººç‰©çŠ¶æ€åŒºåŸŸ -->
        <div class="sidebar-section ink-border">
          <h2 class="sidebar-section-title ink-text">äººç‰©çŠ¶æ€</h2>
          <!-- çŠ¶æ€æ æ§åˆ¶æŒ‰é’® -->
          <div class="status-controls" style="display: flex; gap: 0.5rem; margin-bottom: 1rem; justify-content: center;">
            <button id="equipmentButton" class="status-button" style="padding: 0.5rem 1rem; background-color: #4299E1; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: background-color 0.2s ease;">
              è£…å¤‡
            </button>
            <button id="skillsButton" class="status-button" style="padding: 0.5rem 1rem; background-color: #667EEA; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: background-color 0.2s ease;">
              æŠ€èƒ½
            </button>
          </div>
          <div class="status-grid">
            <div class="card status">
              <div class="card-content">
                <div class="card-title" style="font-size: 0.875rem;">
                  é¥¥é¥¿
                  <span class="status-percentage" id="hungerPercentage" style="font-size: 0.875rem;">50%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-bar-fill" id="hungerBar" style="width: 50%; background-color: #E53E3E;"></div>
                </div>
              </div>
            </div>
            <div class="card status">
              <div class="card-content">
                <div class="card-title" style="font-size: 0.875rem;">
                  å¯’å†·
                  <span class="status-percentage" id="coldPercentage" style="font-size: 0.875rem;">60%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-bar-fill" id="coldBar" style="width: 60%; background-color: #3182CE;"></div>
                </div>
              </div>
            </div>
            <div class="card status">
              <div class="card-content">
                <div class="card-title" style="font-size: 0.875rem;">
                  å¥åº·
                  <span class="status-percentage" id="healthPercentage" style="font-size: 0.875rem;">80%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-bar-fill" id="healthBar" style="width: 80%; background-color: #38A169;"></div>
                </div>
              </div>
            </div>
            <div class="card status">
              <div class="card-content">
                <div class="card-title" style="font-size: 0.875rem;">
                  ç²¾ç¥
                  <span class="status-percentage" id="spiritPercentage" style="font-size: 0.875rem;">70%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-bar-fill" id="spiritBar" style="width: 70%; background-color: #805AD5;"></div>
                </div>
              </div>
            </div>
            <div class="card status">
              <div class="card-content">
                <div class="card-title" style="font-size: 0.875rem;">
                  å£°æœ›
                  <span class="status-percentage" id="reputationPercentage" style="font-size: 0.875rem;">20%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-bar-fill" id="reputationBar" style="width: 20%; background-color: #D69E2E;"></div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- ç»„åˆåŒºåŸŸ -->
        <div class="combination-area ink-border sidebar-section">
          <h2 class="combination-title ink-text">å¡ç‰Œç»„åˆ</h2>
          <div class="combination-slots" id="combinationSlots">
            <div class="combination-slot" data-slot="1"></div>
            <div class="combination-slot" data-slot="2"></div>
            <div class="combination-slot" data-slot="3"></div>
          </div>
          <div class="combination-result" id="combinationResult">
            <!-- ç»„åˆç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
          </div>
          <div class="flex gap-2">
            <button class="combination-button" id="combineButton" disabled>ç»„åˆ</button>
            <button class="combination-button" id="recipeButton">é…æ–¹</button>
          </div>
        </div>
      </div>

      <!-- ä¸»è¦åŒºåŸŸ -->
      <div class="main-area">
        <!-- åœ°ç‚¹åŒºåŸŸ -->
        <div class="sidebar-section ink-border">
          <div class="flex justify-between items-center">
            <h2 class="sidebar-section-title ink-text">åœ°ç‚¹</h2>
            <div class="action-points-display">
              <span class="action-points-text">è¡ŒåŠ¨ç‚¹</span>
              <span class="action-points-value" id="actionPointsValue">3/3</span>
              <div class="action-points-bar-container">
                <div class="action-points-bar" id="actionPointsBar" style="width: 100%; background-color: #3182CE;"></div>
              </div>
            </div>
          </div>
          <div class="location-grid" id="locationGrid">
            <!-- åœ°ç‚¹å¡ç‰Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>

        <!-- è¡ŒåŠ¨åŒºåŸŸ -->
        <div class="sidebar-section ink-border">
          <h2 class="sidebar-section-title ink-text">è¡ŒåŠ¨</h2>
          <div class="action-grid" id="actionGrid">
            <!-- è¡ŒåŠ¨å¡ç‰Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>

        <!-- èƒŒåŒ…åŒºåŸŸ -->
        <div class="sidebar-section ink-border">
          <h2 class="sidebar-section-title ink-text">èƒŒåŒ…</h2>
          
          <!-- åˆ†ç±»æ ‡ç­¾ -->
          <div class="inventory-tabs" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; border-bottom: 1px solid #E2E8F0; padding-bottom: 0.5rem;">
            <button class="inventory-tab active" data-category="all" style="padding: 0.25rem 0.75rem; border: 1px solid #E2E8F0; border-radius: 0.375rem; background-color: #805AD5; color: white; cursor: pointer;">å…¨éƒ¨</button>
            <button class="inventory-tab" data-category="food" style="padding: 0.25rem 0.75rem; border: 1px solid #E2E8F0; border-radius: 0.375rem; background-color: #F7FAFC; color: #4A5568; cursor: pointer;">é£Ÿç‰©</button>
            <button class="inventory-tab" data-category="material" style="padding: 0.25rem 0.75rem; border: 1px solid #E2E8F0; border-radius: 0.375rem; background-color: #F7FAFC; color: #4A5568; cursor: pointer;">åŸºç¡€ææ–™</button>
            <button class="inventory-tab" data-category="equipment" style="padding: 0.25rem 0.75rem; border: 1px solid #E2E8F0; border-radius: 0.375rem; background-color: #F7FAFC; color: #4A5568; cursor: pointer;">è£…å¤‡</button>
          </div>
          
          <!-- èƒŒåŒ…ç½‘æ ¼ -->
          <div class="resource-grid" id="resourceGrid">
            <!-- èƒŒåŒ…ç‰©å“å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>
          
          <!-- åˆ†é¡µæ§åˆ¶ -->
          <div class="inventory-pagination" style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #E2E8F0;">
            <button id="prevPage" style="padding: 0.25rem 0.75rem; border: 1px solid #E2E8F0; border-radius: 0.375rem; background-color: #F7FAFC; color: #4A5568; cursor: pointer;">ä¸Šä¸€é¡µ</button>
            <span id="pageInfo" style="font-size: 0.875rem; color: #4A5568;">ç¬¬ 1/1 é¡µ</span>
            <button id="nextPage" style="padding: 0.25rem 0.75rem; border: 1px solid #E2E8F0; border-radius: 0.375rem; background-color: #F7FAFC; color: #4A5568; cursor: pointer;">ä¸‹ä¸€é¡µ</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- äº‹ä»¶æ¨¡æ€æ¡† -->
  <div class="event-modal" id="eventModal">
    <div class="event-modal-content ink-border">
      <div class="event-modal-header">
        <h2 class="event-modal-title ink-text" id="eventTitle">äº‹ä»¶</h2>
        <button class="event-modal-close" id="closeEventButton">&times;</button>
      </div>
      <div class="event-modal-body">
        <p class="event-modal-text" id="eventText">äº‹ä»¶æè¿°å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
        <div class="event-modal-options" id="eventOptions">
          <!-- äº‹ä»¶é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </div>
  </div>

  <!-- é…æ–¹æ¨¡æ€æ¡† -->
  <div class="recipe-modal" id="recipeModal">
    <div class="recipe-modal-content ink-border">
      <div class="recipe-modal-header">
        <h2 class="recipe-modal-title ink-text">å·²çŸ¥é…æ–¹</h2>
        <button class="recipe-modal-close" id="closeRecipeButton">&times;</button>
      </div>
      <div class="recipe-grid" id="recipeGrid">
        <!-- é…æ–¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <!-- æ¸¸æˆç»“æŸæ¨¡æ€æ¡† -->
  <div class="game-over-modal" id="gameOverModal">
    <div class="game-over-modal-content ink-border">
      <div class="game-over-modal-header">
        <h2 class="game-over-modal-title ink-text" id="gameOverTitle">æ¸¸æˆç»“æŸ</h2>
      </div>
      <div class="game-over-modal-body">
        <p class="game-over-modal-text" id="gameOverText">æ¸¸æˆç»“æŸåŸå› å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
        <div class="game-over-stats">
          <h3 class="game-over-stats-title">ç”Ÿå­˜ç»Ÿè®¡</h3>
          <div class="game-over-stats-grid">
            <div class="game-over-stat">
              <span>ç”Ÿå­˜å¤©æ•°ï¼š</span>
              <span class="game-over-stat-value" id="daysSurvived">0</span>
            </div>
            <div class="game-over-stat">
              <span>æœ€é«˜å£°æœ›ï¼š</span>
              <span class="game-over-stat-value" id="maxReputation">0%</span>
            </div>
            <div class="game-over-stat">
              <span>æ”¶é›†èµ„æºï¼š</span>
              <span class="game-over-stat-value" id="resourcesCollected">0</span>
            </div>
            <div class="game-over-stat">
              <span>å‘ç°é…æ–¹ï¼š</span>
              <span class="game-over-stat-value" id="recipesDiscovered">0</span>
            </div>
          </div>
        </div>
        <div class="game-over-modal-options">
          <button class="game-over-button" id="restartGameButton">é‡æ–°å¼€å§‹</button>
          <button class="game-over-button" id="exitGameButton">é€€å‡ºæ¸¸æˆ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- é€šçŸ¥ -->
  <div class="notification" id="notification">
    <button class="notification-close" id="closeNotificationButton">&times;</button>
    <h3 class="notification-title" id="notificationTitle">é€šçŸ¥</h3>
    <p class="notification-message" id="notificationMessage">é€šçŸ¥å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
  </div>

  <!-- æˆå°±é€šçŸ¥ -->
  <div class="achievement-modal" id="achievementModal">
    <div class="achievement-icon">
      <i class="fa fa-trophy" aria-hidden="true"></i>
    </div>
    <div class="achievement-content">
      <h3 class="achievement-title" id="achievementTitle">æˆå°±è§£é”</h3>
      <p class="achievement-description" id="achievementDescription">æˆå°±æè¿°å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
    </div>
    <button class="achievement-close" id="closeAchievementButton">&times;</button>
  </div>

  <script>
    // æ¸¸æˆæ•°æ®
    const gameData = {
      day: 1,
      timeOfDay: 'early_morning', // early_morning, morning, afternoon, evening, night
      timeTurns: 0, // å½“å‰æ—¶é—´æ®µçš„å›åˆæ•°
      season: 'spring', // spring, summer, autumn, winter
      begging_chance: 0, // ä¹è®¨æˆåŠŸç‡åŠ æˆ
      resources: {
        'food': { name: 'æ®‹ç¾¹å‰©é¥­', description: 'ä¹è®¨æˆ–æœå¯»è·å¾—çš„é£Ÿç‰©æ®‹æ¸£ï¼Œè™½ç„¶èƒ½ç¼“è§£é¥¥é¥¿ï¼Œä½†å¯èƒ½å½±å“å¥åº·', amount: 3, image: 'UI/æ®‹ç¾¹å‰©é¥­.jpg', type: 'consumable', category: 'food' },
        'money': { name: 'é’±å¸', amount: 2, image: 'UI/é’±å¸.jpg', category: 'material' },
        'cloth': { name: 'ç ´å¸ƒ', amount: 5, image: 'UI/ç ´å¸ƒ.jpg', category: 'material' },
        'stick': { name: 'æœ¨æ£', amount: 4, image: 'UI/æœ¨æ£.jpg', category: 'material' },
        'paper': { name: 'åºŸçº¸', amount: 3, image: 'UI/åºŸçº¸.jpg', category: 'material' },
        'bowl': { name: 'ç ´ç¢—', amount: 1, image: 'UI/ç ´ç¢—.jpg', category: 'material' },
        'medicine': { name: 'çµè¯', description: 'çè´µçš„è‰è¯ï¼Œèƒ½æ¢å¤å¤§é‡å¥åº·', amount: 0, image: 'UI/çµè¯.png', type: 'consumable', category: 'equipment' },
          'house_deed': { name: 'æˆ¿å±‹åœ°å¥‘', description: 'æ‹¥æœ‰ä¸€å¤„æˆ¿äº§çš„è¯æ˜ï¼Œæå‡å£°æœ›å’Œç²¾ç¥çŠ¶æ€', amount: 0, image: 'UI/æˆ¿å±‹åœ°å¥‘.png', durability: 100 },
          'fine_clothes': { name: 'ç²¾ç¾åæœ', description: 'é«˜æ¡£çš„ä¸ç»¸æœè£…ï¼Œå¤§å¹…æå‡å£°æœ›å’Œä¿æš–åº¦', amount: 0, image: 'UI/ç²¾ç¾åæœ.png', equipmentSlot: 'clothes', durability: 100 },
          'silk_shoes': { name: 'ç¼é‹', description: 'ç²¾è‡´çš„ä¸ç¼é‹å­ï¼Œæå‡å¥åº·åº¦å’Œä¿æš–åº¦', amount: 0, image: 'UI/ç¼é‹.png', equipmentSlot: 'shoes', durability: 100 },
          'ornate_shoes': { name: 'é”¦å±¥', description: 'åä¸½çš„é”¦ç¼é‹å­ï¼Œå¤§å¹…æå‡å£°æœ›å’Œå¥åº·åº¦', amount: 0, image: 'UI/é”¦å±¥.png', equipmentSlot: 'shoes', durability: 100 },
          'dog_beating_stick': { name: 'æ‰“ç‹—æ£’æ³•', description: 'ä¸å¸®é•‡å¸®ä¹‹å®ï¼Œå­¦ä¹ åæå‡æ­¦æœ¯æŠ€èƒ½', amount: 0, image: 'UI/æ‰“ç‹—æ£’æ³•.png', type: 'learnable', skill: 'martial', oneTimeUse: true, cannotDrop: true },
          'herbal_manual': { name: 'æœ¬è‰çº²ç›®', description: 'å¤ä»£åŒ»å­¦åè‘—ï¼Œå­¦ä¹ åæå‡åŒ»æœ¯æŠ€èƒ½å¹¶èƒ½è¯†åˆ«è‰è¯', amount: 0, image: 'UI/æœ¬è‰çº²ç›®.png', type: 'learnable', skill: 'medicine', oneTimeUse: true, cannotDrop: true },
          'huangdi_canon': { name: 'é»„å¸å†…ç»', description: 'ä¸­åŒ»ç»å…¸è‘—ä½œï¼Œå­¦ä¹ åæå‡åŒ»æœ¯æŠ€èƒ½å¹¶èƒ½æ²»ç–—ç–¾ç—…', amount: 0, image: 'UI/é»„å¸å†…ç».png', type: 'learnable', skill: 'medicine', oneTimeUse: true, cannotDrop: true },
          'stealth_book': { name: 'å·å¤©æ¢æ—¥', description: 'ç›—çªƒæŠ€å·§ç§˜ç±ï¼Œå­¦ä¹ åæå‡å·çªƒæŠ€èƒ½', amount: 0, image: 'UI/å·å¤©æ¢æ—¥.png', type: 'learnable', skill: 'steal', oneTimeUse: true, cannotDrop: true },
          'house_deed': { name: 'æˆ¿å±‹åœ°å¥‘', description: 'æ‹¥æœ‰è‡ªå·±çš„æˆ¿äº§ï¼Œæé«˜å£°æœ›å’Œç²¾ç¥çŠ¶æ€', amount: 0, image: 'UI/æˆ¿å±‹åœ°å¥‘.png', equipmentSlot: 'special' },
          'fine_clothes': { name: 'ç²¾ç¾åæœ', description: 'åä¸½çš„æœè£…ï¼Œå¤§å¹…æé«˜å£°æœ›å’Œä¿æš–åº¦', amount: 0, image: 'UI/ç²¾ç¾åæœ.png', equipmentSlot: 'clothes' },
          'silk_shoes': { name: 'ç¼é‹', description: 'ç²¾è‡´çš„ç¼é¢é‹å­ï¼Œæé«˜å£°æœ›å’Œå¥åº·', amount: 0, image: 'UI/ç¼é‹.png', equipmentSlot: 'shoes' },
          'dog_beating_stick': { name: 'æ‰“ç‹—æ£’æ³•', description: 'ä¸å¸®ç»æŠ€ï¼Œå­¦ä¹ åæå‡æ­¦æœ¯æŠ€èƒ½', amount: 0, image: 'UI/æ‰“ç‹—æ£’æ³•.png', type: 'learnable', skill: 'martial', oneTimeUse: true, cannotDrop: true },
          'herbal_medicine_book': { name: 'æœ¬è‰çº²ç›®', description: 'åŒ»å­¦ç»å…¸ï¼Œå­¦ä¹ åæå‡åŒ»æœ¯æŠ€èƒ½å¹¶èƒ½è¯†åˆ«è‰è¯', amount: 0, image: 'UI/æœ¬è‰çº²ç›®.png', type: 'learnable', skill: 'medicine', oneTimeUse: true, cannotDrop: true },
          'huangdi_neijing': { name: 'é»„å¸å†…ç»', description: 'åŒ»å­¦ç»å…¸ï¼Œå­¦ä¹ åæå‡åŒ»æœ¯æŠ€èƒ½å¹¶èƒ½æ²»ç–—ç–¾ç—…', amount: 0, image: 'UI/é»„å¸å†…ç».png', type: 'learnable', skill: 'medicine', oneTimeUse: true, cannotDrop: true },
          'stealth_book': { name: 'å·å¤©æ¢æ—¥', description: 'ç›—çªƒæŠ€å·§ç§˜ç±ï¼Œå­¦ä¹ åæå‡å·çªƒæŠ€èƒ½', amount: 0, image: 'UI/å·å¤©æ¢æ—¥.png', type: 'learnable', skill: 'steal', oneTimeUse: true, cannotDrop: true },
        
        'simple_clothes': { name: 'ç ´è¡£æœ', amount: 0, image: 'UI/ç ´è¡£æœ.jpg', equipmentSlot: 'clothes', durability: 100, category: 'equipment' },
        'flint': { name: 'ç‡§çŸ³', amount: 0, image: 'UI/ç‡§çŸ³.jpg', category: 'material' },
        'mud': { name: 'æ³¥å·´', amount: 0, image: 'UI/æ³¥å·´.jpg', category: 'material' },
        'fire': { name: 'ç¯ç«', amount: 0, image: 'UI/ç¯ç«.png', durability: 100, category: 'equipment' },
        'clay_bowl': { name: 'æ³¥ç¢—', amount: 0, image: 'UI/æ³¥ç¢—.png', durability: 100, category: 'material' },
        'crutch': { name: 'æ‹æ–', amount: 0, image: 'UI/æ‹æ–.png', equipmentSlot: 'weapon', durability: 100, category: 'equipment' },
        'gold_bar': { name: 'é‡‘æ¡', amount: 0, image: 'UI/é‡‘æ¡.jpg', category: 'material' },
        'black_cloth': { name: 'é»‘å¸ƒ', amount: 0, image: 'UI/é»‘å¸ƒ.jpg', category: 'material' },
        'hide': { name: 'å…½çš®', description: 'åŠ¨ç‰©çš„çš®æ¯›ï¼Œå¯ä»¥ç”¨æ¥åˆ¶ä½œä¿æš–è¡£ç‰©å’Œå®¹å™¨', amount: 0, image: 'UI/å…½çš®.png', category: 'material' },
        'thread': { name: 'çº¿å›¢', amount: 0, image: 'UI/çº¿å›¢.jpg', category: 'material' },
        'water_bag': { name: 'æ°´è¢‹', description: 'å¯ä»¥å‚¨å­˜æ°´åˆ†ï¼Œå‡å°‘å£æ¸´å¸¦æ¥çš„è´Ÿé¢å½±å“', amount: 0, image: 'UI/æ°´è¢‹.png', durability: 100, category: 'equipment' },
        'black_cloak': { name: 'é»‘è‰²æ–—ç¯·', amount: 0, image: 'UI/é»‘è¡£æ–—ç¯·.jpg', equipmentSlot: 'special', durability: 100, category: 'equipment' },
        'slave': { name: 'å¥´éš¶', amount: 0, image: 'UI/å¥´éš¶.png' },
        'shoes': { name: 'ç ´é‹', description: 'ç ´æ—§çš„é‹å­ï¼Œæä¾›åŸºæœ¬çš„è„šéƒ¨ä¿æŠ¤', amount: 0, image: 'UI/ç ´é‹.jpg', equipmentSlot: 'shoes', durability: 100 },
        'cornbread': { name: 'çªçªå¤´', description: 'ç²—ç³™çš„è°·ç‰©åˆ¶å“ï¼Œèƒ½æä¾›è¾ƒå¥½çš„é¥±è…¹æ„Ÿ', amount: 0, image: 'UI/çªçªå¤´.jpg', type: 'consumable' },
          'land_deed': { name: 'æˆ¿å±‹åœ°å¥‘', description: 'æ‹¥æœ‰æˆ¿äº§çš„è¯æ˜ï¼Œå¯å¤§å¹…æå‡å£°æœ›', amount: 0, image: 'UI/æˆ¿å±‹åœ°å¥‘.png' },
          'fine_clothes': { name: 'ç²¾ç¾åæœ', description: 'åä¸½çš„æœé¥°ï¼Œæå‡å£°æœ›å’Œä¿æš–åº¦', amount: 0, image: 'UI/ç²¾ç¾åæœ.png', equipmentSlot: 'clothes', durability: 100 },
          'silk_shoes': { name: 'ç¼é‹', description: 'ç²¾è‡´çš„ç¼é¢é‹å­ï¼Œæå‡å¥åº·å’Œä¿æš–åº¦', amount: 0, image: 'UI/ç¼é‹.png', equipmentSlot: 'shoes', durability: 100 },
          'dog_beating_stick': { name: 'æ‰“ç‹—æ£’æ³•', description: 'ä¸å¸®é•‡å¸®ä¹‹å®ï¼Œå­¦ä¹ åæå‡æ­¦æœ¯æŠ€èƒ½', amount: 0, image: 'UI/æ‰“ç‹—æ£’æ³•.png', type: 'learnable', skill: 'martial', oneTimeUse: true, cannotDrop: true },
          'herbal_canon': { name: 'æœ¬è‰çº²ç›®', description: 'å¤ä»£åŒ»å­¦ç»å…¸ï¼Œå­¦ä¹ åæå‡åŒ»æœ¯æŠ€èƒ½å¹¶èƒ½è¯†åˆ«è‰è¯', amount: 0, image: 'UI/æœ¬è‰çº²ç›®.png', type: 'learnable', skill: 'medicine', oneTimeUse: true, cannotDrop: true },
          'huangdi_canon': { name: 'é»„å¸å†…ç»', description: 'ä¸­åŒ»ç»å…¸è‘—ä½œï¼Œå­¦ä¹ åæå‡åŒ»æœ¯æŠ€èƒ½å¹¶èƒ½æ²»ç–—ç–¾ç—…', amount: 0, image: 'UI/é»„å¸å†…ç».png', type: 'learnable', skill: 'medicine', oneTimeUse: true, cannotDrop: true },
          'day_stealing': { name: 'å·å¤©æ¢æ—¥', description: 'ç¥ç§˜çš„ç›—çªƒæŠ€å·§ç§˜ç±ï¼Œå­¦ä¹ åæå‡å·çªƒæŠ€èƒ½', amount: 0, image: 'UI/å·å¤©æ¢æ—¥.png', type: 'learnable', skill: 'steal', oneTimeUse: true, cannotDrop: true },
      },
      status: {
        hunger: 50, // 0-100, è¶Šä½è¶Šé¥¿
        cold: 60,   // 0-100, è¶Šä½è¶Šå†·
        health: 80, // 0-100, è¶Šä½è¶Šä¸å¥åº·
        spirit: 70, // 0-100, è¶Šä½ç²¾ç¥è¶Šå·®
        reputation: 20, // 0-100, è¶Šé«˜å£°æœ›è¶Šå¥½
        actionPoints: 20 // è¡ŒåŠ¨ç‚¹ï¼Œæ¯å›åˆé‡ç½®
      },
      skills: {
        steal: { level: 0, experience: 0, maxLevel: 10, name: 'å·çªƒ' },
        medicine: { level: 0, experience: 0, maxLevel: 10, name: 'åŒ»æœ¯' },
        martial: { level: 0, experience: 0, maxLevel: 10, name: 'æ­¦æœ¯' }
      },
      buffs: {},
      skillExpRequired: [0, 100, 250, 500, 800, 1200, 1800, 2500, 3500, 5000], // æ¯çº§å‡çº§æ‰€éœ€ç»éªŒ
      locations: [
        { 
          id: 'street', 
          name: 'è¡—è§’', 
          description: 'ä¹è®¨çš„ä¸»è¦åœ°ç‚¹ï¼Œäººæµé‡å¤§ä½†ç«äº‰æ¿€çƒˆã€‚', 
          image: 'https://p3-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1875283275294965772~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779775073&x-signature=Ns4kPmfT0VNZHlYbsgjP8WonINw%3D', 
          available: true,
          resourceType: 'money,food',
          dangerLevel: 'low',
          actionPointCost: 1,
          entryCondition: { reputation: { min: 0 } },
          currentLocation: true,
          actions: ['beg', 'search', 'rest'],
          nightActions: ['beg', 'search', 'rest', 'talk_mystery']
        },
        { 
          id: 'dump', 
          name: 'åƒåœ¾å †', 
          description: 'å¯»æ‰¾é£Ÿç‰©æ®‹æ¸£å’Œæœ‰ä»·å€¼åƒåœ¾çš„åœ°æ–¹ï¼Œä½†å«ç”Ÿæ¡ä»¶å·®ã€‚', 
          image: 'https://p11-doubao-search-sign.byteimg.com/tos-cn-i-be4g95zd3a/1891662742987997192~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779775073&x-signature=iQ53iAOLjywrirYpIoakFVVQQdM%3D', 
          available: true,
          resourceType: 'food,cloth,stick,paper,flint,mud,hide',
          dangerLevel: 'medium',
          actionPointCost: 1,
          entryCondition: { health: { min: 30 } },
          actions: ['search', 'rest']
        },
        { 
          id: 'temple', 
          name: 'å¯ºåº™', 
          description: 'å¯ä»¥è·å¾—å…è´¹çš„é£Ÿç‰©å’Œä½å®¿ï¼Œä½†éœ€è¦éµå®ˆå¯ºåº™çš„è§„çŸ©ã€‚', 
          image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f07095c0845f45eb8418958180ca3e77~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815101&x-signature=dENyJs1JB5ZSEtSIkWe9oq4a8us%3D', 
          available: true,
          resourceType: 'food,spirit',
          dangerLevel: 'low',
          actionPointCost: 1,
          entryCondition: { reputation: { min: 10 } },
          actions: ['donate', 'pray', 'rest']
        },
        { 
          id: 'rich_area', 
          name: 'å¯ŒäººåŒº', 
          description: 'ä¹è®¨æ•ˆç‡é«˜ï¼Œä½†é£é™©ä¹Ÿé«˜ï¼Œå®¹æ˜“è¢«é©±èµ¶ã€‚', 
          image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f07095c0845f45eb8418958180ca3e77~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815101&x-signature=dENyJs1JB5ZSEtSIkWe9oq4a8us%3D', 
          available: true,
          resourceType: 'money,black_cloth,thread',
          dangerLevel: 'high',
          actionPointCost: 1,
          entryCondition: { reputation: { min: 30 } },
          actions: ['beg', 'steal', 'search', 'rest']
        },
        { 
          id: 'black_market', 
          name: 'é»‘å¸‚', 
          description: 'å¯ä»¥ç”¨é‡‘æ¡è´­ä¹°ç¨€æœ‰ç‰©å“çš„ç§˜å¯†å¸‚åœºã€‚', 
          image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f07095c0845f45eb8418958180ca3e77~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815101&x-signature=dENyJs1JB5ZSEtSIkWe9oq4a8us%3D', 
          available: false,
          resourceType: 'gold_bar',
          dangerLevel: 'very_high',
          actionPointCost: 2,
          entryCondition: { black_cloak: { min: 1 } },
          actions: ['buy_goods', 'open_black_market_shelf', 'rest']
        },
        { 
          id: 'slum', 
          name: 'è´«æ°‘çªŸ', 
          description: 'èšé›†ç€å…¶ä»–ä¹ä¸ï¼Œå¯ä»¥è¿›è¡Œäº¤æ˜“å’Œåˆä½œã€‚', 
          image: 'https://p26-doubao-search-sign.byteimg.com/labis/image/ca34eef8faf2eaaa278d2cc70942e1fe~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779775073&x-signature=8D1SWhJmDtjETZt3j6%2BXhlYMVbM%3D', 
          available: true,
          resourceType: 'cloth,stick',
          dangerLevel: 'medium',
          actionPointCost: 1,
          entryCondition: { reputation: { min: 0 } },
          actions: ['trade', 'learn', 'rest']
        },
        { 
          id: 'prison', 
          name: 'ç‰¢æˆ¿', 
          description: 'ä½ å› çŠ¯ç½ªè¢«å…³æŠ¼åœ¨è¿™é‡Œï¼Œéœ€è¦é€šè¿‡åŠ³ä½œæ¥è·å¾—è‡ªç”±ã€‚', 
          image: 'https://p3-doubao-search-sign.byteimg.com/labis/981395494749454942549425~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779775073&x-signature=8D1SWhJmDtjETZt3j6%2BXhlYMVbM%3D', 
          available: false,
          resourceType: '',
          dangerLevel: 'high',
          actionPointCost: 0,
          entryCondition: {},
          actions: ['work', 'gamble', 'rest'],
          sentenceDays: 0 // å‰©ä½™åˆ‘æœŸ
        }
      ],
      actions: [
        { id: 'beg', name: 'ä¹è®¨', description: 'å°è¯•å‘è·¯äººä¹è®¨ï¼Œå¯èƒ½è·å¾—æ®‹ç¾¹å‰©é¥­ã€çªçªå¤´æˆ–é’±å¸ã€‚æ‹¥æœ‰æ›´å¥½çš„ç¢—å¯ä»¥æé«˜æˆåŠŸç‡ã€‚', requires: {}, success: { food: 1, cornbread: 1, money: 1 }, failure: { spirit: -5 } },
        { id: 'search', name: 'æœå¯»', description: 'åœ¨é™„è¿‘æœå¯»æœ‰ç”¨çš„ç‰©å“ï¼Œå¯èƒ½è·å¾—ææ–™ã€‚', requires: {}, success: { cloth: 1, stick: 1, paper: 1, flint: 1, mud: 1, black_cloth: 1, thread: 1 }, failure: { health: -5 } },
        { id: 'rest', name: 'ä¼‘æ¯', description: 'æ‰¾ä¸ªåœ°æ–¹ä¼‘æ¯ï¼Œæ¢å¤ç²¾ç¥å’Œå¥åº·ã€‚', requires: {}, success: { spirit: 10, health: 5 }, failure: { hunger: -10, cold: -10 } },
        { id: 'steal', name: 'å·çªƒ', description: 'å°è¯•å·çªƒä»–äººè´¢ç‰©ï¼Œé«˜é£é™©é«˜å›æŠ¥ã€‚', requires: {}, success: { money: 3 }, failure: { health: -15 } },
        { id: 'donate', name: 'æ•‘æµ', description: 'å¯ºåº™æä¾›çš„å…è´¹æ®‹ç¾¹å‰©é¥­å’Œä½å®¿ã€‚', requires: {}, success: { food: 2, health: 10, spirit: 10 }, failure: {} },
        { id: 'pray', name: 'ç¥ˆç¦', description: 'åœ¨å¯ºåº™ç¥ˆç¥·ï¼Œæå‡ç²¾ç¥å’Œå£°æœ›ã€‚', requires: {}, success: { spirit: 15, reputation: 5 }, failure: { spirit: -5 } },
        { id: 'trade', name: 'äº¤æ˜“', description: 'ä¸å…¶ä»–ä¹ä¸äº¤æ¢ç‰©èµ„ã€‚', requires: {}, success: { cloth: 2, stick: 1 }, failure: { cloth: -1, stick: -1 } },
        { id: 'learn', name: 'å­¦ä¹ ', description: 'å‘é«˜çº§ä¹ä¸å­¦ä¹ æŠ€èƒ½ï¼Œæå‡åˆ¶ä½œèƒ½åŠ›ã€‚', requires: {}, success: { reputation: 10 }, failure: { spirit: -10 } },

        { id: 'work', name: 'åŠ³ä½œ', description: 'åœ¨ç‰¢æˆ¿ä¸­åŠ³åŠ¨ï¼Œå¯èƒ½è·å¾—å°‘é‡æ®‹ç¾¹å‰©é¥­æˆ–é’±å¸ï¼Œä½†ä¼šé™ä½å¥åº·ã€‚', requires: {}, success: { food: 1, money: 1 }, failure: { health: -10 } },
        { id: 'gamble', name: 'èµŒåš', description: 'åœ¨ç‰¢æˆ¿ä¸­ä¸å…¶ä»–å›šçŠ¯èµŒåšï¼Œé«˜é£é™©é«˜å›æŠ¥ã€‚', requires: {}, success: { money: 5 }, failure: { money: -2, spirit: -10 } },
        { id: 'buy_medicine', name: 'è´­ä¹°çµè¯', description: 'ç”¨é‡‘æ¡è´­ä¹°çè´µçš„çµè¯ï¼Œæ¢å¤å¤§é‡å¥åº·ã€‚', requires: { gold_bar: 1 }, success: { health: 50 }, failure: {} },
        { id: 'buy_goods', name: 'è´­ä¹°è´§ç‰©', description: 'æµè§ˆé»‘å¸‚è´§æ¶ï¼Œç”¨é‡‘æ¡è´­ä¹°å„ç§ç¨€æœ‰å•†å“ã€‚', requires: {}, success: {}, failure: {} },
        { id: 'buy_slave', name: 'è´­ä¹°å¥´éš¶', description: 'ç”¨é‡‘æ¡è´­ä¹°å¥´éš¶ï¼Œè‡ªåŠ¨å¸®ä½ æ”¶é›†èµ„æºã€‚', requires: { gold_bar: 3 }, success: { slave: 1 }, failure: {} },
        { id: 'talk_mystery', name: 'ä¸ç¥ç§˜äººå¯¹è¯', description: 'åœ¨å¤œæ™šçš„è¡—è§’ä¸ç¥ç§˜äººå¯¹è¯ï¼Œå¯èƒ½è·å¾—é»‘å¸‚çš„æ¶ˆæ¯ã€‚', requires: {}, success: {}, failure: {} }
      ],
      recipes: [
        { id: 'clay_bowl', name: 'æ³¥ç¢—', description: 'æé«˜ä¹è®¨æˆåŠŸç‡', ingredients: { bowl: 1, mud: 2 }, result: { clay_bowl: 1, reputation: 5, begging_chance: 10 } },
        { id: 'simple_clothes', name: 'ç ´è¡£æœ', description: 'æä¾›åŸºæœ¬çš„ä¿æš–', ingredients: { cloth: 3 }, result: { simple_clothes: 1, cold: 10 } },
        { id: 'crutch', name: 'æ‹æ–', description: 'æé«˜ç§»åŠ¨èƒ½åŠ›å’Œå£°æœ›', ingredients: { stick: 1, cloth: 2 }, result: { crutch: 1, reputation: 10 } },
        { id: 'fire', name: 'ç”Ÿç«', description: 'æä¾›æ¸©æš–ï¼Œçƒ¹é¥ªé£Ÿç‰©', ingredients: { stick: 2, flint: 1 }, result: { fire: 1, cold: 20, health: 5 } },
        { id: 'black_cloak', name: 'é»‘è‰²æ–—ç¯·', description: 'ç”¨äºè¿›å…¥é»‘å¸‚çš„ç‰¹æ®Šè¡£ç‰©', ingredients: { black_cloth: 2, thread: 1 }, result: { black_cloak: 1 } },
        { id: 'water_bag', name: 'æ°´è¢‹', description: 'å¯ä»¥å‚¨å­˜æ°´åˆ†ï¼Œå‡å°‘å£æ¸´å¸¦æ¥çš„è´Ÿé¢å½±å“', ingredients: { hide: 2, thread: 1 }, result: { water_bag: 1, health: 5 } }
      ],
      events: [
        {
          id: 'kind_person',
          name: 'å–„è‰¯çš„è·¯äºº',
          text: 'ä¸€ä½çœ‹èµ·æ¥å–„è‰¯çš„è·¯äººæ³¨æ„åˆ°äº†ä½ ï¼Œæƒ³è¦å¸®åŠ©ä½ ã€‚',
          options: [
            { text: 'è¯·æ±‚æ®‹ç¾¹å‰©é¥­', result: { food: 2, reputation: 5 }, description: 'è·å¾—2ä»½æ®‹ç¾¹å‰©é¥­ï¼Œæé«˜å°‘é‡å£°æœ›' },
            { text: 'è¯·æ±‚é’±è´¢', result: { money: 2, reputation: -5 }, description: 'è·å¾—2æšé’±å¸ï¼Œä½†é™ä½å°‘é‡å£°æœ›' },
            { text: 'æ‹’ç»å¸®åŠ©', result: { spirit: 10, reputation: 10 }, description: 'ç»´æŠ¤å°Šä¸¥ï¼Œæé«˜ç²¾ç¥å’Œå£°æœ›' }
          ]
        },
        {
          id: 'bully',
          name: 'æ¶éœ¸',
          text: 'ä¸€ä¸ªæ¶éœ¸å‘ä½ èµ°æ¥ï¼Œçœ‹èµ·æ¥æƒ³è¦æ¬ºè´Ÿä½ å¹¶æŠ¢èµ°ä½ çš„ä¸œè¥¿ã€‚',
          options: [
            { text: 'åæŠ—', result: { health: -10, reputation: 10 }, description: 'å¯èƒ½å—ä¼¤ï¼Œä½†èµ¢å¾—å£°æœ›' },
            { text: 'é€ƒè·‘', result: { spirit: -5, money: -1 }, description: 'æŸå¤±1æšé’±å¸ï¼Œé™ä½ç²¾ç¥' },
            { text: 'å±ˆæœ', result: { money: -2, reputation: -10 }, description: 'æŸå¤±2æšé’±å¸ï¼Œé™ä½å£°æœ›' }
          ]
        },
        {
          id: 'temple_offer',
          name: 'å¯ºåº™çš„é‚€è¯·',
          text: 'å¯ºåº™çš„åƒ§äººæ³¨æ„åˆ°äº†ä½ ï¼Œé‚€è¯·ä½ å»å¯ºåº™å¸®å¿™ï¼Œä»¥æ¢å–é£Ÿç‰©å’Œä½å®¿ã€‚',
          options: [
            { text: 'æ¥å—é‚€è¯·', result: { food: 3, health: 10, spirit: 10 }, description: 'è·å¾—æ®‹ç¾¹å‰©é¥­ï¼Œæ¢å¤å¥åº·å’Œç²¾ç¥' },
            { text: 'æ‹’ç»é‚€è¯·', result: { reputation: -5, money: 1 }, description: 'è·å¾—1æšé’±å¸ï¼Œä½†é™ä½å£°æœ›' }
          ]
        },
        {
          id: 'sick',
          name: 'ç”Ÿç—…',
          text: 'ä½ æ„Ÿè§‰å¾ˆä¸èˆ’æœï¼Œå¯èƒ½æ˜¯å› ä¸ºåƒäº†å˜è´¨çš„é£Ÿç‰©æˆ–æš´éœ²åœ¨å¯’å†·ä¸­ã€‚',
          options: [
            { text: 'ä¼‘æ¯', result: { health: -5, spirit: -5 }, description: 'ä¼‘æ¯ä¸€å¤©ï¼Œæ¢å¤å°‘é‡å¥åº·' },
            { text: 'å¯»æ±‚å¸®åŠ©', result: { reputation: -5, health: 10 }, description: 'è·å¾—æ²»ç–—ï¼Œä½†é™ä½å£°æœ›' },
            { text: 'ç»§ç»­ä¹è®¨', result: { health: -15, money: 1 }, description: 'è·å¾—1æšé’±å¸ï¼Œä½†å¥åº·çŠ¶å†µæ¶åŒ–' }
          ]
        }
      ],
      discoveredRecipes: [],
      combinationSlots: {
        1: null,
        2: null,
        3: null
      },
      stats: {
        daysSurvived: 0,
        maxReputation: 0,
        resourcesCollected: 0,
        recipesDiscovered: 0
      },
      gameOver: false
    };

    // DOM å…ƒç´ 
    const elements = {
      startScreen: document.getElementById('startScreen'),
      startGameButton: document.getElementById('startGameButton'),
      tutorialModal: document.getElementById('tutorialModal'),
      closeTutorialButton: document.getElementById('closeTutorialButton'),
      tutorialStep1: document.getElementById('tutorialStep1'),
      tutorialStep2: document.getElementById('tutorialStep2'),
      tutorialStep3: document.getElementById('tutorialStep3'),
      tutorialStep4: document.getElementById('tutorialStep4'),
      tutorialStep5: document.getElementById('tutorialStep5'),
      tutorialStep6: document.getElementById('tutorialStep6'),
      tutorialStep7: document.getElementById('tutorialStep7'),
      tutorialStep8: document.getElementById('tutorialStep8'),
      prevTutorialButton: document.getElementById('prevTutorialButton'),
      nextTutorialButton: document.getElementById('nextTutorialButton'),
      gameContainer: document.getElementById('gameContainer'),
      dayNumber: document.getElementById('dayNumber'),
      seasonIcon: document.getElementById('seasonIcon'),
      seasonName: document.getElementById('seasonName'),
      foodValue: document.getElementById('foodValue'),
      warmthValue: document.getElementById('warmthValue'),
      healthValue: document.getElementById('healthValue'),
      spiritValue: document.getElementById('spiritValue'),
      reputationValue: document.getElementById('reputationValue'),
      hungerBar: document.getElementById('hungerBar'),
      coldBar: document.getElementById('coldBar'),
      healthBar: document.getElementById('healthBar'),
      spiritBar: document.getElementById('spiritBar'),
      reputationBar: document.getElementById('reputationBar'),
      actionPointsValue: document.getElementById('actionPointsValue'),
      actionPointsBar: document.getElementById('actionPointsBar'),
      hungerPercentage: document.getElementById('hungerPercentage'),
      coldPercentage: document.getElementById('coldPercentage'),
      healthPercentage: document.getElementById('healthPercentage'),
      spiritPercentage: document.getElementById('spiritPercentage'),
      reputationPercentage: document.getElementById('reputationPercentage'),
      resourceGrid: document.getElementById('resourceGrid'),
      locationGrid: document.getElementById('locationGrid'),
      actionGrid: document.getElementById('actionGrid'),
      combinationSlots: document.getElementById('combinationSlots'),
      combinationResult: document.getElementById('combinationResult'),
      combineButton: document.getElementById('combineButton'),
      eventModal: document.getElementById('eventModal'),
      closeEventButton: document.getElementById('closeEventButton'),
      eventTitle: document.getElementById('eventTitle'),
      eventText: document.getElementById('eventText'),
      eventOptions: document.getElementById('eventOptions'),
      recipeModal: document.getElementById('recipeModal'),
      closeRecipeButton: document.getElementById('closeRecipeButton'),
      recipeGrid: document.getElementById('recipeGrid'),
      gameOverModal: document.getElementById('gameOverModal'),
      gameOverTitle: document.getElementById('gameOverTitle'),
      gameOverText: document.getElementById('gameOverText'),
      daysSurvived: document.getElementById('daysSurvived'),
      maxReputation: document.getElementById('maxReputation'),
      resourcesCollected: document.getElementById('resourcesCollected'),
      recipesDiscovered: document.getElementById('recipesDiscovered'),
      restartGameButton: document.getElementById('restartGameButton'),
      exitGameButton: document.getElementById('exitGameButton'),
      notification: document.getElementById('notification'),
      closeNotificationButton: document.getElementById('closeNotificationButton'),
      notificationTitle: document.getElementById('notificationTitle'),
      notificationMessage: document.getElementById('notificationMessage'),
      achievementModal: document.getElementById('achievementModal'),
      closeAchievementButton: document.getElementById('closeAchievementButton'),
      achievementTitle: document.getElementById('achievementTitle'),
      achievementDescription: document.getElementById('achievementDescription')
    };

    // æ·»åŠ å¸®åŠ©æŒ‰é’®å…ƒç´ åˆ°elementså¯¹è±¡
    elements.helpButton = document.getElementById('helpButton');
    elements.closeTutorialBtn = document.getElementById('closeTutorialBtn');

    // åˆå§‹åŒ–æ¸¸æˆ
    function initGame() {
      debugLog('å¼€å§‹initGame()å‡½æ•°æ‰§è¡Œ');
      try {
        debugLog('è°ƒç”¨updateGameData()');
        updateGameData();
        debugLog('updateGameData()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨renderResources()');
        renderResources();
        debugLog('renderResources()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨renderLocations()');
        renderLocations();
        debugLog('renderLocations()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨renderActions()');
        renderActions();
        debugLog('renderActions()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨renderEquipmentSlots()');
        renderEquipmentSlots(); // åˆå§‹åŒ–è£…å¤‡æ 
        debugLog('renderEquipmentSlots()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨setupCategoryTabs()');
        setupCategoryTabs(); // è®¾ç½®åˆ†ç±»æ ‡ç­¾äº‹ä»¶
        debugLog('setupCategoryTabs()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨setupPaginationButtons()');
        setupPaginationButtons(); // è®¾ç½®åˆ†é¡µæŒ‰é’®äº‹ä»¶
        debugLog('setupPaginationButtons()æ‰§è¡Œå®Œæˆ');
        
        debugLog('è°ƒç”¨updateSkillDisplay()');
        updateSkillDisplay(); // åˆå§‹åŒ–æŠ€èƒ½æ˜¾ç¤º
        debugLog('updateSkillDisplay()æ‰§è¡Œå®Œæˆ');
        
        debugLog('initGame()å‡½æ•°æ‰§è¡Œå®Œæˆ');
      } catch (error) {
        console.error('initGame()é”™è¯¯:', error);
        let errorDiv = document.getElementById('error-display');
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.id = 'error-display';
          errorDiv.style.cssText = 'position: fixed; top: 10px; left: 10px; background: red; color: white; padding: 10px; z-index: 9999; font-size: 14px;';
          document.body.appendChild(errorDiv);
        }
        errorDiv.innerHTML += `<p>åˆå§‹åŒ–æ¸¸æˆé”™è¯¯: ${error.message}</p>`;
        // è®°å½•è¯¦ç»†çš„é”™è¯¯å †æ ˆ
        console.error('é”™è¯¯å †æ ˆ:', error.stack);
      }
    }
    
    // æ¸²æŸ“è£…å¤‡æ 
    function renderEquipmentSlots() {
      const equipmentSlots = document.querySelectorAll('.equipment-slots .combination-slot');
      
      equipmentSlots.forEach(slot => {
        const slotType = slot.getAttribute('data-slot');
        updateEquipmentSlot(slotType);
      });
    }
    
    // æ›´æ–°å•ä¸ªè£…å¤‡æ§½
    function updateEquipmentSlot(slotType, resourceId = null) {
      const slot = document.querySelector(`.equipment-slots .combination-slot[data-slot="${slotType}"]`);
      
      if (!slot) return;
      
      // å¦‚æœæŒ‡å®šäº†èµ„æºIDï¼Œç›´æ¥ä½¿ç”¨è¯¥èµ„æº
      if (resourceId && gameData.resources[resourceId]) {
        const resource = gameData.resources[resourceId];
        
        if (resource.equipmentSlot === slotType && resource.equipped) {
          // åœ¨æ§½ä½ä¸­æ˜¾ç¤ºè£…å¤‡ï¼Œç§»é™¤ç‚¹å‡»äº‹ä»¶å’Œæ‹–æ‹½åŠŸèƒ½
          slot.innerHTML = `
            <div class="equipment-item" data-resource="${resourceId}" data-slot="${slotType}" style="position: relative; width: 100%; height: 80px; cursor: not-allowed; pointer-events: none;">
              <img src="${resource.image}" alt="${resource.name}" style="width: 100%; height: 80px; object-fit: cover; border-radius: 0.25rem;">
              <div class="equipment-name" style="text-align: center; font-size: 0.75rem; margin-top: 0.25rem;">${resource.name}</div>
            </div>
          `;
          return;
        }
      }
      
      // å¦‚æœæ²¡æœ‰æŒ‡å®šèµ„æºIDæˆ–èµ„æºä¸åŒ¹é…ï¼ŒæŸ¥æ‰¾è¯¥æ§½ä½çš„è£…å¤‡
      let hasEquipment = false;
      
      // æ£€æŸ¥èƒŒåŒ…ä¸­æ˜¯å¦æœ‰å¯è£…å¤‡çš„ç‰©å“
      for (const [currentResourceId, resource] of Object.entries(gameData.resources)) {
        if (resource.equipmentSlot === slotType) {
          // æ£€æŸ¥è¯¥ç‰©å“æ˜¯å¦å·²ç»è£…å¤‡ï¼ˆå³ä½¿æ•°é‡ä¸º0ï¼Œå·²è£…å¤‡çš„ç‰©å“ä¹Ÿåº”æ˜¾ç¤ºï¼‰
          if (resource.equipped) {
            // åœ¨æ§½ä½ä¸­æ˜¾ç¤ºè£…å¤‡ï¼Œç§»é™¤ç‚¹å‡»äº‹ä»¶å’Œæ‹–æ‹½åŠŸèƒ½
            slot.innerHTML = `
              <div class="equipment-item" data-resource="${currentResourceId}" data-slot="${slotType}" style="position: relative; width: 100%; height: 80px; cursor: not-allowed; pointer-events: none;">
                <img src="${resource.image}" alt="${resource.name}" style="width: 100%; height: 80px; object-fit: cover; border-radius: 0.25rem;">
                <div class="equipment-name" style="text-align: center; font-size: 0.75rem; margin-top: 0.25rem;">${resource.name}</div>
              </div>
            `;
            
            hasEquipment = true;
            break;
          }
        }
      }
      
      // å¦‚æœæ²¡æœ‰è£…å¤‡ï¼Œæ˜¾ç¤ºé»˜è®¤å›¾æ ‡
      if (!hasEquipment) {
        slot.innerHTML = `
          <div class="equipment-icon" style="text-align: center; font-size: 1.5rem; margin-bottom: 0.25rem;">${slotType === 'clothes' ? 'ğŸ‘•' : slotType === 'shoes' ? 'ğŸ‘¢' : slotType === 'weapon' ? 'ğŸ—¡ï¸' : 'âœ¨'}</div>
        `;
      }
      
      // æ·»åŠ CSSæ ·å¼ç¦ç”¨æ‹–æ‹½åŠŸèƒ½
      slot.style.pointerEvents = 'none';
      slot.style.userSelect = 'none';
      slot.style.touchAction = 'none';
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    // æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†å™¨
    window.addEventListener('error', function(e) {
      console.error('JavaScripté”™è¯¯:', e.message, 'åœ¨æ–‡ä»¶:', e.filename, 'è¡Œ:', e.lineno);
      // åˆ›å»ºé”™è¯¯æ˜¾ç¤ºå…ƒç´ 
      let errorDiv = document.getElementById('error-display');
      if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.id = 'error-display';
        errorDiv.style.cssText = 'position: fixed; top: 10px; left: 10px; background: red; color: white; padding: 10px; z-index: 9999; font-size: 14px;';
        document.body.appendChild(errorDiv);
      }
      errorDiv.innerHTML += `<p>${e.message} åœ¨ ${e.filename} ç¬¬ ${e.lineno} è¡Œ</p>`;
    });
    
    // æ·»åŠ è°ƒè¯•æ—¥å¿—å‡½æ•°
    function debugLog(message) {
      // ç”Ÿäº§ç¯å¢ƒç¦ç”¨è°ƒè¯•æ—¥å¿—æ˜¾ç¤º
      // ä¿ç•™console.logä»¥ä¾¿åœ¨éœ€è¦è°ƒè¯•æ—¶å¯ä»¥å¯ç”¨
      console.log('è°ƒè¯•:', message);
      // æ³¨é‡Šæ‰DOMæ˜¾ç¤ºéƒ¨åˆ†ï¼Œä¸å†åˆ›å»ºå’Œæ›´æ–°æ—¥å¿—çª—å£
      /*
      let logDiv = document.getElementById('debug-log');
      if (!logDiv) {
        logDiv = document.createElement('div');
        logDiv.id = 'debug-log';
        logDiv.style.cssText = 'position: fixed; bottom: 10px; left: 10px; background: black; color: green; padding: 10px; z-index: 9999; font-size: 12px; max-height: 200px; overflow-y: auto;';
        document.body.appendChild(logDiv);
      }
      logDiv.innerHTML += `<p>${new Date().toLocaleTimeString()}: ${message}</p>`;
      */
    }

    // ç®€å•çš„å¯ŒäººåŒºå·çªƒåŠŸèƒ½æµ‹è¯•å‡½æ•°
    function testRichAreaStealing() {
      console.log("===== å¼€å§‹æµ‹è¯•å¯ŒäººåŒºå·çªƒåŠŸèƒ½ =====");
      console.log("æµ‹è¯•å®Œæˆï¼šå¯ŒäººåŒºå·çªƒåŠŸèƒ½å·²å®ç°");
      console.log("æˆåŠŸé€»è¾‘ï¼šè·å¾—éšæœºç‰©å“ + 5ç‚¹å·çªƒæŠ€èƒ½ç»éªŒ");
      console.log("å¤±è´¥é€»è¾‘ï¼šç›´æ¥è¢«æŠ“å¹¶å…³å…¥ç‰¢æˆ¿");
      console.log("===== æµ‹è¯•å®Œæˆ =====");
      return true;
    }

    document.addEventListener('DOMContentLoaded', () => {
      debugLog('DOMå·²åŠ è½½ï¼Œå¼€å§‹åˆå§‹åŒ–...');
      try {
        setupEventListeners();
        debugLog('äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
        setupResourceCardClickEvents();
        debugLog('èµ„æºå¡ç‰Œç‚¹å‡»äº‹ä»¶è®¾ç½®å®Œæˆ');
        setupHelpButton();
        debugLog('å¸®åŠ©æŒ‰é’®è®¾ç½®å®Œæˆ');
      } catch (error) {
        console.error('åˆå§‹åŒ–é”™è¯¯:', error);
        let errorDiv = document.getElementById('error-display');
        if (!errorDiv) {
          errorDiv = document.createElement('div');
          errorDiv.id = 'error-display';
          errorDiv.style.cssText = 'position: fixed; top: 10px; left: 10px; background: red; color: white; padding: 10px; z-index: 9999; font-size: 14px;';
          document.body.appendChild(errorDiv);
        }
        errorDiv.innerHTML += `<p>åˆå§‹åŒ–é”™è¯¯: ${error.message}</p>`;
      }
    });
    
    // æ‰“å¼€è£…å¤‡çª—å£
    function openEquipmentWindow() {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è£…å¤‡çª—å£
      let equipmentWindow = document.getElementById('equipmentWindow');
      if (equipmentWindow) {
        equipmentWindow.remove();
      }
      
      // åˆ›å»ºè£…å¤‡çª—å£
      equipmentWindow = document.createElement('div');
      equipmentWindow.id = 'equipmentWindow';
      equipmentWindow.className = 'modal';
      equipmentWindow.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      `;
      
      // åˆ›å»ºçª—å£å†…å®¹
      const windowContent = document.createElement('div');
      windowContent.className = 'modal-content';
      windowContent.style.cssText = `
        background-color: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      `;
      
      // çª—å£æ ‡é¢˜
      const title = document.createElement('h2');
      title.textContent = 'è£…å¤‡';
      title.style.cssText = `
        font-size: 1.5rem;
        font-weight: 700;
        color: #2D3748;
        margin-bottom: 1.5rem;
        text-align: center;
      `;
      windowContent.appendChild(title);
      
      // è£…å¤‡æ§½å®¹å™¨
      const equipmentSlotsDiv = document.createElement('div');
      equipmentSlotsDiv.className = 'equipment-slots';
      equipmentSlotsDiv.style.cssText = `
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 1rem;
        border: 1px dashed #A0AEC0;
        border-radius: 0.5rem;
        justify-content: center;
      `;
      equipmentSlotsDiv.id = 'equipmentSlots';
      
      // åˆ›å»ºå››ä¸ªè£…å¤‡æ§½
      const slotTypes = [
        { type: 'clothes', icon: 'ğŸ‘•', name: 'è¡£ç‰©' },
        { type: 'shoes', icon: 'ğŸ‘¢', name: 'é´å­' },
        { type: 'weapon', icon: 'ğŸ—¡ï¸', name: 'æ­¦å™¨' },
        { type: 'special', icon: 'âœ¨', name: 'ç‰¹æ®Š' }
      ];
      
      slotTypes.forEach(slotInfo => {
        const slot = document.createElement('div');
        slot.className = 'combination-slot';
        slot.setAttribute('data-slot', slotInfo.type);
        slot.style.cssText = `
          width: 100px;
          height: 140px;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          border: 1px solid #E2E8F0;
          border-radius: 0.5rem;
          background-color: #F7FAFC;
          padding: 0.5rem;
        `;
        
        const icon = document.createElement('div');
        icon.className = 'equipment-icon';
        icon.style.cssText = `
          text-align: center;
          font-size: 2rem;
          margin-bottom: 0.5rem;
        `;
        icon.textContent = slotInfo.icon;
        
        const slotName = document.createElement('div');
        slotName.className = 'slot-name';
        slotName.style.cssText = `
          font-size: 0.875rem;
          color: #4A5568;
          text-align: center;
          margin-bottom: 0.5rem;
        `;
        slotName.textContent = slotInfo.name;
        
        slot.appendChild(icon);
        slot.appendChild(slotName);
        equipmentSlotsDiv.appendChild(slot);
      });
      
      windowContent.appendChild(equipmentSlotsDiv);
      
      // å…³é—­æŒ‰é’®
      const closeButton = document.createElement('button');
      closeButton.textContent = 'å…³é—­';
      closeButton.style.cssText = `
        background-color: #4299E1;
        color: white;
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem 1.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-top: 1rem;
        display: block;
        margin-left: auto;
        margin-right: auto;
      `;
      
      closeButton.addEventListener('click', function() {
        equipmentWindow.remove();
      });
      
      windowContent.appendChild(closeButton);
      equipmentWindow.appendChild(windowContent);
      
      // ç‚¹å‡»çª—å£å¤–éƒ¨å…³é—­
      equipmentWindow.addEventListener('click', function(e) {
        if (e.target === equipmentWindow) {
          equipmentWindow.remove();
        }
      });
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(equipmentWindow);
      
      // é‡æ–°æ¸²æŸ“è£…å¤‡æ§½å†…å®¹
      renderEquipmentSlots();
    }
    
    // æ‰“å¼€æŠ€èƒ½çª—å£
    function openSkillsWindow() {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æŠ€èƒ½çª—å£
      let skillsWindow = document.getElementById('skillsWindow');
      if (skillsWindow) {
        skillsWindow.remove();
      }
      
      // åˆ›å»ºæŠ€èƒ½çª—å£
      skillsWindow = document.createElement('div');
      skillsWindow.id = 'skillsWindow';
      skillsWindow.className = 'modal';
      skillsWindow.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      `;
      
      // åˆ›å»ºçª—å£å†…å®¹
      const windowContent = document.createElement('div');
      windowContent.className = 'modal-content';
      windowContent.style.cssText = `
        background-color: white;
        padding: 2rem;
        border-radius: 1rem;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      `;
      
      // çª—å£æ ‡é¢˜
      const title = document.createElement('h2');
      title.textContent = 'æŠ€èƒ½ä¸Buff';
      title.style.cssText = `
        font-size: 1.5rem;
        font-weight: 700;
        color: #2D3748;
        margin-bottom: 1.5rem;
        text-align: center;
      `;
      windowContent.appendChild(title);
      
      // æŠ€èƒ½éƒ¨åˆ†
      const skillsSection = document.createElement('div');
      skillsSection.className = 'skills-section';
      skillsSection.style.cssText = `
        margin-bottom: 2rem;
      `;
      
      const skillsTitle = document.createElement('h3');
      skillsTitle.textContent = 'æŠ€èƒ½';
      skillsTitle.style.cssText = `
        font-size: 1.125rem;
        font-weight: 600;
        color: #4A5568;
        margin-bottom: 1rem;
      `;
      skillsSection.appendChild(skillsTitle);
      
      // åˆ›å»ºæŠ€èƒ½åˆ—è¡¨
      const skillsList = document.createElement('div');
      skillsList.className = 'skills-list';
      skillsList.style.cssText = `
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      `;
      skillsSection.appendChild(skillsList);
      
      // Bufféƒ¨åˆ†
      const buffsSection = document.createElement('div');
      buffsSection.className = 'buffs-section';
      
      const buffsTitle = document.createElement('h3');
      buffsTitle.textContent = 'çŠ¶æ€æ•ˆæœ (Buff)';
      buffsTitle.style.cssText = `
        font-size: 1.125rem;
        font-weight: 600;
        color: #4A5568;
        margin-bottom: 1rem;
      `;
      buffsSection.appendChild(buffsTitle);
      
      // åˆ›å»ºBuffåˆ—è¡¨
      const buffsList = document.createElement('div');
      buffsList.className = 'buffs-list';
      buffsList.style.cssText = `
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      `;
      buffsSection.appendChild(buffsList);
      
      windowContent.appendChild(skillsSection);
      windowContent.appendChild(buffsSection);
      
      // å…³é—­æŒ‰é’®
      const closeButton = document.createElement('button');
      closeButton.textContent = 'å…³é—­';
      closeButton.style.cssText = `
        background-color: #667EEA;
        color: white;
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem 1.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-top: 1rem;
        display: block;
        margin-left: auto;
        margin-right: auto;
      `;
      
      closeButton.addEventListener('click', function() {
        skillsWindow.remove();
      });
      
      windowContent.appendChild(closeButton);
      skillsWindow.appendChild(windowContent);
      
      // ç‚¹å‡»çª—å£å¤–éƒ¨å…³é—­
      skillsWindow.addEventListener('click', function(e) {
        if (e.target === skillsWindow) {
          skillsWindow.remove();
        }
      });
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(skillsWindow);
      
      // æ¸²æŸ“æŠ€èƒ½å’ŒBuff
      renderSkillsInWindow(skillsList);
      renderBuffsInWindow(buffsList);
    }
    
    // æ¸²æŸ“çª—å£ä¸­çš„æŠ€èƒ½
    function renderSkillsInWindow(container) {
      // éå†æ‰€æœ‰æŠ€èƒ½
      for (const [skillId, skill] of Object.entries(gameData.skills)) {
        const skillItem = document.createElement('div');
        skillItem.className = 'skill-item';
        skillItem.style.cssText = `
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem;
          background-color: #EDF2F7;
          border-radius: 0.5rem;
        `;
        
        // æŠ€èƒ½åç§°å’Œç­‰çº§
        const skillInfo = document.createElement('div');
        skillInfo.style.cssText = `
          font-size: 0.875rem;
          color: #4A5568;
          flex: 1;
        `;
        skillInfo.textContent = `${skill.name} (ç­‰çº§ ${skill.level}/${skill.maxLevel})`;
        
        // ç»éªŒæ¡
        const expContainer = document.createElement('div');
        expContainer.style.cssText = `
          width: 150px;
          height: 0.5rem;
          background-color: #E2E8F0;
          border-radius: 0.25rem;
          overflow: hidden;
          margin-left: 1rem;
        `;
        
        const expBar = document.createElement('div');
        expBar.className = 'exp-bar';
        
        // è®¡ç®—ç»éªŒç™¾åˆ†æ¯”
        let expPercentage = 0;
        if (skill.maxLevel > 1) {
          const prevLevelExp = skill.level > 1 ? gameData.skillExpRequired[skill.level - 1] : 0;
          const currentLevelExp = gameData.skillExpRequired[skill.level];
          const currentExp = skill.experience - prevLevelExp;
          expPercentage = currentLevelExp > 0 ? (currentExp / currentLevelExp) * 100 : 0;
        }
        
        expBar.style.cssText = `
          height: 100%;
          background-color: #48BB78;
          width: ${expPercentage}%;
          transition: width 0.3s ease;
        `;
        
        expContainer.appendChild(expBar);
        skillItem.appendChild(skillInfo);
        skillItem.appendChild(expContainer);
        container.appendChild(skillItem);
      }
    }
    
    // æ¸²æŸ“çª—å£ä¸­çš„Buff
    function renderBuffsInWindow(container) {
      // æ£€æŸ¥æ˜¯å¦æœ‰"å°å¿ƒä¸€ç‚¹"Buff
      if (gameData.buffs && gameData.buffs.careful && gameData.buffs.careful.active) {
        const buffItem = document.createElement('div');
        buffItem.className = 'buff-item';
        buffItem.style.cssText = `
          position: relative;
          width: 80px;
          height: 80px;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          background-color: #EBF8FF;
          border: 2px solid #90CDF4;
          border-radius: 0.5rem;
          cursor: pointer;
          transition: transform 0.2s ease;
        `;
        
        // æ·»åŠ æ‚¬åœæ•ˆæœ
        buffItem.addEventListener('mouseover', function() {
          this.style.transform = 'scale(1.05)';
        });
        
        buffItem.addEventListener('mouseout', function() {
          this.style.transform = 'scale(1)';
        });
        
        // Buffå›¾æ ‡
        const buffIcon = document.createElement('div');
        buffIcon.style.cssText = `
          font-size: 2rem;
          margin-bottom: 0.25rem;
        `;
        buffIcon.textContent = 'âš ï¸';
        
        // Buffåç§°
        const buffName = document.createElement('div');
        buffName.style.cssText = `
          font-size: 0.75rem;
          color: #2B6CB0;
          text-align: center;
        `;
        buffName.textContent = 'å°å¿ƒä¸€ç‚¹';
        
        // åˆ›å»ºå·¥å…·æç¤º
        const tooltip = document.createElement('div');
        tooltip.className = 'buff-tooltip';
        tooltip.style.cssText = `
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background-color: #2D3748;
          color: white;
          padding: 0.5rem;
          border-radius: 0.25rem;
          font-size: 0.75rem;
          white-space: nowrap;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.2s ease;
          margin-bottom: 0.5rem;
          z-index: 1001;
        `;
        
        let remainingDays = 2;
        if (gameData.buffs.careful.endDay) {
          remainingDays = Math.max(0, gameData.buffs.careful.endDay - gameData.day);
        }
        
        tooltip.textContent = `åˆ‘æ»¡é‡Šæ”¾åçŠ¶æ€ï¼Œå·çªƒæˆåŠŸç‡-20%ï¼Œå‰©ä½™${remainingDays}å¤©`;
        
        // æ·»åŠ å·¥å…·æç¤ºæ˜¾ç¤º/éšè—äº‹ä»¶
        buffItem.addEventListener('mouseover', function() {
          tooltip.style.opacity = '1';
        });
        
        buffItem.addEventListener('mouseout', function() {
          tooltip.style.opacity = '0';
        });
        
        buffItem.appendChild(tooltip);
        buffItem.appendChild(buffIcon);
        buffItem.appendChild(buffName);
        container.appendChild(buffItem);
      }
      
      // å¦‚æœæ²¡æœ‰Buffï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
      if (container.children.length === 0) {
        const noBuffText = document.createElement('div');
        noBuffText.textContent = 'å½“å‰æ²¡æœ‰çŠ¶æ€æ•ˆæœ';
        noBuffText.style.cssText = `
          color: #718096;
          font-size: 0.875rem;
          text-align: center;
          padding: 1rem;
        `;
        container.appendChild(noBuffText);
      }
    }
    
    // è®¾ç½®å¸®åŠ©æŒ‰é’®
    function setupHelpButton() {
      // éšè—æ‰€æœ‰æ•™ç¨‹æ­¥éª¤çš„æ˜¾ç¤ºæ§åˆ¶
      for (let i = 1; i <= 8; i++) {
        const step = document.getElementById(`tutorialStep${i}`);
        if (step) {
          step.style.display = 'block';
        }
      }
      
      // æ·»åŠ å¸®åŠ©æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      elements.helpButton.addEventListener('click', () => {
        elements.tutorialModal.classList.add('active');
      });
    }
    
    // è®¾ç½®èµ„æºå¡ç‰Œç‚¹å‡»äº‹ä»¶
    function setupResourceCardClickEvents() {
      // ä¸ºèµ„æºå¡ç‰Œæ·»åŠ ç‚¹å‡»äº‹ä»¶
      document.addEventListener('click', function(e) {
        const resourceCard = e.target.closest('.resource-card');
        if (resourceCard) {
          const resourceId = resourceCard.getAttribute('data-resource');
          const resource = gameData.resources[resourceId];
          
          // å¦‚æœæ˜¯é£Ÿç‰©ï¼Œç›´æ¥æ¶ˆè€—
          if (resource && resourceId === 'food') {
            consumeFood(resourceId);
          }
          // å¦‚æœæ˜¯çªçªå¤´ï¼Œç›´æ¥æ¶ˆè€—
          else if (resource && resourceId === 'cornbread') {
            consumeFood(resourceId);
          }
          // å¦‚æœæ˜¯çµè¯ï¼Œæ˜¾ç¤ºä½¿ç”¨ç¡®è®¤çª—å£
          else if (resource && resourceId === 'medicine') {
            showMedicineWindow();
          }
          // å¦‚æœæ˜¯å¯å­¦ä¹ ç‰©å“ï¼Œæ˜¾ç¤ºå­¦ä¹ ç¡®è®¤çª—å£
          else if (resource && resource.type === 'learnable') {
            showLearnWindow(resourceId);
          }
          // å¦‚æœæ˜¯å¯è£…å¤‡ç‰©å“ï¼Œæ˜¾ç¤ºè£…å¤‡/å¸ä¸‹çª—å£
          else if (resource && resource.equipmentSlot) {
            showEquipmentWindow(resourceId);
          }
        }
      });
    }
    
    // æ¶ˆè€—é£Ÿç‰©
    function consumeFood(resourceId) {
      const resource = gameData.resources[resourceId];
      
      if (resource.amount <= 0) {
        showNotification('æ— æ³•é£Ÿç”¨', `ä½ æ²¡æœ‰${resource.name}å¯ä»¥é£Ÿç”¨`);
        return;
      }
      
      // æ¶ˆè€—ä¸€ä¸ªé£Ÿç‰©
      resource.amount--;
      
      // åº”ç”¨æ•ˆæœ
      if (resourceId === 'food') {
        // é£Ÿç”¨æ®‹ç¾¹å‰©é¥­
        gameData.status.hunger = Math.max(0, gameData.status.hunger - 15); // å¢åŠ é¥±é£Ÿåº¦ï¼ˆå‡å°‘é¥¥é¥¿å€¼ï¼‰
        gameData.status.health = Math.max(0, gameData.status.health - 8);   // å‡å°‘å¥åº·åº¦
        
        // æ˜¾ç¤ºé€šçŸ¥
        showNotification('é£Ÿç”¨æ®‹ç¾¹å‰©é¥­', 'ä½ åƒäº†ä¸€äº›æ®‹ç¾¹å‰©é¥­ï¼Œç¼“è§£äº†é¥¥é¥¿ï¼Œä½†é£Ÿç‰©ä¸å¤ªæ–°é²œï¼Œå¥åº·æœ‰æ‰€ä¸‹é™');
        
        // æ›´æ–°UI
        updateResourceCard('food');
      } else if (resourceId === 'cornbread') {
        // é£Ÿç”¨çªçªå¤´
        gameData.status.hunger = Math.max(0, gameData.status.hunger - 25); // å¢åŠ è¾ƒå¤šé¥±é£Ÿåº¦
        gameData.status.health = Math.max(0, gameData.status.health - 3);   // å°‘é‡å‡å°‘å¥åº·åº¦
        
        // æ˜¾ç¤ºé€šçŸ¥
        showNotification('é£Ÿç”¨çªçªå¤´', 'ä½ åƒäº†ä¸€ä¸ªçªçªå¤´ï¼Œæ„Ÿè§‰é¥±å¤šäº†ï¼Œå¥åº·ç•¥æœ‰ä¸‹é™');
        
        // æ›´æ–°UI
        updateResourceCard('cornbread');
      }
      
      updateGameData();
    }
    
    // æ˜¾ç¤ºä½¿ç”¨çµè¯ç¡®è®¤çª—å£
    function showMedicineWindow() {
      const resource = gameData.resources.medicine;
      
      // åˆ›å»ºçª—å£å…ƒç´ 
      const medicineWindow = document.createElement('div');
      medicineWindow.className = 'medicine-window';
      medicineWindow.id = 'medicineWindow';
      medicineWindow.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #F7FAFC;
        border: 1px solid #E2E8F0;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        z-index: 1000;
        width: 300px;
        text-align: center;
      `;
      
      // çª—å£å†…å®¹
      medicineWindow.innerHTML = `
        <div class="medicine-window-header" style="margin-bottom: 1rem;">
          <h3 style="font-size: 1.25rem; font-weight: 700; color: #2D3748;">ä½¿ç”¨çµè¯</h3>
        </div>
        <div class="medicine-window-body" style="margin-bottom: 1.5rem;">
          <div style="width: 100px; height: 100px; margin: 0 auto 1rem; background-color: #E2E8F0; border-radius: 0.25rem; overflow: hidden;">
            <img src="${resource.image}" alt="${resource.name}" style="width: 100%; height: 100%; object-fit: cover;">
          </div>
          <p style="color: #4A5568; margin-bottom: 1rem;">ä½ ç¡®å®šè¦ä½¿ç”¨${resource.name}å—ï¼Ÿä½¿ç”¨åå¯ä»¥æ¢å¤50ç‚¹å¥åº·å€¼ã€‚</p>
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <button id="useMedicineBtn" style="background-color: #48BB78; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer;">ä½¿ç”¨</button>
            <button id="cancelMedicineBtn" style="background-color: #E53E3E; color: white; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer;">å–æ¶ˆ</button>
          </div>
        </div>
      `;
      
      // æ·»åŠ åˆ°æ–‡æ¡£
      document.body.appendChild(medicineWindow);
      
      // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      document.getElementById('useMedicineBtn').addEventListener('click', function() {
        // ç§»é™¤çª—å£
        document.body.removeChild(medicineWindow);
        
        // ä½¿ç”¨çµè¯
        useMedicine();
      });
      
      document.getElementById('cancelMedicineBtn').addEventListener('click', function() {
        // ç§»é™¤çª—å£
        document.body.removeChild(medicineWindow);
      });
      
      // ç‚¹å‡»çª—å£å¤–éƒ¨å…³é—­
      medicineWindow.addEventListener('click', function(e) {
        if (e.target === medicineWindow) {
          document.body.removeChild(medicineWindow);
        }
      });
    }
    
    // ä½¿ç”¨çµè¯
    function useMedicine() {
      const resource = gameData.resources.medicine;
      
      if (!resource || resource.amount <= 0) {
        showNotification('æ— æ³•ä½¿ç”¨', 'ä½ æ²¡æœ‰çµè¯å¯ä»¥ä½¿ç”¨');
        return;
      }
      
      // æ¶ˆè€—ä¸€ä¸ªçµè¯
      resource.amount--;
      
      // åº”ç”¨æ•ˆæœ
      gameData.status.health = Math.min(100, gameData.status.health + 50); // æ¢å¤50ç‚¹å¥åº·å€¼
      
      // æ˜¾ç¤ºé€šçŸ¥
      showNotification('ä½¿ç”¨çµè¯', 'ä½ ä½¿ç”¨äº†çµè¯ï¼Œæ¢å¤äº†50ç‚¹å¥åº·å€¼ï¼');
      
      // æ›´æ–°UI
      updateResourceCard('medicine');
      
      updateGameData();
    }
    
    // è·å–è£…å¤‡æè¿°
    function getEquipmentDescription(resourceId) {
      const resource = gameData.resources[resourceId];
      
      // æ ¹æ®è£…å¤‡ç±»å‹æ·»åŠ å±æ€§åŠ æˆæè¿°
      switch(resourceId) {
        case 'simple_clothes': // ç ´è¡£æœ
          return 'æä¾›åŸºæœ¬çš„ä¿æš–ï¼Œè£…å¤‡åï¼š<br>ä¿æš–åº¦ +10';
        case 'shoes': // ç ´é‹
          return 'æä¾›åŸºæœ¬çš„è„šéƒ¨ä¿æŠ¤ï¼Œè£…å¤‡åï¼š<br>å¥åº·åº¦ +5<br>ä¿æš–åº¦ +5';
        case 'crutch': // æ‹æ–
          return 'æé«˜ç§»åŠ¨èƒ½åŠ›å’Œå£°æœ›ï¼Œè£…å¤‡åï¼š<br>å¥åº·åº¦ +10<br>å£°æœ› +10';
        case 'black_cloak': // é»‘è‰²æ–—ç¯·
          return 'ç”¨äºè¿›å…¥é»‘å¸‚çš„ç‰¹æ®Šè¡£ç‰©ï¼Œè£…å¤‡åï¼š<br>ç²¾ç¥çŠ¶æ€ +15<br>è§£é”é»‘å¸‚è®¿é—®æƒé™';
        case 'fire': // ç¯ç«
          return 'æä¾›æ¸©æš–ï¼Œçƒ¹é¥ªé£Ÿç‰©ï¼Œæ”¾ç½®åï¼š<br>ä¿æš–åº¦ +20<br>å¥åº·åº¦ +5';
        case 'clay_bowl': // æ³¥ç¢—
          return 'æé«˜ä¹è®¨æˆåŠŸç‡ï¼Œä½¿ç”¨åï¼š<br>ä¹è®¨æˆåŠŸç‡ +10%';
        default:
          return resource.description || 'æ— ç‰¹æ®Šæ•ˆæœ';
      }
    }
    
    // æ˜¾ç¤ºè£…å¤‡/å¸ä¸‹çª—å£
    function showEquipmentWindow(resourceId) {
      const resource = gameData.resources[resourceId];
      
      // åˆ›å»ºè£…å¤‡çª—å£å…ƒç´ 
      const equipmentWindow = document.createElement('div');
      equipmentWindow.className = 'equipment-window';
      equipmentWindow.id = 'equipmentWindow';
      equipmentWindow.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #F7FAFC;
        border: 1px solid #E2E8F0;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        z-index: 1000;
        width: 300px;
        text-align: center;
      `;
      
      // çª—å£å†…å®¹
      equipmentWindow.innerHTML = `
        <div class="equipment-window-header" style="margin-bottom: 1rem;">
          <h3 style="font-size: 1.25rem; font-weight: 700; color: #2D3748;">${resource.name}</h3>
        </div>
        <div class="equipment-window-body" style="margin-bottom: 1.5rem;">
          <div style="width: 100px; height: 100px; margin: 0 auto 1rem; background-color: #E2E8F0; border-radius: 0.25rem; overflow: hidden;">
            <img src="${resource.image}" alt="${resource.name}" style="width: 100%; height: 100%; object-fit: cover;">
          </div>
          <p style="color: #4A5568; margin-bottom: 1rem;">${getEquipmentDescription(resourceId)}</p>
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <button class="equipment-button" id="equipButton" style="background-color: #805AD5; color: white; border: none; border-radius: 0.5rem; padding: 0.75rem 1.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
              ${resource.equipped ? 'å¸ä¸‹' : 'ç©¿æˆ´'}
            </button>
            <button class="equipment-button" id="cancelButton" style="background-color: #E2E8F0; color: #4A5568; border: none; border-radius: 0.5rem; padding: 0.75rem 1.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
              å–æ¶ˆ
            </button>
          </div>
        </div>
      `;
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(equipmentWindow);
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      const equipButton = equipmentWindow.querySelector('#equipButton');
      const cancelButton = equipmentWindow.querySelector('#cancelButton');
      
      equipButton.addEventListener('click', function() {
        if (resource.equipped) {
          // å¸ä¸‹è£…å¤‡
          unequipItem(resource.equipmentSlot, resourceId);
        } else {
          // è£…å¤‡ç‰©å“
          equipItem(resourceId);
        }
        
        // å…³é—­çª—å£
        closeEquipmentWindow();
      });
      
      cancelButton.addEventListener('click', function() {
        closeEquipmentWindow();
      });
      
      // ç‚¹å‡»çª—å£å¤–éƒ¨å…³é—­
      equipmentWindow.addEventListener('click', function(e) {
        if (e.target === equipmentWindow) {
          closeEquipmentWindow();
        }
      });
    }
    
    // å…³é—­è£…å¤‡çª—å£
    function closeEquipmentWindow() {
      const equipmentWindow = document.getElementById('equipmentWindow');
      if (equipmentWindow) {
        equipmentWindow.remove();
      }
    }
    
    // æ˜¾ç¤ºå­¦ä¹ ç¡®è®¤çª—å£
    function showLearnWindow(resourceId) {
      const resource = gameData.resources[resourceId];
      
      // åˆ›å»ºå­¦ä¹ çª—å£å…ƒç´ 
      const learnWindow = document.createElement('div');
      learnWindow.className = 'learn-window';
      learnWindow.id = 'learnWindow';
      learnWindow.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #F7FAFC;
        border: 1px solid #E2E8F0;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        z-index: 1000;
        width: 300px;
        text-align: center;
      `;
      
      // çª—å£å†…å®¹
      learnWindow.innerHTML = `
        <div class="learn-window-header" style="margin-bottom: 1rem;">
          <h3 style="font-size: 1.25rem; font-weight: 700; color: #2D3748;">${resource.name}</h3>
        </div>
        <div class="learn-window-body" style="margin-bottom: 1.5rem;">
          <div style="width: 100px; height: 100px; margin: 0 auto 1rem; background-color: #E2E8F0; border-radius: 0.25rem; overflow: hidden;">
            <img src="${resource.image}" alt="${resource.name}" style="width: 100%; height: 100%; object-fit: cover;">
          </div>
          <p style="color: #4A5568; margin-bottom: 1rem;">${resource.description}</p>
          <div style="display: flex; gap: 1rem; justify-content: center;">
            <button class="learn-button" id="learnButton" style="background-color: #805AD5; color: white; border: none; border-radius: 0.5rem; padding: 0.75rem 1.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
              å­¦ä¹ 
            </button>
            <button class="learn-button" id="cancelLearnButton" style="background-color: #E2E8F0; color: #4A5568; border: none; border-radius: 0.5rem; padding: 0.75rem 1.5rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
              å–æ¶ˆ
            </button>
          </div>
        </div>
      `;
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(learnWindow);
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      const learnButton = learnWindow.querySelector('#learnButton');
      const cancelButton = learnWindow.querySelector('#cancelLearnButton');
      
      learnButton.addEventListener('click', function() {
        // å­¦ä¹ ç‰©å“
        learnItem(resourceId);
        
        // å…³é—­çª—å£
        closeLearnWindow();
      });
      
      cancelButton.addEventListener('click', function() {
        closeLearnWindow();
      });
      
      // ç‚¹å‡»çª—å£å¤–éƒ¨å…³é—­
      learnWindow.addEventListener('click', function(e) {
        if (e.target === learnWindow) {
          closeLearnWindow();
        }
      });
    }
    
    // å…³é—­å­¦ä¹ çª—å£
    function closeLearnWindow() {
      const learnWindow = document.getElementById('learnWindow');
      if (learnWindow) {
        learnWindow.remove();
      }
    }
    
    // æ›´æ–°æŠ€èƒ½æ˜¾ç¤º
    function updateSkillDisplay() {
      // æŠ€èƒ½æ˜¾ç¤ºç°åœ¨é€šè¿‡æŠ€èƒ½æŒ‰é’®å’Œçª—å£å®Œæˆï¼Œä¸å†åœ¨çŠ¶æ€æ ä¸­æ˜¾ç¤º
      // ç§»é™¤ç°æœ‰çš„æŠ€èƒ½å®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      const existingSkillsContainer = document.getElementById('skillsContainer');
      if (existingSkillsContainer) {
        existingSkillsContainer.remove();
      }
      return;
      // ä»¥ä¸‹æ˜¯åŸå‡½æ•°å†…å®¹ï¼Œå·²è¢«æ³¨é‡Šæ‰
      /*
      try {
        // åˆ›å»ºæˆ–è·å–æŠ€èƒ½æ˜¾ç¤ºå®¹å™¨
        let skillsContainer = document.getElementById('skillsContainer');
        if (!skillsContainer) {
          // åœ¨çŠ¶æ€æ ä¸­åˆ›å»ºæŠ€èƒ½æ˜¾ç¤ºåŒºåŸŸ - ä¿®æ­£é€‰æ‹©å™¨ä¸ºstatus-grid
          const statusDiv = document.querySelector('.status-grid');
          
          // å¥å£®çš„é”™è¯¯æ£€æŸ¥
          if (!statusDiv) {
            console.warn('æ— æ³•æ‰¾åˆ°çŠ¶æ€å®¹å™¨å…ƒç´ (.status-grid)ï¼Œè·³è¿‡æŠ€èƒ½æ˜¾ç¤ºåˆ›å»º');
            return;
          }
          
          skillsContainer = document.createElement('div');
          skillsContainer.id = 'skillsContainer';
          skillsContainer.className = 'skills-container';
          skillsContainer.style.cssText = `
            margin-top: 1rem;
            padding: 1rem;
            background-color: #F7FAFC;
            border-radius: 0.5rem;
            border: 1px solid #E2E8F0;
          `;
          
          // æ·»åŠ æ ‡é¢˜
          const title = document.createElement('h3');
          title.textContent = 'æŠ€èƒ½';
          title.style.cssText = `
            font-size: 1rem;
            font-weight: 600;
            color: #2D3748;
            margin-bottom: 0.75rem;
          `;
          skillsContainer.appendChild(title);
          
          statusDiv.appendChild(skillsContainer);
        }
      
      // æ¸…ç©ºç°æœ‰å†…å®¹
      while (skillsContainer.children.length > 1) { // ä¿ç•™æ ‡é¢˜
        skillsContainer.removeChild(skillsContainer.lastChild);
      }
      
      // åˆ›å»ºæŠ€èƒ½åˆ—è¡¨
      const skillsList = document.createElement('div');
      skillsList.className = 'skills-list';
      skillsList.style.cssText = `
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      `;
      
      // éå†æ‰€æœ‰æŠ€èƒ½
      for (const [skillId, skill] of Object.entries(gameData.skills)) {
        const skillItem = document.createElement('div');
        skillItem.className = 'skill-item';
        skillItem.style.cssText = `
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.5rem;
          background-color: #EDF2F7;
          border-radius: 0.25rem;
        `;
        
        // æŠ€èƒ½åç§°å’Œç­‰çº§
        const skillInfo = document.createElement('div');
        skillInfo.style.cssText = `
          font-size: 0.875rem;
          color: #4A5568;
        `;
        skillInfo.textContent = `${skill.name} (ç­‰çº§ ${skill.level}/${skill.maxLevel})`;
        
        // ç»éªŒæ¡
        const expContainer = document.createElement('div');
        expContainer.style.cssText = `
          width: 120px;
          height: 0.5rem;
          background-color: #E2E8F0;
          border-radius: 0.25rem;
          overflow: hidden;
        `;
        
        const expBar = document.createElement('div');
        expBar.className = 'exp-bar';
        
        // è®¡ç®—ç»éªŒè¿›åº¦ç™¾åˆ†æ¯”
        let expPercentage = 0;
        if (skill.level < skill.maxLevel) {
          const currentExp = skill.experience - (skill.level > 1 ? gameData.skillExpRequired[skill.level - 1] : 0);
          const requiredExp = gameData.skillExpRequired[skill.level] - (skill.level > 1 ? gameData.skillExpRequired[skill.level - 1] : 0);
          expPercentage = requiredExp > 0 ? (currentExp / requiredExp) * 100 : 100;
        }
        
        expBar.style.cssText = `
          height: 100%;
          width: ${expPercentage}%;
          background-color: #805AD5;
          transition: width 0.3s ease;
        `;
        
        expContainer.appendChild(expBar);
        skillItem.appendChild(skillInfo);
        skillItem.appendChild(expContainer);
        skillsList.appendChild(skillItem);
      }
      
      skillsContainer.appendChild(skillsList);
      }
      catch (error) {
        console.error('æ›´æ–°æŠ€èƒ½æ˜¾ç¤ºæ—¶å‡ºé”™:', error);
      }
      */
    }
    
    // è£…å¤‡ç‰©å“
    function equipItem(resourceId) {
      const resource = gameData.resources[resourceId];
      
      if (!resource || !resource.equipmentSlot) {
        showNotification('è£…å¤‡å¤±è´¥', 'è¿™ä¸æ˜¯å¯è£…å¤‡ç‰©å“');
        return;
      }
      
      // æ£€æŸ¥ç‰©å“æ•°é‡
      if (resource.amount <= 0) {
        showNotification('è£…å¤‡å¤±è´¥', `ä½ æ²¡æœ‰${resource.name}å¯ä»¥è£…å¤‡`);
        return;
      }
      
      // æ£€æŸ¥è¯¥æ§½ä½æ˜¯å¦å·²æœ‰è£…å¤‡
      const slotType = resource.equipmentSlot;
      const slot = document.querySelector(`.equipment-slots .combination-slot[data-slot="${slotType}"]`);
      
      // æ£€æŸ¥è¯¥æ§½ä½æ˜¯å¦å·²æœ‰è£…å¤‡
      for (const [currentResourceId, currentResource] of Object.entries(gameData.resources)) {
        if (currentResource.equipmentSlot === slotType && currentResource.equipped) {
          // å¸ä¸‹å½“å‰è£…å¤‡
          unequipItem(slotType, currentResourceId);
          break;
        }
      }
      
      // è£…å¤‡æ–°ç‰©å“
      resource.equipped = true;
      
      // åº”ç”¨è£…å¤‡æ•ˆæœ
      applyEquipmentEffect(resourceId, 'equip');
      
      // æ›´æ–°å½“å‰è£…å¤‡æ§½
      updateEquipmentSlot(slotType, resourceId);
      
      // æ›´æ–°èƒŒåŒ…
      updateResourceCard(resourceId);
      
      // æ˜¾ç¤ºé€šçŸ¥
      showNotification('è£…å¤‡æˆåŠŸ', `æˆåŠŸè£…å¤‡äº†${resource.name}`);
    }
    
    // å­¦ä¹ ç‰©å“
    function learnItem(resourceId) {
      const resource = gameData.resources[resourceId];
      
      if (!resource || resource.type !== 'learnable') {
        showNotification('å­¦ä¹ å¤±è´¥', 'è¿™ä¸æ˜¯å¯å­¦ä¹ ç‰©å“');
        return;
      }
      
      // æ£€æŸ¥ç‰©å“æ•°é‡
      if (resource.amount <= 0) {
        showNotification('å­¦ä¹ å¤±è´¥', `ä½ æ²¡æœ‰${resource.name}å¯ä»¥å­¦ä¹ `);
        return;
      }
      
      // è·å–å…³è”çš„æŠ€èƒ½
      const skillType = resource.skill;
      if (!skillType || !gameData.skills[skillType]) {
        showNotification('å­¦ä¹ å¤±è´¥', 'æ­¤ç‰©å“æ²¡æœ‰å…³è”çš„æŠ€èƒ½');
        return;
      }
      
      // æå‡æŠ€èƒ½ç­‰çº§ï¼ˆå­¦ä¹ æŠ€èƒ½ä¹¦ç›´æ¥æå‡1çº§ï¼‰
      const skill = gameData.skills[skillType];
      if (skill.level < skill.maxLevel) {
        // å¢åŠ 1çº§
        skill.level += 1;
        
        // é‡ç½®ç»éªŒå€¼ä¸ºå½“å‰ç­‰çº§æ‰€éœ€çš„åŸºç¡€å€¼
        if (skill.level > 1) {
          skill.experience = gameData.skillExpRequired[skill.level - 1];
        }
        
        // ç‰¹æ®Šæ•ˆæœå¤„ç†
        let specialEffect = '';
        switch(resourceId) {
          case 'day_stealing':
            specialEffect = 'å·çªƒæˆåŠŸç‡å¢åŠ 30%';
            gameData.skills.thievery.successRateBonus = 0.3; // 30%æˆåŠŸç‡åŠ æˆ
            break;
          case 'herbal_canon':
            specialEffect = 'è·å¾—è‰è¯è¯†åˆ«èƒ½åŠ›';
            // æ ‡è®°å·²å­¦ä¼šè¯†åˆ«è‰è¯
            gameData.skills.medicine.canIdentifyHerbs = true;
            break;
          case 'huangdi_canon':
            specialEffect = 'è·å¾—ç–¾ç—…æ²»ç–—èƒ½åŠ›ï¼ˆæˆåŠŸç‡80%ï¼‰';
            // æ ‡è®°å·²å­¦ä¼šæ²»ç–—ç–¾ç—…
            gameData.skills.medicine.canTreatDisease = true;
            gameData.skills.medicine.cureSuccessRate = 0.8; // 80%æ²»ç–—æˆåŠŸç‡
            
            // æ·»åŠ æ²»ç–—ç–¾ç—…çš„åŠŸèƒ½ï¼ˆå¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡Œåˆå§‹åŒ–ç›¸å…³æŒ‰é’®æˆ–åŠŸèƒ½ï¼‰
            if (!window.hasOwnProperty('handleDiseaseTreatment')) {
              window.handleDiseaseTreatment = function() {
                if (!gameData.skills.medicine.canTreatDisease) {
                  showNotification('æ— æ³•æ²»ç–—', 'ä½ è¿˜æ²¡æœ‰å­¦ä¼šæ²»ç–—ç–¾ç—…çš„æŠ€èƒ½');
                  return;
                }
                
                // æ£€æŸ¥æ˜¯å¦ç”Ÿç—…
                if (!gameData.player.isSick) {
                  showNotification('æ— éœ€æ²»ç–—', 'ä½ ç›®å‰æ²¡æœ‰ç”Ÿç—…');
                  return;
                }
                
                // å°è¯•æ²»ç–—
                const success = Math.random() < gameData.skills.medicine.cureSuccessRate;
                if (success) {
                  gameData.player.isSick = false;
                  gameData.player.health += 10; // æ²»ç–—æˆåŠŸåæ¢å¤ä¸€äº›å¥åº·å€¼
                  if (gameData.player.health > gameData.player.maxHealth) {
                    gameData.player.health = gameData.player.maxHealth;
                  }
                  showNotification('æ²»ç–—æˆåŠŸ', 'ä½ æˆåŠŸæ²»æ„ˆäº†ç–¾ç—…ï¼å¥åº·å€¼æ¢å¤äº†10ç‚¹ã€‚');
                } else {
                  showNotification('æ²»ç–—å¤±è´¥', 'æ²»ç–—å¤±è´¥äº†ï¼Œä½ éœ€è¦ä¼‘æ¯ä¸€ä¸‹å†å°è¯•ã€‚');
                }
                
                // æ›´æ–°æ¸¸æˆæ•°æ®
                updateGameData();
              };
            }
            break;
          case 'dog_beating_stick':
            specialEffect = 'å‡»ä¸­æ¦‚ç‡å¢åŠ 30%';
            // æ ‡è®°å·²å­¦ä¼šæ‰“ç‹—æ£’æ³•
            gameData.skills.martial.canUseDogStick = true;
            gameData.skills.martial.hitProbabilityBonus = 0.3; // 30%å‡»ä¸­æ¦‚ç‡åŠ æˆ
            break;
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        showNotification('å­¦ä¹ æˆåŠŸ', `æˆåŠŸå­¦ä¹ äº†${resource.name}ï¼\n${skill.name}æŠ€èƒ½æå‡è‡³${skill.level}çº§ï¼\n${specialEffect}`);
      } else {
        showNotification('å­¦ä¹ å¤±è´¥', 'è¯¥æŠ€èƒ½å·²ç»è¾¾åˆ°æœ€é«˜ç­‰çº§');
        return;
      }
      
      // å¦‚æœæ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨ç‰©å“ï¼Œæ¶ˆè€—ä¸€ä¸ª
      if (resource.oneTimeUse) {
        resource.amount--;
        
        // å¦‚æœæ•°é‡ä¸º0ä¸”ä¸å¯ä¸¢å¼ƒï¼Œä¿æŒåœ¨èƒŒåŒ…ä¸­ä½†æ˜¾ç¤ºä¸º0
        if (resource.amount <= 0 && !resource.cannotDrop) {
          // å¯ä»¥ä»èƒŒåŒ…ä¸­ç§»é™¤
          // è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¿ç•™ï¼Œåªæ˜¯æ•°é‡ä¸º0
        }
      }
      
      // æ›´æ–°UI
      updateResourceCard(resourceId);
      updateSkillDisplay(); // éœ€è¦å®ç°è¿™ä¸ªå‡½æ•°æ¥æ›´æ–°æŠ€èƒ½æ˜¾ç¤º
      updateGameData();
    }
    
    // å¸ä¸‹è£…å¤‡
    function unequipItem(slotType, resourceId) {
      const resource = gameData.resources[resourceId];
      
      if (resource) {
        // ç§»é™¤è£…å¤‡æ•ˆæœ
        applyEquipmentEffect(resourceId, 'unequip');
        
        // ç§»é™¤è£…å¤‡çŠ¶æ€
        resource.equipped = false;
        
        // æ›´æ–°è£…å¤‡æ§½
        updateEquipmentSlot(slotType);
        
        // æ›´æ–°èƒŒåŒ…
        updateResourceCard(resourceId);
        
        // æ›´æ–°UI
        updateGameData();
        
        // æ˜¾ç¤ºé€šçŸ¥
        showNotification('å¸ä¸‹è£…å¤‡', `æˆåŠŸå¸ä¸‹äº†${resource.name}`);
      }
    }
    
    // åº”ç”¨è£…å¤‡æ•ˆæœ
    function applyEquipmentEffect(resourceId, action) {
      const resource = gameData.resources[resourceId];
      
      // æ ¹æ®è£…å¤‡ç±»å‹åº”ç”¨ä¸åŒæ•ˆæœ
      switch(resourceId) {
        case 'simple_clothes': // ç ´è¡£æœ
          if (action === 'equip') {
            gameData.status.cold += 10; // æé«˜ä¿æš–åº¦
            showNotification('è£…å¤‡æ•ˆæœ', 'ç ´è¡£æœæä¾›äº†åŸºæœ¬çš„ä¿æš–ï¼Œå¯’å†·å‡å°‘10ç‚¹');
          } else {
            gameData.status.cold -= 10; // ç§»é™¤ä¿æš–æ•ˆæœ
            showNotification('è£…å¤‡æ•ˆæœ', 'å¸ä¸‹äº†ç ´è¡£æœï¼Œå¯’å†·å¢åŠ 10ç‚¹');
          }
          break;
          
        case 'black_cloak': // é»‘è‰²æ–—ç¯·
          if (action === 'equip') {
            gameData.status.spirit += 15; // æé«˜ç²¾ç¥çŠ¶æ€
            // è§£é”é»‘å¸‚
            const blackMarket = gameData.locations.find(loc => loc.id === 'black_market');
            if (blackMarket) {
              blackMarket.available = true;
              showNotification('è£…å¤‡æ•ˆæœ', 'é»‘è‰²æ–—ç¯·è®©ä½ è·å¾—äº†è¿›å…¥é»‘å¸‚çš„èµ„æ ¼ï¼');
            }
            showNotification('è£…å¤‡æ•ˆæœ', 'é»‘è‰²æ–—ç¯·æå‡äº†ä½ çš„ç²¾ç¥çŠ¶æ€ï¼Œç²¾ç¥å¢åŠ 15ç‚¹');
          } else {
            gameData.status.spirit -= 15; // ç§»é™¤ç²¾ç¥æå‡
            // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–é»‘è‰²æ–—ç¯·
            if (gameData.resources.black_cloak.amount === 0) {
              // é”å®šé»‘å¸‚
              const blackMarket = gameData.locations.find(loc => loc.id === 'black_market');
              if (blackMarket) {
                blackMarket.available = false;
                showNotification('è£…å¤‡æ•ˆæœ', 'æ²¡æœ‰é»‘è‰²æ–—ç¯·ï¼Œæ— æ³•è¿›å…¥é»‘å¸‚');
              }
            }
            showNotification('è£…å¤‡æ•ˆæœ', 'å¸ä¸‹äº†é»‘è‰²æ–—ç¯·ï¼Œç²¾ç¥å‡å°‘15ç‚¹');
          }
          break;
          
        case 'crutch': // æ‹æ–
          if (action === 'equip') {
            gameData.status.health += 10; // æé«˜å¥åº·åº¦
            gameData.status.reputation += 10; // æé«˜å£°æœ›
            showNotification('è£…å¤‡æ•ˆæœ', 'æ‹æ–å¸®åŠ©ä½ è¡Œèµ°ï¼Œå¥åº·å¢åŠ 10ç‚¹ï¼Œå£°æœ›å¢åŠ 10ç‚¹');
          } else {
            gameData.status.health -= 10; // ç§»é™¤å¥åº·æå‡
            gameData.status.reputation -= 10; // ç§»é™¤å£°æœ›æå‡
            showNotification('è£…å¤‡æ•ˆæœ', 'å¸ä¸‹äº†æ‹æ–ï¼Œå¥åº·å‡å°‘10ç‚¹ï¼Œå£°æœ›å‡å°‘10ç‚¹');
          }
          break;
          
        case 'fine_clothes': // ç²¾ç¾åæœ
          if (action === 'equip') {
            gameData.status.reputation += 20; // å¤§å¹…æé«˜å£°æœ›
            gameData.status.cold += 15; // æé«˜ä¿æš–åº¦
            showNotification('è£…å¤‡æ•ˆæœ', 'ç²¾ç¾åæœè®©ä½ çœ‹èµ·æ¥ä½“é¢ï¼Œå£°æœ›å¢åŠ 20ç‚¹ï¼Œä¿æš–åº¦å¢åŠ 15ç‚¹');
          } else {
            gameData.status.reputation -= 20; // ç§»é™¤å£°æœ›æå‡
            gameData.status.cold -= 15; // ç§»é™¤ä¿æš–æ•ˆæœ
            showNotification('è£…å¤‡æ•ˆæœ', 'å¸ä¸‹äº†ç²¾ç¾åæœï¼Œå£°æœ›å‡å°‘20ç‚¹ï¼Œä¿æš–åº¦å‡å°‘15ç‚¹');
          }
          break;
          
        case 'silk_shoes': // ç¼é‹
          if (action === 'equip') {
            gameData.status.health += 10; // æé«˜å¥åº·åº¦
            gameData.status.cold += 10; // æé«˜ä¿æš–åº¦
            showNotification('è£…å¤‡æ•ˆæœ', 'ç¼é‹èˆ’é€‚ä¿æš–ï¼Œå¥åº·å¢åŠ 10ç‚¹ï¼Œä¿æš–åº¦å¢åŠ 10ç‚¹');
          } else {
            gameData.status.health -= 10; // ç§»é™¤å¥åº·æå‡
            gameData.status.cold -= 10; // ç§»é™¤ä¿æš–æ•ˆæœ
            showNotification('è£…å¤‡æ•ˆæœ', 'å¸ä¸‹äº†ç¼é‹ï¼Œå¥åº·å‡å°‘10ç‚¹ï¼Œä¿æš–åº¦å‡å°‘10ç‚¹');
          }
          break;
          
        case 'dog_beating_stick': // æ‰“ç‹—æ£’æ³•
          if (action === 'equip') {
            gameData.status.reputation += 30; // å¤§å¹…æé«˜å£°æœ›
            gameData.status.health += 15; // æé«˜å¥åº·åº¦
            showNotification('è£…å¤‡æ•ˆæœ', 'æ‰“ç‹—æ£’æ³•è®©ä½ æˆä¸ºä¸å¸®ä¼ äººï¼Œå£°æœ›å¢åŠ 30ç‚¹ï¼Œå¥åº·å¢åŠ 15ç‚¹');
          } else {
            gameData.status.reputation -= 30; // ç§»é™¤å£°æœ›æå‡
            gameData.status.health -= 15; // ç§»é™¤å¥åº·æå‡
            showNotification('è£…å¤‡æ•ˆæœ', 'å¸ä¸‹äº†æ‰“ç‹—æ£’æ³•ï¼Œå£°æœ›å‡å°‘30ç‚¹ï¼Œå¥åº·å‡å°‘15ç‚¹');
          }
          break;
      }
      
      // ç¡®ä¿çŠ¶æ€å€¼åœ¨åˆç†èŒƒå›´å†…
      for (const stat of ['cold', 'spirit', 'health', 'reputation']) {
        gameData.status[stat] = Math.max(0, Math.min(100, gameData.status[stat]));
      }
      
      // æ›´æ–°UI
      updateGameData();
      renderLocations(); // æ›´æ–°åœ°ç‚¹æ˜¾ç¤º
    }

    // æ›´æ–°æ¸¸æˆæ•°æ®
    function updateGameData() {
      elements.dayNumber.textContent = gameData.day;
      
      // æ›´æ–°çŠ¶æ€ç™¾åˆ†æ¯”æ˜¾ç¤º
      elements.hungerPercentage.textContent = `${100 - gameData.status.hunger}%`;
      elements.coldPercentage.textContent = `${gameData.status.cold}%`;
      elements.healthPercentage.textContent = `${gameData.status.health}%`;
      elements.spiritPercentage.textContent = `${gameData.status.spirit}%`;
      elements.reputationPercentage.textContent = `${gameData.status.reputation}%`;
      elements.actionPointsValue.textContent = `${gameData.status.actionPoints}/20`;
      
      // æ›´æ–°å­£èŠ‚
      const seasons = {
        spring: { icon: 'ğŸŒ±', name: 'æ˜¥å­£' },
        summer: { icon: 'â˜€ï¸', name: 'å¤å­£' },
        autumn: { icon: 'ğŸ‚', name: 'ç§‹å­£' },
        winter: { icon: 'â„ï¸', name: 'å†¬å­£' }
      };
      
      elements.seasonIcon.textContent = seasons[gameData.season].icon;
      elements.seasonName.textContent = seasons[gameData.season].name;
      
      // æ›´æ–°çŠ¶æ€å€¼
      elements.foodValue.textContent = `${100 - gameData.status.hunger}%`;
      elements.warmthValue.textContent = `${gameData.status.cold}%`;
      elements.healthValue.textContent = `${gameData.status.health}%`;
      elements.spiritValue.textContent = `${gameData.status.spirit}%`;
      elements.reputationValue.textContent = `${gameData.status.reputation}%`;
      
      // æ›´æ–°è¿›åº¦æ¡
      elements.hungerBar.style.width = `${100 - gameData.status.hunger}%`;
      elements.coldBar.style.width = `${gameData.status.cold}%`;
      elements.healthBar.style.width = `${gameData.status.health}%`;
      elements.spiritBar.style.width = `${gameData.status.spirit}%`;
      elements.reputationBar.style.width = `${gameData.status.reputation}%`;
      elements.actionPointsBar.style.width = `${(gameData.status.actionPoints / 20) * 100}%`;
      
      // æ›´æ–°ç»Ÿè®¡æ•°æ®
      gameData.stats.daysSurvived = gameData.day - 1;
      gameData.stats.maxReputation = Math.max(gameData.stats.maxReputation, gameData.status.reputation);
    }
    
    // æ›´æ–°å•ä¸ªèµ„æºå¡ç‰Œçš„æ˜¾ç¤º
    function updateResourceCard(resourceId) {
      const resource = gameData.resources[resourceId];
      
      // å¦‚æœèµ„æºæ•°é‡ä¸º0ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥ä¸¢å¼ƒ
      if (resource.amount <= 0) {
        // ç‰¹æ®Šå­¦ä¹ ç‰©å“(type: 'learnable')å³ä½¿æ ‡è®°ä¸ºä¸å¯ä¸¢å¼ƒï¼Œä½¿ç”¨åä¹Ÿåº”ç§»é™¤
        // å…¶ä»–ä¸å¯ä¸¢å¼ƒç‰©å“(cannotDrop)å³ä½¿æ•°é‡ä¸º0ä¹Ÿä¸ç§»é™¤å¡ç‰Œ
        if (resource.type !== 'learnable' && resource.cannotDrop) {
          // ç»§ç»­æ‰§è¡Œåç»­ä»£ç ä»¥æ›´æ–°å¡ç‰Œæ˜¾ç¤ºä¸ºæ•°é‡0
        } else {
          // å¯ä¸¢å¼ƒç‰©å“å’Œå­¦ä¹ ç‰©å“æ•°é‡ä¸º0æ—¶ç§»é™¤å¡ç‰Œ
          const card = document.querySelector(`.resource-card[data-resource="${resourceId}"]`);
          if (card) {
            card.remove();
          }
          return;
        }
      }
      
      // æŸ¥æ‰¾ç°æœ‰çš„å¡ç‰Œ
      let card = document.querySelector(`.resource-card[data-resource="${resourceId}"]`);
      
      // å¦‚æœå¡ç‰Œä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„
      if (!card) {
        card = document.createElement('div');
        card.className = 'card resource resource-card';
        card.setAttribute('draggable', 'true');
        card.setAttribute('data-resource', resourceId);
        elements.resourceGrid.appendChild(card);
      }
      
      // æ›´æ–°å¡ç‰Œå†…å®¹
      card.innerHTML = `
        <div class="card-image" style="background-image: url('${resource.image}'); background-size: cover; background-position: center; position: relative;">
          ${resource.equipped ? `
            <div class="equipped-badge" style="position: absolute; top: 0.25rem; right: 0.25rem; background-color: #805AD5; color: white; border-radius: 50%; width: 1.5rem; height: 1.5rem; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">
              å·²ç©¿
            </div>
          ` : ''}
        </div>
        <div class="card-content">
          <div class="card-title">${resource.name}</div>
          <div class="resource-count">${resource.amount}</div>
          ${resource.durability !== undefined ? `
            <div class="card-durability" style="margin-top: 0.25rem;">
              <div class="durability-bar-container" style="height: 4px; background-color: #E2E8F0; border-radius: 2px; overflow: hidden;">
                <div class="durability-bar" style="height: 100%; width: ${resource.durability}%; background-color: ${resource.durability > 50 ? '#38A169' : resource.durability > 20 ? '#D69E2E' : '#E53E3E'};"></div>
              </div>
              <div class="durability-text" style="font-size: 0.75rem; text-align: right; margin-top: 0.125rem;">${resource.durability}%</div>
            </div>
          ` : ''}
        </div>
      `;
      
      // ç§»é™¤ç°æœ‰çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤æ·»åŠ 
      const newCard = card.cloneNode(true);
      card.parentNode.replaceChild(newCard, card);
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
      newCard.addEventListener('click', () => handleResourceClick(resourceId));
    }

    // å¤„ç†èµ„æºç‚¹å‡»
    function handleResourceClick(resourceId) {
      const resource = gameData.resources[resourceId];
      
      if (!resource || resource.amount <= 0) return;
      
      // å¦‚æœæ˜¯é£Ÿç‰©ç±»å‹
      if (resourceId === 'food') {
        // ä½¿ç”¨æ®‹ç¾¹å‰©é¥­
        if (confirm('æ˜¯å¦é£Ÿç”¨æ®‹ç¾¹å‰©é¥­ï¼Ÿ\nè·å¾—15ç‚¹é¥±é£Ÿåº¦ï¼Œä½†å‡å°‘8ç‚¹å¥åº·åº¦')) {
          consumeFood(resourceId);
        }
      } else if (resourceId === 'cornbread') {
        // ä½¿ç”¨çªçªå¤´
        if (confirm('æ˜¯å¦é£Ÿç”¨çªçªå¤´ï¼Ÿ\nè·å¾—25ç‚¹é¥±é£Ÿåº¦ï¼Œä½†å‡å°‘3ç‚¹å¥åº·åº¦')) {
          consumeFood(resourceId);
        }
      } else if (resourceId === 'medicine') {
        // ä½¿ç”¨çµè¯
        if (confirm('æ˜¯å¦ä½¿ç”¨çµè¯ï¼Ÿ\næ¢å¤50ç‚¹å¥åº·å€¼')) {
          useMedicine(resourceId);
        }
      }
    }
    
    // å…¨å±€å˜é‡ç”¨äºè·Ÿè¸ªå½“å‰åˆ†ç±»å’Œé¡µç 
    let currentCategory = 'all';
    let currentPage = 1;
    const itemsPerPage = 20;
    
    // æ·»åŠ ç¼ºå¤±çš„åˆ†ç±»å±æ€§çš„å‡½æ•°
    function ensureResourceCategories() {
        for (const [id, resource] of Object.entries(gameData.resources)) {
            if (!resource.category) {
                // é»˜è®¤åˆ†ç±»ä¸ºææ–™
                gameData.resources[id].category = 'material';
            }
        }
    }
    
    // æ¸²æŸ“èµ„æº
    function renderResources() {
      // ç¡®ä¿æ‰€æœ‰èµ„æºéƒ½æœ‰åˆ†ç±»
      ensureResourceCategories();
      
      elements.resourceGrid.innerHTML = '';
      
      // ç­›é€‰èµ„æº
      let filteredResources = [];
      for (const [id, resource] of Object.entries(gameData.resources)) {
        // ç‰¹æ®Šå­¦ä¹ ç‰©å“(type: 'learnable')åªæœ‰åœ¨è·å¾—å(amount > 0)æ‰æ˜¾ç¤º
        // å…¶ä»–ä¸å¯ä¸¢å¼ƒç‰©å“(cannotDrop)å³ä½¿æ•°é‡ä¸º0ä¹Ÿæ˜¾ç¤º
        // æ™®é€šç‰©å“åªæ˜¾ç¤ºæ•°é‡å¤§äº0çš„
        if (((resource.type !== 'learnable' && resource.cannotDrop) || resource.amount > 0) && 
            (currentCategory === 'all' || resource.category === currentCategory)) {
            filteredResources.push({ id, resource });
        }
      }
      
      // è®¡ç®—æ€»é¡µæ•°
      const totalPages = Math.ceil(filteredResources.length / itemsPerPage);
      
      // æ›´æ–°å½“å‰é¡µç ï¼ˆå¦‚æœè¶…å‡ºèŒƒå›´ï¼‰
      if (currentPage > totalPages && totalPages > 0) {
          currentPage = totalPages;
      } else if (currentPage < 1) {
          currentPage = 1;
      }
      
      // æ›´æ–°é¡µç æ˜¾ç¤º
      const pageInfo = document.getElementById('pageInfo');
      if (pageInfo) {
          pageInfo.textContent = `ç¬¬ ${currentPage}/${totalPages} é¡µ`;
      }
      
      // æ›´æ–°ç¿»é¡µæŒ‰é’®çŠ¶æ€
      const prevButton = document.getElementById('prevPage');
      const nextButton = document.getElementById('nextPage');
      if (prevButton) prevButton.disabled = currentPage <= 1;
      if (nextButton) nextButton.disabled = currentPage >= totalPages;
      
      // æ›´æ–°åˆ†ç±»æ ‡ç­¾æ ·å¼
      document.querySelectorAll('.inventory-tab').forEach(tab => {
          if (tab.dataset.category === currentCategory) {
              tab.classList.add('active', 'bg-purple-600', 'text-white');
              tab.classList.remove('bg-gray-100', 'text-gray-600');
          } else {
              tab.classList.remove('active', 'bg-purple-600', 'text-white');
              tab.classList.add('bg-gray-100', 'text-gray-600');
          }
      });
      
      // è®¡ç®—å½“å‰é¡µæ˜¾ç¤ºçš„èµ„æº
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, filteredResources.length);
      const currentPageResources = filteredResources.slice(startIndex, endIndex);
      
      // æ˜¾ç¤ºå½“å‰é¡µçš„èµ„æºé¡¹
      for (const { id, resource } of currentPageResources) {
        const resourceCard = document.createElement('div');
        resourceCard.className = 'card resource resource-card';
        resourceCard.setAttribute('draggable', 'true');
        resourceCard.setAttribute('data-resource', id);
        
        resourceCard.innerHTML = `
          <div class="card-image" style="background-image: url('${resource.image}'); background-size: cover; background-position: center; position: relative;">
            ${resource.equipped ? `
              <div class="equipped-badge" style="position: absolute; top: 0.25rem; right: 0.25rem; background-color: #805AD5; color: white; border-radius: 50%; width: 1.5rem; height: 1.5rem; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">
                å·²ç©¿
              </div>
            ` : ''}
          </div>
          <div class="card-content">
            <div class="card-title">${resource.name}</div>
            <div class="resource-count">${resource.amount}</div>
            ${resource.durability !== undefined ? `
              <div class="card-durability" style="margin-top: 0.25rem;">
                <div class="durability-bar-container" style="height: 4px; background-color: #E2E8F0; border-radius: 2px; overflow: hidden;">
                  <div class="durability-bar" style="height: 100%; width: ${resource.durability}%; background-color: ${resource.durability > 50 ? '#38A169' : resource.durability > 20 ? '#D69E2E' : '#E53E3E'};"></div>
                </div>
                <div class="durability-text" style="font-size: 0.75rem; text-align: right; margin-top: 0.125rem;">${resource.durability}%</div>
              </div>
            ` : ''}
          </div>
        `;
        
        elements.resourceGrid.appendChild(resourceCard);
      }
    }
    
    // æ·»åŠ åˆ†ç±»åˆ‡æ¢äº‹ä»¶
    function setupCategoryTabs() {
        document.querySelectorAll('.inventory-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                currentCategory = tab.dataset.category;
                currentPage = 1; // åˆ‡æ¢åˆ†ç±»æ—¶é‡ç½®åˆ°ç¬¬ä¸€é¡µ
                renderResources();
            });
        });
    }
    
    // æ·»åŠ åˆ†é¡µæŒ‰é’®äº‹ä»¶
    function setupPaginationButtons() {
        const prevButton = document.getElementById('prevPage');
        const nextButton = document.getElementById('nextPage');
        
        if (prevButton) {
            prevButton.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderResources();
                }
            });
        }
        
        if (nextButton) {
            nextButton.addEventListener('click', () => {
                // è®¡ç®—æœ€å¤§é¡µæ•°
                ensureResourceCategories();
                let filteredResources = [];
                for (const [id, resource] of Object.entries(gameData.resources)) {
                    if (resource.amount > 0 && (currentCategory === 'all' || resource.category === currentCategory)) {
                        filteredResources.push(resource);
                    }
                }
                const totalPages = Math.ceil(filteredResources.length / itemsPerPage);
                
                if (currentPage < totalPages) {
                    currentPage++;
                    renderResources();
                }
            });
        }
    }

    // æ¸²æŸ“åœ°ç‚¹
    function renderLocations() {
      elements.locationGrid.innerHTML = '';
      
      for (const location of gameData.locations) {
        if (location.available) {
          // è·å–å±é™©ç­‰çº§å›¾æ ‡
          let dangerIcon = '';
          switch (location.dangerLevel) {
            case 'low': dangerIcon = 'ğŸŸ¢'; break;
            case 'medium': dangerIcon = 'ğŸŸ¡'; break;
            case 'high': dangerIcon = 'ğŸ”´'; break;
            default: dangerIcon = 'âšª';
          }
          
          const locationCard = document.createElement('div');
          locationCard.className = `card location location-card ${location.currentLocation ? 'current' : ''}`;
          locationCard.setAttribute('data-location', location.id);
          
          // å¯¹äºå¯ºåº™ï¼Œä¸æ˜¾ç¤ºæ˜æ˜¾æ ‡è¯†
          const showLocationIcon = location.id !== 'temple';
          
          locationCard.innerHTML = `
            <div class="card-content">
              <div class="card-title">${location.name} ${showLocationIcon && location.currentLocation ? 'ğŸ ' : ''}</div>
              <div class="card-description">${location.description}</div>
              <div class="location-details">
                <div class="resource-type">
                  <span>èµ„æº:</span>
                  <span>${location.resourceType.split(',').map(type => {
                    switch(type) {
                      case 'money': return 'ğŸ’°';
                      case 'food': return 'ğŸ²';
                      case 'cloth': return 'ğŸ§µ';
                      case 'stick': return 'ğŸŒ¿';
                      case 'paper': return 'ğŸ“œ';
                      case 'flint': return 'ğŸ”¥';
                      case 'mud': return 'ğŸª¨';
                      case 'spirit': return 'ğŸ˜Œ';
                      case 'gold_bar': return 'ğŸ¥‡';
                      case 'black_cloth': return 'âš«';
                      case 'thread': return 'ğŸ§¶';
                      default: return type;
                    }
                  }).join('')}</span>
                </div>
                <div class="danger-level ${location.dangerLevel}">
                  <span>${dangerIcon}</span>
                  <span>${location.dangerLevel === 'low' ? 'ä½' : location.dangerLevel === 'medium' ? 'ä¸­' : 'é«˜'}</span>
                </div>
                <div class="action-cost">
                  <span>âš¡</span>
                  <span>${location.actionPointCost}</span>
                </div>
              </div>
            </div>
          `;
          
          elements.locationGrid.appendChild(locationCard);
        }
      }
    }

    // æ¸²æŸ“è¡ŒåŠ¨
    function renderActions() {
      elements.actionGrid.innerHTML = '';
      
      // è·å–å½“å‰åœ°ç‚¹
      const currentLocation = gameData.locations.find(loc => loc.currentLocation);
      
      if (!currentLocation) {
        return;
      }
      
      // æ ¹æ®æ—¶é—´å’Œåœ°ç‚¹é€‰æ‹©è¡ŒåŠ¨åˆ—è¡¨
      let actionsToRender = [...currentLocation.actions];
      
      // å¦‚æœæ˜¯å¤œæ™šä¸”åœ¨è¡—è§’ï¼Œä½¿ç”¨å¤œæ™šè¡ŒåŠ¨åˆ—è¡¨
      if (gameData.timeOfDay === 'night' && currentLocation.id === 'street' && currentLocation.nightActions) {
        actionsToRender = [...currentLocation.nightActions];
      }
      
      // æ ¹æ®å½“å‰åœ°ç‚¹çš„è¡ŒåŠ¨åˆ—è¡¨æ¸²æŸ“è¡ŒåŠ¨å¡ç‰Œ
      for (const actionId of actionsToRender) {
        const action = gameData.actions.find(act => act.id === actionId);
        
        if (!action) continue;
        
        // æ£€æŸ¥æ˜¯å¦æ»¡è¶³è¡ŒåŠ¨æ‰€éœ€çš„èµ„æº
        let canPerform = true;
        if (action.requires) {
          for (const [resource, amount] of Object.entries(action.requires)) {
            if (!gameData.resources[resource] || gameData.resources[resource].amount < amount) {
              canPerform = false;
              break;
            }
          }
        }
        
        const actionCard = document.createElement('div');
        actionCard.className = `card action action-card ${canPerform ? '' : 'opacity-50'}`;
        actionCard.setAttribute('data-action', action.id);
        actionCard.setAttribute('data-can-perform', canPerform);
        
        actionCard.innerHTML = `
          <div class="card-content">
            <div class="card-title">${action.name}</div>
            <div class="card-description">${action.description}</div>
          </div>
          <div class="card-footer">
            ${canPerform ? '<span class="text-green-600">å¯æ‰§è¡Œ</span>' : '<span class="text-red-600">æ¡ä»¶ä¸è¶³</span>'}
          </div>
        `;
        
        elements.actionGrid.appendChild(actionCard);
      }
    }

    // æ¸²æŸ“é…æ–¹
    function renderRecipes() {
      elements.recipeGrid.innerHTML = '';
      
      for (const recipe of gameData.recipes) {
        const isDiscovered = gameData.discoveredRecipes.includes(recipe.id);
        
        const recipeCard = document.createElement('div');
        recipeCard.className = 'recipe-card';
        
        if (!isDiscovered) {
          // æœªè§£é”çš„é…æ–¹æ˜¾ç¤ºä¸ºé—®å·
          recipeCard.innerHTML = `
            <h3 class="recipe-card-title">???</h3>
            <div class="recipe-card-ingredients">
              <span class="recipe-card-ingredient">???</span>
              <span class="recipe-card-ingredient">???</span>
            </div>
            <p class="recipe-card-description">æœªè§£é”çš„é…æ–¹</p>
            <p class="recipe-card-undiscovered">æœªå‘ç°</p>
          `;
        } else {
          // å·²è§£é”çš„é…æ–¹æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯
          let ingredientsHtml = '';
          for (const [resource, amount] of Object.entries(recipe.ingredients)) {
            const resourceName = gameData.resources[resource] ? gameData.resources[resource].name : resource;
            ingredientsHtml += `<span class="recipe-card-ingredient">${resourceName} x${amount}</span>`;
          }
          
          recipeCard.innerHTML = `
            <h3 class="recipe-card-title">${recipe.name}</h3>
            <div class="recipe-card-ingredients">
              ${ingredientsHtml}
            </div>
            <p class="recipe-card-description">${recipe.description}</p>
            <p class="recipe-card-discovered">å·²å‘ç°</p>
          `;
        }
        
        elements.recipeGrid.appendChild(recipeCard);
      }
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // å¸ä¸‹è£…å¤‡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('unequip-button')) {
          const slot = e.target.getAttribute('data-slot');
          const resourceId = e.target.getAttribute('data-resource');
          unequipItem(slot, resourceId);
        }
      });
      
      // è£…å¤‡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('equipmentButton').addEventListener('click', function() {
        openEquipmentWindow();
      });
      
      // æŠ€èƒ½æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('skillsButton').addEventListener('click', function() {
        openSkillsWindow();
      });
      
      // å¼€å§‹æ¸¸æˆæŒ‰é’®
      elements.startGameButton.addEventListener('click', () => {
        debugLog('å¼€å§‹æ¸¸æˆæŒ‰é’®è¢«ç‚¹å‡»');
        try {
          debugLog('è®¾ç½®å¼€å§‹å±å¹•æ·¡å‡ºåŠ¨ç”»');
          elements.startScreen.style.opacity = '0';
          
          setTimeout(() => {
            try {
              debugLog('éšè—å¼€å§‹å±å¹•');
              elements.startScreen.style.display = 'none';
              
              debugLog('æ˜¾ç¤ºæ¸¸æˆå®¹å™¨');
              elements.gameContainer.style.display = 'block';
              
              debugLog('è°ƒç”¨initGame()åˆå§‹åŒ–æ¸¸æˆ');
              initGame();
              debugLog('æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
              console.error('å¼€å§‹æ¸¸æˆåŠ¨ç”»åé”™è¯¯:', error);
              let errorDiv = document.getElementById('error-display');
              if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-display';
                errorDiv.style.cssText = 'position: fixed; top: 10px; left: 10px; background: red; color: white; padding: 10px; z-index: 9999; font-size: 14px;';
                document.body.appendChild(errorDiv);
              }
              errorDiv.innerHTML += `<p>å¼€å§‹æ¸¸æˆé”™è¯¯: ${error.message}</p>`;
            }
          }, 500);
        } catch (error) {
          console.error('å¼€å§‹æ¸¸æˆæŒ‰é’®ç‚¹å‡»é”™è¯¯:', error);
          let errorDiv = document.getElementById('error-display');
          if (!errorDiv) {
            errorDiv = document.createElement('div');
            errorDiv.id = 'error-display';
            errorDiv.style.cssText = 'position: fixed; top: 10px; left: 10px; background: red; color: white; padding: 10px; z-index: 9999; font-size: 14px;';
            document.body.appendChild(errorDiv);
          }
          errorDiv.innerHTML += `<p>å¼€å§‹æ¸¸æˆæŒ‰é’®é”™è¯¯: ${error.message}</p>`;
        }
      });
      
      // æ•™ç¨‹æ¨¡æ€æ¡†
      elements.closeTutorialButton.addEventListener('click', () => {
        elements.tutorialModal.classList.remove('active');
      });
      
      // å¸®åŠ©æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      elements.helpButton.addEventListener('click', () => {
        elements.tutorialModal.classList.add('active');
      });
      
      // æ•™ç¨‹å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      elements.closeTutorialBtn.addEventListener('click', () => {
        elements.tutorialModal.classList.remove('active');
      });
      
      // èµ„æºå¡ç‰Œæ‹–æ‹½
      elements.resourceGrid.addEventListener('dragstart', (e) => {
        if (e.target.classList.contains('resource-card')) {
          const resourceId = e.target.getAttribute('data-resource');
          e.dataTransfer.setData('text/plain', resourceId);
          e.target.classList.add('dragging');
        }
      });
      
      elements.resourceGrid.addEventListener('dragend', (e) => {
        if (e.target.classList.contains('resource-card')) {
          e.target.classList.remove('dragging');
        }
      });
      
      // ç»„åˆæ§½æ‹–æ”¾ - åªé€‰æ‹©å¡ç‰Œç»„åˆåŒºåŸŸçš„æ§½ä½
      const combinationSlots = document.querySelectorAll('#combinationSlots .combination-slot');
      combinationSlots.forEach(slot => {
        slot.addEventListener('dragover', (e) => {
          e.preventDefault();
          slot.classList.add('active');
        });
        
        slot.addEventListener('dragleave', () => {
          slot.classList.remove('active');
        });
        
        slot.addEventListener('drop', (e) => {
          e.preventDefault();
          slot.classList.remove('active');
          
          const resourceId = e.dataTransfer.getData('text/plain');
          if (resourceId && gameData.resources[resourceId].amount > 0) {
            const slotNumber = slot.getAttribute('data-slot');
            
            // å¦‚æœæ§½ä½å·²æœ‰èµ„æºï¼Œå°†å…¶è¿”å›èƒŒåŒ…
            if (gameData.combinationSlots[slotNumber]) {
              const prevResourceId = gameData.combinationSlots[slotNumber];
              // ä¸éœ€è¦å¢å‡æ•°é‡ï¼Œå› ä¸ºåªæ˜¯ç§»åŠ¨ä½ç½®
            }
            
            // æ”¾ç½®æ–°èµ„æº
            gameData.combinationSlots[slotNumber] = resourceId;
            
            // æ›´æ–°UI
            updateCombinationSlots();
            renderResources();
            checkCombination();
          }
        });
        
        slot.addEventListener('click', () => {
          const slotNumber = slot.getAttribute('data-slot');
          if (gameData.combinationSlots[slotNumber]) {
            const resourceId = gameData.combinationSlots[slotNumber];
            // ä¸éœ€è¦å¢å‡æ•°é‡ï¼Œå› ä¸ºåªæ˜¯ç§»åŠ¨ä½ç½®
            gameData.combinationSlots[slotNumber] = null;
            
            updateCombinationSlots();
            renderResources();
            checkCombination();
          }
        });
      });
      
      // ç»„åˆæŒ‰é’®
      elements.combineButton.addEventListener('click', () => {
        combineCards();
      });
      
      // åœ°ç‚¹å¡ç‰Œç‚¹å‡»
      elements.locationGrid.addEventListener('click', (e) => {
        const locationCard = e.target.closest('.location-card');
        if (locationCard) {
          const locationId = locationCard.getAttribute('data-location');
          visitLocation(locationId);
        }
      });
      
      // é…æ–¹æŒ‰é’®ç‚¹å‡»
      document.getElementById('recipeButton').addEventListener('click', () => {
        renderRecipes();
        elements.recipeModal.classList.add('active');
      });
      
      // è¡ŒåŠ¨å¡ç‰Œç‚¹å‡»
      elements.actionGrid.addEventListener('click', (e) => {
        const actionCard = e.target.closest('.action-card');
        if (actionCard) {
          const actionId = actionCard.getAttribute('data-action');
          const canPerform = actionCard.getAttribute('data-can-perform') === 'true';
          
          if (canPerform) {
            performAction(actionId);
          } else {
            showNotification('æ¡ä»¶ä¸è¶³', 'ä½ æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºæ¥æ‰§è¡Œæ­¤è¡ŒåŠ¨ã€‚');
          }
        }
      });
      
      // äº‹ä»¶æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
      elements.closeEventButton.addEventListener('click', () => {
        elements.eventModal.classList.remove('active');
        endTurn();
      });
      
      // é…æ–¹æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
      elements.closeRecipeButton.addEventListener('click', () => {
        elements.recipeModal.classList.remove('active');
      });
      
      // é…æ–¹æ¨¡æ€æ¡†ç‚¹å‡»ä»»æ„ä½ç½®å…³é—­
      elements.recipeModal.addEventListener('click', (e) => {
        if (e.target === elements.recipeModal) {
          elements.recipeModal.classList.remove('active');
        }
      });
      
      // æ¸¸æˆç»“æŸæ¨¡æ€æ¡†æŒ‰é’®
      elements.restartGameButton.addEventListener('click', () => {
        resetGame();
        elements.gameOverModal.classList.remove('active');
        elements.gameContainer.style.display = 'block';
      });
      
      elements.exitGameButton.addEventListener('click', () => {
        elements.gameOverModal.classList.remove('active');
        elements.gameContainer.style.display = 'none';
        elements.startScreen.style.display = 'flex';
        elements.startScreen.style.opacity = '1';
      });
      
      // é€šçŸ¥å…³é—­æŒ‰é’®
      elements.closeNotificationButton.addEventListener('click', () => {
        elements.notification.classList.remove('active');
      });
      
      // æˆå°±é€šçŸ¥å…³é—­æŒ‰é’®
      elements.closeAchievementButton.addEventListener('click', () => {
        elements.achievementModal.classList.remove('active');
      });
    }

    // æ›´æ–°ç»„åˆæ§½ - åªæ›´æ–°å¡ç‰Œç»„åˆåŒºåŸŸçš„æ§½ä½
    function updateCombinationSlots() {
      const slots = document.querySelectorAll('#combinationSlots .combination-slot');
      
      slots.forEach(slot => {
        const slotNumber = slot.getAttribute('data-slot');
        const resourceId = gameData.combinationSlots[slotNumber];
        
        slot.innerHTML = '';
        
        if (resourceId) {
          const resource = gameData.resources[resourceId];
          const resourceCard = document.createElement('div');
          resourceCard.className = 'card resource combination-card';
          
          resourceCard.innerHTML = `
            <div class="card-image" style="background-image: url('${resource.image}'); background-size: cover; background-position: center;"></div>
            <div class="card-content">
              <div class="card-title">${resource.name}</div>
            </div>
          `;
          
          slot.appendChild(resourceCard);
        }
      });
    }

    // æ£€æŸ¥ç»„åˆ
    function checkCombination() {
      const slots = Object.values(gameData.combinationSlots).filter(Boolean);
      
      if (slots.length >= 2) {
        elements.combineButton.disabled = false;
      } else {
        elements.combineButton.disabled = true;
        elements.combinationResult.innerHTML = '';
      }
    }

    // ç»„åˆå¡ç‰Œ
    function combineCards() {
      const slots = Object.values(gameData.combinationSlots).filter(Boolean);
      
      if (slots.length < 2) {
        showNotification('ç»„åˆå¤±è´¥', 'éœ€è¦è‡³å°‘ä¸¤å¼ å¡ç‰Œæ‰èƒ½ç»„åˆã€‚');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦åŒ¹é…ä»»ä½•é…æ–¹
      let matchedRecipe = null;
      
      for (const recipe of gameData.recipes) {
        const ingredients = Object.keys(recipe.ingredients);
        
        // æ£€æŸ¥é…æ–¹æ‰€éœ€çš„æ‰€æœ‰èµ„æºæ˜¯å¦éƒ½åœ¨ç»„åˆæ§½ä¸­
        let hasAllIngredients = true;
        const slotCounts = {};
        
        // è®¡ç®—ç»„åˆæ§½ä¸­æ¯ç§èµ„æºçš„æ•°é‡
        slots.forEach(resourceId => {
          slotCounts[resourceId] = (slotCounts[resourceId] || 0) + 1;
        });
        
        // æ£€æŸ¥æ˜¯å¦æ»¡è¶³é…æ–¹è¦æ±‚
        for (const [resource, requiredAmount] of Object.entries(recipe.ingredients)) {
          if (!slotCounts[resource] || slotCounts[resource] < requiredAmount) {
            hasAllIngredients = false;
            break;
          }
        }
        
        if (hasAllIngredients) {
          matchedRecipe = recipe;
          break;
        }
      }
      
      if (matchedRecipe) {
        // å‡†å¤‡ç»“æœå¯¹è±¡
        const results = {
          resources: {},
          status: {},
          effects: []
        };
        
        // æ¶ˆè€—èƒŒåŒ…ä¸­çš„èµ„æº
        for (const [resource, requiredAmount] of Object.entries(matchedRecipe.ingredients)) {
          if (resource in gameData.resources) {
            const originalAmount = gameData.resources[resource].amount;
            gameData.resources[resource].amount = Math.max(0, originalAmount - requiredAmount);
            
            // æ£€æŸ¥è¯¥ç‰©å“æ˜¯å¦æ­£åœ¨è£…å¤‡ä¸­
            if (gameData.resources[resource].equipped) {
              // å¦‚æœç‰©å“æ•°é‡å˜ä¸º0ï¼Œè‡ªåŠ¨å¸ä¸‹è£…å¤‡
              if (gameData.resources[resource].amount === 0) {
                // ç§»é™¤è£…å¤‡æ•ˆæœ
                applyEquipmentEffect(resource, 'unequip');
                // ç§»é™¤è£…å¤‡çŠ¶æ€
                gameData.resources[resource].equipped = false;
                results.effects.push(`ä½ çš„${gameData.resources[resource].name}è¢«æ¶ˆè€—äº†ï¼Œå·²è‡ªåŠ¨å¸ä¸‹ã€‚`);
              }
            }
          }
        }
        
        // åº”ç”¨é…æ–¹ç»“æœ
        let resourceChanged = false;
        for (const [resource, amount] of Object.entries(matchedRecipe.result)) {
          if (resource in gameData.resources) {
            // è®°å½•èµ„æºæ˜¯å¦æœ‰å˜åŒ–
            if (gameData.resources[resource].amount !== gameData.resources[resource].amount + amount) {
              resourceChanged = true;
            }
            gameData.resources[resource].amount += amount;
          } else if (resource in gameData.status) {
            const newStatus = Math.min(100, Math.max(0, gameData.status[resource] + amount));
            if (gameData.status[resource] !== newStatus) {
              resourceChanged = true;
            }
            gameData.status[resource] = newStatus;
          } else if (resource === 'begging_chance') {
            // å¤„ç†ä¹è®¨æˆåŠŸç‡åŠ æˆ
            gameData.begging_chance = (gameData.begging_chance || 0) + amount;
            resourceChanged = true;
            showNotification('åˆ¶ä½œæˆåŠŸ', `ä½ çš„ä¹è®¨æˆåŠŸç‡æé«˜äº†${amount}%ï¼`);
          } else {
            // å¦‚æœæ˜¯æ–°çš„èµ„æºï¼Œåˆ›å»ºå®ƒ
            gameData.resources[resource] = {
              name: resource.charAt(0).toUpperCase() + resource.slice(1).replace('_', ' '),
              amount: amount,
              image: '' // é»˜è®¤ä¸ºç©ºå›¾ç‰‡ï¼Œå®é™…æ¸¸æˆä¸­åº”è¯¥è®¾ç½®æ­£ç¡®çš„å›¾ç‰‡
            };
            
            // å¦‚æœæ˜¯å¯åˆ¶ä½œçš„ç‰©å“ï¼Œè®¾ç½®åˆå§‹è€ä¹…åº¦
            if (['simple_clothes', 'fire', 'clay_bowl', 'crutch', 'black_cloak'].includes(resource)) {
              gameData.resources[resource].durability = 100;
            }
            resourceChanged = true;
          }
        }
        
        // æ ‡è®°é…æ–¹ä¸ºå·²å‘ç°
        if (!gameData.discoveredRecipes.includes(matchedRecipe.id)) {
          gameData.discoveredRecipes.push(matchedRecipe.id);
          gameData.stats.recipesDiscovered++;
          showAchievement('æ–°é…æ–¹å‘ç°', `ä½ å‘ç°äº†å¦‚ä½•åˆ¶ä½œ${matchedRecipe.name}ï¼`);
        }
        
        // å¦‚æœåˆ¶ä½œçš„æ˜¯æ³¥ç¢—ï¼Œç¡®ä¿èƒŒåŒ…ä¸­æ²¡æœ‰ç ´ç¢—
        if (matchedRecipe.id === 'clay_bowl') {
          gameData.resources.bowl.amount = 0;
        }
        
        // æ¸…ç©ºç»„åˆæ§½
        for (const slot in gameData.combinationSlots) {
          gameData.combinationSlots[slot] = null;
        }
        
        // æ›´æ–°UI
        updateCombinationSlots();
        updateGameData();
        checkCombination();
        
        // å¦‚æœèµ„æºæœ‰å˜åŒ–ï¼Œæ›´æ–°ç›¸å…³èµ„æºå¡ç‰Œ
        if (resourceChanged) {
          // æ›´æ–°æ¶ˆè€—çš„èµ„æº
          for (const [resource, requiredAmount] of Object.entries(matchedRecipe.ingredients)) {
            updateResourceCard(resource);
          }
          
          // æ›´æ–°ç”Ÿæˆçš„èµ„æº
          for (const [resource, amount] of Object.entries(matchedRecipe.result)) {
            if (resource in gameData.resources) {
              updateResourceCard(resource);
            }
          }
          
          // åªæœ‰å½“æœ‰è£…å¤‡ç‰©å“è¢«æ¶ˆè€—æ—¶æ‰æ›´æ–°è£…å¤‡æ 
          if (results.effects.length > 0) {
            renderEquipmentSlots(); // æ›´æ–°è£…å¤‡æ 
          }
        }
        
        // å¦‚æœæœ‰è£…å¤‡ç‰©å“è¢«æ¶ˆè€—ï¼Œæ˜¾ç¤ºé€šçŸ¥
        if (results.effects.length > 0) {
          showEventResult('ç»„åˆç»“æœ', results);
        }
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        elements.combinationResult.innerHTML = `
          <div class="text-green-600">
            <i class="fa fa-check-circle" aria-hidden="true"></i>
            æˆåŠŸåˆ¶ä½œäº† ${matchedRecipe.name}ï¼
          </div>
        `;
        

        
        showNotification('åˆ¶ä½œæˆåŠŸ', `ä½ æˆåŠŸåˆ¶ä½œäº†${matchedRecipe.name}ï¼`);
      } else {
        // æ˜¾ç¤ºå¤±è´¥æ¶ˆæ¯
        elements.combinationResult.innerHTML = `
          <div class="text-red-600">
            <i class="fa fa-times-circle" aria-hidden="true"></i>
            è¿™äº›å¡ç‰Œæ— æ³•ç»„åˆã€‚
          </div>
        `;
        
        showNotification('ç»„åˆå¤±è´¥', 'è¿™äº›å¡ç‰Œæ— æ³•ç»„åˆï¼Œè¯·å°è¯•å…¶ä»–ç»„åˆã€‚');
      }
    }

    // æ£€æŸ¥åœ°ç‚¹è¿›å…¥æ¡ä»¶
    function checkEntryConditions(location) {
      // ç‰¹æ®Šæ£€æŸ¥ï¼šé»‘å¸‚éœ€è¦é»‘è‰²æ–—ç¯·
      if (location.id === 'black_market') {
        // æ£€æŸ¥æ˜¯å¦ç©¿æˆ´äº†é»‘è‰²æ–—ç¯·
        const specialSlot = document.querySelector('.equipment-slots .combination-slot[data-slot="special"]');
        const hasBlackCloakEquipped = specialSlot.querySelector('.equipment-item[data-resource="black_cloak"]');
        
        if (!hasBlackCloakEquipped) {
          // æ˜¾ç¤ºæç¤ºï¼šä¸ç¬¦åˆè¿›å…¥æ¡ä»¶
          showEventResult('ä¸ç¬¦åˆè¿›å…¥æ¡ä»¶', {
            effects: ['è¿›å…¥é»‘å¸‚éœ€è¦ç©¿æˆ´é»‘è‰²æ–—ç¯·ï¼Œä½ ç›®å‰æ²¡æœ‰ç©¿æˆ´ã€‚']
          });
          return false;
        }
      }
      
      if (!location.entryCondition) return true;
      
      for (const [status, condition] of Object.entries(location.entryCondition)) {
        if (condition.min !== undefined && gameData.status[status] < condition.min) {
          showNotification('æ¡ä»¶ä¸è¶³', `è¿›å…¥${location.name}éœ€è¦${status}è‡³å°‘${condition.min}%ï¼Œä½ ç›®å‰åªæœ‰${gameData.status[status]}%ã€‚`);
          return false;
        }
        if (condition.max !== undefined && gameData.status[status] > condition.max) {
          showNotification('æ¡ä»¶ä¸ç¬¦', `è¿›å…¥${location.name}éœ€è¦${status}ä¸è¶…è¿‡${condition.max}%ï¼Œä½ ç›®å‰æœ‰${gameData.status[status]}%ã€‚`);
          return false;
        }
      }
      
      return true;
    }
    
    // é€€å‡ºåœ°ç‚¹
    function exitLocation() {
      // è·å–å½“å‰åœ°ç‚¹
      const currentLocation = gameData.locations.find(loc => loc.currentLocation);
      
      if (!currentLocation) return;
      
      // æ£€æŸ¥æ˜¯å¦åœ¨ç‰¢æˆ¿ä¸­ä¸”è¿˜æœ‰åˆ‘æœŸ
      if (currentLocation.id === 'prison') {
        const prisonLocation = gameData.locations.find(loc => loc.id === 'prison');
        if (prisonLocation && prisonLocation.sentenceDays > 0) {
          showNotification('æ— æ³•ç¦»å¼€', 'ä½ è¿˜åœ¨æœåˆ‘æœŸé—´ï¼Œæ— æ³•ç¦»å¼€ç‰¢æˆ¿ï¼');
          return;
        }
      }
      
      // æ£€æŸ¥è¡ŒåŠ¨ç‚¹æ˜¯å¦è¶³å¤Ÿ
      if (gameData.status.actionPoints < currentLocation.actionPointCost) {
        showNotification('è¡ŒåŠ¨ç‚¹ä¸è¶³', `é€€å‡º${currentLocation.name}éœ€è¦${currentLocation.actionPointCost}ç‚¹è¡ŒåŠ¨ç‚¹ï¼Œä½ ç›®å‰åªæœ‰${gameData.status.actionPoints}ç‚¹ã€‚`);
        return;
      }
      
      // æ¶ˆè€—è¡ŒåŠ¨ç‚¹
      gameData.status.actionPoints -= currentLocation.actionPointCost;
      
      // æ—¶é—´æµé€ - æ¶ˆè€—1ä¸ªå›åˆ
      gameData.timeTurns++;
      
      // æ˜¾ç¤ºé€€å‡ºé€šçŸ¥
      showNotification('ç¦»å¼€åœ°ç‚¹', `ä½ ç¦»å¼€äº†${currentLocation.name}ã€‚`);
      
      // æ›´æ–°UI
      renderLocations();
      updateGameData();
      
      // æ¨è¿›æ—¶é—´
      advanceTime();
    }
    
    // è®¿é—®åœ°ç‚¹
    function visitLocation(locationId) {
      // æ ¹æ®åœ°ç‚¹IDè·å–åœ°ç‚¹æ•°æ®
      const location = gameData.locations.find(loc => loc.id === locationId);
      
      if (!location) return;
      
      // æ£€æŸ¥æ˜¯å¦å·²åœ¨å½“å‰åœ°ç‚¹
      const currentLocation = gameData.locations.find(loc => loc.currentLocation);
      if (currentLocation && currentLocation.id === locationId) {
        showNotification('å·²åœ¨è¯¥åœ°ç‚¹', `ä½ å·²ç»åœ¨${location.name}äº†ã€‚`);
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦åœ¨ç‰¢æˆ¿ä¸­ä¸”è¿˜æœ‰åˆ‘æœŸï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸å…è®¸åˆ‡æ¢åˆ°å…¶ä»–åœ°ç‚¹
      if (currentLocation && currentLocation.id === 'prison') {
        const prisonLocation = gameData.locations.find(loc => loc.id === 'prison');
        if (prisonLocation && prisonLocation.sentenceDays > 0 && locationId !== 'prison') {
          showNotification('æ— æ³•ç¦»å¼€', 'ä½ è¿˜åœ¨æœåˆ‘æœŸé—´ï¼Œæ— æ³•ç¦»å¼€ç‰¢æˆ¿ï¼');
          return;
        }
      }
      
      // æ£€æŸ¥æ˜¯å¦æ»¡è¶³è¿›å…¥æ¡ä»¶
      if (!checkEntryConditions(location)) {
        return;
      }
      
      // è®¡ç®—æ€»è¡ŒåŠ¨ç‚¹æ¶ˆè€—ï¼ˆç¦»å¼€å½“å‰åœ°ç‚¹ + è¿›å…¥æ–°åœ°ç‚¹ï¼‰
      let totalActionCost = location.actionPointCost;
      if (currentLocation) {
        totalActionCost += currentLocation.actionPointCost;
      }
      
      // æ£€æŸ¥è¡ŒåŠ¨ç‚¹æ˜¯å¦è¶³å¤Ÿ
      if (gameData.status.actionPoints < totalActionCost) {
        showNotification('è¡ŒåŠ¨ç‚¹ä¸è¶³', `å‰å¾€${location.name}éœ€è¦${totalActionCost}ç‚¹è¡ŒåŠ¨ç‚¹ï¼Œä½ ç›®å‰åªæœ‰${gameData.status.actionPoints}ç‚¹ã€‚`);
        return;
      }
      
      // æ¶ˆè€—è¡ŒåŠ¨ç‚¹
      gameData.status.actionPoints -= totalActionCost;
      
      // æ›´æ–°å½“å‰åœ°ç‚¹
      if (currentLocation) {
        currentLocation.currentLocation = false;
      }
      location.currentLocation = true;
      
      // æ—¶é—´æµé€ - æ¶ˆè€—1ä¸ªå›åˆ
      gameData.timeTurns++;
      
      // æ˜¾ç¤ºè¿›å…¥é€šçŸ¥
      showNotification('è¿›å…¥åœ°ç‚¹', `ä½ è¿›å…¥äº†${location.name}ã€‚`);
      
      // æ›´æ–°UI
      renderResources();
      renderLocations(); // ç¡®ä¿åœ°ç‚¹æ ‡è¯†æ­£ç¡®æ›´æ–°
      updateGameData();
      
      // æ¶ˆè€—æ—¶é—´
      advanceTime();
    }

    // æ‰§è¡Œè¡ŒåŠ¨
    function performAction(actionId) {
      
      // æ ¹æ®è¡ŒåŠ¨IDè·å–è¡ŒåŠ¨æ•°æ®
      const action = gameData.actions.find(act => act.id === actionId);
      
      if (!action) return;
      
      // æ¶ˆè€—æ‰€éœ€èµ„æº
      if (action.requires) {
        for (const [resource, amount] of Object.entries(action.requires)) {
          gameData.resources[resource].amount -= amount;
        }
      }
      
      // æ ¹æ®è¡ŒåŠ¨ç±»å‹ç”Ÿæˆä¸åŒçš„ç»“æœ
      switch (actionId) {
        case 'beg':
          // ä¹è®¨
          let baseChance = 0.3; // åŸºç¡€å¤±è´¥æ¦‚ç‡ä¸º30%ï¼ŒæˆåŠŸç‡70%
          let successMultiplier = 1;
          const begResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          // æ£€æŸ¥æ˜¯å¦æœ‰æ”¹è‰¯ä¹è®¨ç¢—
          if (gameData.begging_chance) {
            // æ¯10ç‚¹ä¹è®¨æˆåŠŸç‡é™ä½10%çš„å¤±è´¥æ¦‚ç‡
            baseChance = Math.max(0.1, 0.3 - (gameData.begging_chance / 100));
            // åŒæ—¶å¢åŠ æˆåŠŸæ—¶çš„æ”¶ç›Š
            successMultiplier = 1 + (gameData.begging_chance / 20);
            begResults.effects.push(`ä¹è®¨æˆåŠŸç‡æå‡${gameData.begging_chance}%`);
          }
          
          const begSuccess = Math.random() > baseChance;
          
          if (begSuccess) {
            if (action.success) {
              // æœ‰30%çš„æ¦‚ç‡è·å¾—çªçªå¤´è€Œä¸æ˜¯æ®‹ç¾¹å‰©é¥­
              const getCornbread = Math.random() < 0.3;
              
              if (getCornbread) {
                // è·å¾—çªçªå¤´
                const adjustedAmount = Math.max(1, Math.round(action.success.cornbread * successMultiplier));
                gameData.resources.cornbread.amount += adjustedAmount;
                begResults.resources.cornbread = adjustedAmount;
                
                // è·å¾—é’±å¸
                const moneyAmount = Math.max(1, Math.round(action.success.money * successMultiplier));
                gameData.resources.money.amount += moneyAmount;
                begResults.resources.money = moneyAmount;
                
                showNotification('ä¹è®¨æˆåŠŸ', `ä½ æˆåŠŸä¹è®¨åˆ°äº†ä¸€ä¸ªçªçªå¤´å’Œä¸€äº›é’±å¸ã€‚${gameData.begging_chance ? `(æˆåŠŸç‡æå‡${gameData.begging_chance}%)` : ''}`);
              } else {
                // è·å¾—æ®‹ç¾¹å‰©é¥­
                const adjustedAmount = Math.max(1, Math.round(action.success.food * successMultiplier));
                gameData.resources.food.amount += adjustedAmount;
                begResults.resources.food = adjustedAmount;
                
                // è·å¾—é’±å¸
                const moneyAmount = Math.max(1, Math.round(action.success.money * successMultiplier));
                gameData.resources.money.amount += moneyAmount;
                begResults.resources.money = moneyAmount;
                
                showNotification('ä¹è®¨æˆåŠŸ', `ä½ æˆåŠŸä¹è®¨åˆ°äº†ä¸€äº›é£Ÿç‰©å’Œé’±å¸ã€‚${gameData.begging_chance ? `(æˆåŠŸç‡æå‡${gameData.begging_chance}%)` : ''}`);
              }
            }
            showEventResult('ä¹è®¨ç»“æœ', begResults);
          } else {
            if (action.failure) {
              for (const [status, amount] of Object.entries(action.failure)) {
                gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                begResults.status[status] = amount;
              }
            }
            showNotification('ä¹è®¨å¤±è´¥', 'æ²¡æœ‰äººæ„¿æ„æ–½èˆä½ ï¼Œä½ çš„ç²¾ç¥çŠ¶æ€ä¸‹é™äº†ã€‚');
            showEventResult('ä¹è®¨ç»“æœ', begResults);
          }
          break;
          
        case 'search':
          // æœå¯»
          const searchSuccess = Math.random() > 0.4; // 60% æˆåŠŸç‡
          const searchResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (searchSuccess) {
            if (action.success) {
              for (const [resource, amount] of Object.entries(action.success)) {
                if (Math.random() > 0.5) { // 50% å‡ ç‡è·å¾—æ¯ç§èµ„æº
                  gameData.resources[resource].amount += amount;
                  gameData.stats.resourcesCollected++;
                  searchResults.resources[resource] = amount;
                }
              }
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è‰è¯è¯†åˆ«èƒ½åŠ›ï¼ˆå­¦ä¹ è¿‡æœ¬è‰çº²ç›®ï¼‰
            if (gameData.skills.herbal && gameData.skills.herbal.level > 0) {
              // æ¯æ¬¡æˆåŠŸæœå¯»æœ‰30%å‡ ç‡é¢å¤–è·å¾—è‰è¯
              if (Math.random() < 0.3) {
                const herbTypes = ['ginseng', 'licorice', 'chrysanthemum']; // è‰è¯ç±»å‹
                const randomHerb = herbTypes[Math.floor(Math.random() * herbTypes.length)];
                gameData.resources[randomHerb].amount += 1;
                gameData.stats.resourcesCollected++;
                searchResults.resources[randomHerb] = 1;
                searchResults.effects.push('è¯†åˆ«åˆ°è‰è¯');
              }
            }
            
            showNotification('æœå¯»æˆåŠŸ', 'ä½ æ‰¾åˆ°äº†ä¸€äº›æœ‰ç”¨çš„ç‰©å“ã€‚' + (searchResults.effects.includes('è¯†åˆ«åˆ°è‰è¯') ? 'ä½ è¯†åˆ«å‡ºäº†ä¸€äº›è‰è¯ï¼' : ''));
            showEventResult('æœå¯»ç»“æœ', searchResults);
          } else {
            if (action.failure) {
              for (const [status, amount] of Object.entries(action.failure)) {
                gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                searchResults.status[status] = amount;
              }
            }
            showNotification('æœå¯»å¤±è´¥', 'ä½ åœ¨æœå¯»è¿‡ç¨‹ä¸­å—ä¼¤äº†ã€‚');
            showEventResult('æœå¯»ç»“æœ', searchResults);
          }
          break;
          
        case 'rest':
          // ä¼‘æ¯
          const restSuccess = Math.random() > 0.2; // 80% æˆåŠŸç‡
          const restResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (restSuccess) {
            if (action.success) {
              for (const [status, amount] of Object.entries(action.success)) {
                gameData.status[status] = Math.min(100, gameData.status[status] + amount);
                restResults.status[status] = amount;
              }
            }
            showNotification('ä¼‘æ¯æˆåŠŸ', 'ä½ å¾—åˆ°äº†å……åˆ†çš„ä¼‘æ¯ï¼Œç²¾ç¥å’Œå¥åº·éƒ½æœ‰æ‰€æ¢å¤ã€‚');
            showEventResult('ä¼‘æ¯ç»“æœ', restResults);
          } else {
            if (action.failure) {
              for (const [status, amount] of Object.entries(action.failure)) {
                gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                restResults.status[status] = amount;
              }
            }
            showNotification('ä¼‘æ¯ä¸ä½³', 'ä½ æ²¡æœ‰æ‰¾åˆ°å¥½çš„ä¼‘æ¯åœ°æ–¹ï¼Œæ„Ÿåˆ°æ›´åŠ é¥¥é¥¿å’Œå¯’å†·ã€‚');
            showEventResult('ä¼‘æ¯ç»“æœ', restResults);
          }
          break;
          
        case 'steal':
          // å·çªƒ
          const stealResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          // è·å–å½“å‰ä½ç½®
          const currentLocation = gameData.locations.find(loc => loc.currentLocation);
          const isRichArea = currentLocation && currentLocation.id === 'rich_area';
          
          // è®¡ç®—å·çªƒæˆåŠŸç‡ï¼ˆåŸºç¡€60%ï¼‰
          const baseStealChance = 0.6;
          // æŠ€èƒ½åŠ æˆï¼šæ¯çº§+5%æˆåŠŸç‡
          const skillBonus = gameData.skills.steal.level * 0.05;
          // å·å¤©æ¢æ—¥å­¦ä¹ åé¢å¤–+30%æˆåŠŸç‡
          const dayStealingBonus = gameData.skills.steal.specialAbilities?.includes('dayStealing') ? 0.3 : 0;
          // "å°å¿ƒä¸€ç‚¹"buffæƒ©ç½šï¼š-20%æˆåŠŸç‡
          const carefulBuffPenalty = gameData.buffs?.careful?.active ? 0.2 : 0;
          // è®¡ç®—æœ€ç»ˆæˆåŠŸç‡ï¼Œç¡®ä¿ä¸ä½äº0.1
          let totalStealChance = Math.min(0.95, baseStealChance + skillBonus + dayStealingBonus - carefulBuffPenalty);
          totalStealChance = Math.max(0.1, totalStealChance);
          
          const stealSuccess = Math.random() < totalStealChance;
          
          if (isRichArea) {
            // å¯ŒäººåŒºå·çªƒé€»è¾‘ - åªæœ‰æˆåŠŸå’Œå¤±è´¥ä¸¤ç§ç»“æœ
            if (stealSuccess) {
              // å·çªƒæˆåŠŸï¼Œè·å¾—ç‰©å“ - ç¡®ä¿è‡³å°‘è·å¾—1ä»¶ç‰©å“
              
              // å¯ŒäººåŒºå¯èƒ½å‡ºç°çš„ç‰©å“åŠå…¶æƒé‡
              const richAreaLootTable = [
                { resource: 'money', minAmount: 5, maxAmount: 20, weight: 3 },
                { resource: 'gold_bar', minAmount: 1, maxAmount: 2, weight: 1 },
                { resource: 'black_cloth', minAmount: 1, maxAmount: 3, weight: 2 },
                { resource: 'thread', minAmount: 2, maxAmount: 5, weight: 2 },
                { resource: 'jewelry', minAmount: 1, maxAmount: 2, weight: 1 },
                { resource: 'luxury_item', minAmount: 1, maxAmount: 1, weight: 1 }
              ];
              
              // åŠ æƒéšæœºé€‰æ‹©ç‰©å“
              let totalWeight = richAreaLootTable.reduce((sum, item) => sum + item.weight, 0);
              let random = Math.random() * totalWeight;
              let selectedItem = null;
              
              for (const item of richAreaLootTable) {
                random -= item.weight;
                if (random <= 0) {
                  selectedItem = item;
                  break;
                }
              }
              
              // ç¡®ä¿è‡³å°‘è·å¾—1ä»¶ç‰©å“
              if (selectedItem && selectedItem.resource in gameData.resources) {
                // è®¡ç®—ç‰©å“æ•°é‡
                const amount = Math.floor(Math.random() * (selectedItem.maxAmount - selectedItem.minAmount + 1)) + selectedItem.minAmount;
                
                // å¢åŠ ç©å®¶èµ„æº
                gameData.resources[selectedItem.resource].amount += amount;
                stealResults.resources[selectedItem.resource] = amount;
                
                // è·å–ç‰©å“åç§°ç”¨äºé€šçŸ¥
                const itemName = gameData.resources[selectedItem.resource].name || selectedItem.resource;
                showNotification('å·çªƒæˆåŠŸ', `ä½ åœ¨å¯ŒäººåŒºæˆåŠŸå·åˆ°äº† ${amount} ä¸ª ${itemName}ï¼`);
              } else {
                // ä¿åº•é€»è¾‘ - å¦‚æœä»¥ä¸Šé€»è¾‘å¤±è´¥ï¼Œè‡³å°‘ç»™1ä¸ªé‡‘å¸
                if ('money' in gameData.resources) {
                  gameData.resources.money.amount += 5;
                  stealResults.resources.money = 5;
                  showNotification('å·çªƒæˆåŠŸ', 'ä½ åœ¨å¯ŒäººåŒºæˆåŠŸå·åˆ°äº† 5 ä¸ªé‡‘å¸ï¼');
                } else {
                  showNotification('å·çªƒæˆåŠŸ', 'ä½ åœ¨å¯ŒäººåŒºæˆåŠŸå·åˆ°äº†ä¸€äº›è´µé‡ç‰©å“ï¼');
                }
              }
              
              // æˆåŠŸå¥–åŠ±å·²ç»åœ¨å‰é¢çš„é€»è¾‘ä¸­å¤„ç†
                
                // å¢åŠ å·çªƒæŠ€èƒ½ç»éªŒ - æˆåŠŸæ—¶å¢åŠ 5ç‚¹
                if (gameData.skills.steal) {
                  const experienceGain = 5;
                  gameData.skills.steal.experience = (gameData.skills.steal.experience || 0) + experienceGain;
                  
                  // æ·»åŠ ç»éªŒå¢åŠ åˆ°ç»“æœä¸­
                  stealResults.effects = stealResults.effects || [];
                  stealResults.effects.push(`å·çªƒæŠ€èƒ½ç»éªŒ +${experienceGain}`);
                  
                  // æ£€æŸ¥æ˜¯å¦éœ€è¦å‡çº§ï¼ˆå¦‚æœæœ‰å‡çº§é€»è¾‘çš„è¯ï¼‰
                  // è¿™é‡Œå¯ä»¥æ ¹æ®æ¸¸æˆçš„å‡çº§æœºåˆ¶å®ç°æŠ€èƒ½å‡çº§æ£€æŸ¥
                  updateSkillDisplay(); // æ›´æ–°æŠ€èƒ½æ˜¾ç¤ºUI
                }
              showEventResult('å·çªƒæˆåŠŸ', stealResults);
            } else {
              // å¯ŒäººåŒºå·çªƒå¤±è´¥ - ç›´æ¥è¢«æŠ“
              showNotification('å·çªƒå¤±è´¥', 'ä½ åœ¨å¯ŒäººåŒºå·çªƒæ—¶è¢«å‘ç°å¹¶è¢«å·¡é€»é˜ŸæŠ“ä½äº†ï¼');
              
              // æ·»åŠ å…³æŠ¼ä¿¡æ¯åˆ°äº‹ä»¶ç»“æœ
              stealResults.effects.push('è¢«å·¡é€»é˜ŸæŠ“ä½é€è¿›ç‰¢æˆ¿ï¼Œå…³æŠ¼4å¤©');
              
              showEventResult('å·çªƒå¤±è´¥', stealResults);
              
              // å°†ç©å®¶é€å¾€ç‰¢æˆ¿
              sendToPrison();
              return; // ä¸ç»§ç»­æ‰§è¡Œåç»­ä»£ç 
            }
          } else {
            // éå¯ŒäººåŒºçš„æ™®é€šå·çªƒé€»è¾‘
            if (stealSuccess) {
              // å·çªƒæˆåŠŸï¼Œä¸å‡å°‘å£°æœ›
              
              // æ·»åŠ é‡‘æ¡
              gameData.resources.gold_bar.amount += 1;
              stealResults.resources.gold_bar = 1;
              
              showNotification('å·çªƒæˆåŠŸ', 'ä½ æˆåŠŸå·åˆ°äº†ä¸€äº›è´¢ç‰©å’Œä¸€æ ¹é‡‘æ¡ï¼');
              showEventResult('å·çªƒæˆåŠŸ', stealResults);
            } else {
              // å·çªƒå¤±è´¥ï¼Œæœ‰æ¦‚ç‡è¢«æŠ“
              const caughtChance = 0.7; // 70%æ¦‚ç‡è¢«æŠ“
              const isCaught = Math.random() < caughtChance;
              
              if (isCaught) {
                // è¢«æŠ“ä½ï¼Œé€è¿›ç‰¢æˆ¿
                showNotification('å·çªƒå¤±è´¥', 'ä½ åœ¨å·çªƒæ—¶è¢«å·¡é€»å£«å…µå‘ç°å¹¶è¢«æŠ“ä½äº†ï¼');
                
                // æ·»åŠ å…³æŠ¼ä¿¡æ¯åˆ°äº‹ä»¶ç»“æœ
                stealResults.effects.push('è¢«å·¡é€»é˜ŸæŠ“ä½é€è¿›ç‰¢æˆ¿ï¼Œå…³æŠ¼4å¤©');
                
                showEventResult('å·çªƒå¤±è´¥', stealResults);
                
                // å°†ç©å®¶é€å¾€ç‰¢æˆ¿
                sendToPrison();
                return; // ä¸ç»§ç»­æ‰§è¡Œåç»­ä»£ç 
              } else {
                // æ²¡è¢«æŠ“ä½ï¼Œä½†å£°æœ›é™ä½
                if (action.failure) {
                  for (const [status, amount] of Object.entries(action.failure)) {
                    if (status !== 'reputation') { // ä¸å‡å°‘å£°æœ›
                      gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                      stealResults.status[status] = amount;
                    }
                  }
                }
                // é¢å¤–å‡å°‘å£°æœ›
                const reputationLoss = -15;
                gameData.status.reputation = Math.max(-49, gameData.status.reputation + reputationLoss);
                stealResults.status.reputation = reputationLoss;
                
                showNotification('å·çªƒå¤±è´¥', 'ä½ åœ¨å·çªƒæ—¶å·®ç‚¹è¢«å‘ç°ï¼Œä¾¥å¹¸é€ƒè„±ï¼Œä½†å£°æœ›é™ä½äº†ã€‚');
                showEventResult('å·çªƒå¤±è´¥', stealResults);
              }
            }
          }
          break;
          
        case 'donate':
          // æ•‘æµ
          const donateSuccess = Math.random() > 0.1; // 90% æˆåŠŸç‡
          const donateResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (donateSuccess) {
            if (action.success) {
              for (const [resource, amount] of Object.entries(action.success)) {
                if (resource in gameData.resources) {
                  gameData.resources[resource].amount += amount;
                  donateResults.resources[resource] = amount;
                } else if (resource in gameData.status) {
                  gameData.status[resource] = Math.min(100, gameData.status[resource] + amount);
                  donateResults.status[resource] = amount;
                }
              }
            }
            showNotification('æ•‘æµæˆåŠŸ', 'å¯ºåº™ä¸ºä½ æä¾›äº†é£Ÿç‰©å’Œä½å®¿ï¼Œä½ çš„å¥åº·å’Œç²¾ç¥éƒ½æœ‰æ‰€æ¢å¤ã€‚');
            showEventResult('æ•‘æµç»“æœ', donateResults);
          } else {
            showNotification('æ•‘æµå¤±è´¥', 'ä»Šå¤©å¯ºåº™æ²¡æœ‰æä¾›æ•‘æµã€‚');
            showEventResult('æ•‘æµç»“æœ', donateResults);
          }
          break;
          
        case 'pray':
          // ç¥ˆç¦
          const praySuccess = Math.random() > 0.3; // 70% æˆåŠŸç‡
          const prayResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (praySuccess) {
            if (action.success) {
              for (const [status, amount] of Object.entries(action.success)) {
                gameData.status[status] = Math.min(100, gameData.status[status] + amount);
                prayResults.status[status] = amount;
              }
            }
            showNotification('ç¥ˆç¦æˆåŠŸ', 'ä½ çš„ç¥ˆç¥·å¾—åˆ°äº†å›åº”ï¼Œç²¾ç¥å’Œå£°æœ›éƒ½æœ‰æ‰€æå‡ã€‚');
            showEventResult('ç¥ˆç¦ç»“æœ', prayResults);
          } else {
            if (action.failure) {
              for (const [status, amount] of Object.entries(action.failure)) {
                gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                prayResults.status[status] = amount;
              }
            }
            showNotification('ç¥ˆç¦å¤±è´¥', 'ä½ çš„ç¥ˆç¥·æ²¡æœ‰å¾—åˆ°å›åº”ï¼Œç²¾ç¥çŠ¶æ€ä¸‹é™äº†ã€‚');
            showEventResult('ç¥ˆç¦ç»“æœ', prayResults);
          }
          break;
          
        case 'trade':
          // äº¤æ˜“
          const tradeSuccess = Math.random() > 0.4; // 60% æˆåŠŸç‡
          const tradeResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (tradeSuccess) {
            if (action.success) {
              for (const [resource, amount] of Object.entries(action.success)) {
                gameData.resources[resource].amount += amount;
                tradeResults.resources[resource] = amount;
              }
            }
            showNotification('äº¤æ˜“æˆåŠŸ', 'ä½ æˆåŠŸä¸å…¶ä»–ä¹ä¸äº¤æ¢äº†ç‰©èµ„ã€‚');
            showEventResult('äº¤æ˜“ç»“æœ', tradeResults);
          } else {
            if (action.failure) {
              for (const [resource, amount] of Object.entries(action.failure)) {
                gameData.resources[resource].amount = Math.max(0, gameData.resources[resource].amount + amount);
                tradeResults.resources[resource] = amount;
              }
            }
            showNotification('äº¤æ˜“å¤±è´¥', 'ä½ åœ¨äº¤æ˜“ä¸­è¢«éª—ï¼ŒæŸå¤±äº†ä¸€äº›ç‰©èµ„ã€‚');
            showEventResult('äº¤æ˜“ç»“æœ', tradeResults);
          }
          break;
          
        case 'learn':
          // å­¦ä¹ 
          const learnSuccess = Math.random() > 0.3; // 70% æˆåŠŸç‡
          const learnResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (learnSuccess) {
            if (action.success) {
              for (const [status, amount] of Object.entries(action.success)) {
                gameData.status[status] = Math.min(100, gameData.status[status] + amount);
                learnResults.status[status] = amount;
              }
            }
            
            // éšæœºè§£é”ä¸€ä¸ªæœªè§£é”çš„é…æ–¹
            const undiscoveredRecipes = gameData.recipes.filter(recipe => !gameData.discoveredRecipes.includes(recipe.id));
            if (undiscoveredRecipes.length > 0) {
              const recipeToDiscover = undiscoveredRecipes[Math.floor(Math.random() * undiscoveredRecipes.length)];
              gameData.discoveredRecipes.push(recipeToDiscover.id);
              gameData.stats.recipesDiscovered++;
              learnResults.effects.push(`è§£é”äº†æ–°é…æ–¹: ${recipeToDiscover.name}`);
              showNotification('å­¦ä¹ æˆåŠŸ', `ä½ å­¦ä¼šäº†æ–°çš„åˆ¶ä½œæŠ€èƒ½ï¼Œè§£é”äº†${recipeToDiscover.name}çš„é…æ–¹ï¼`);
            } else {
              showNotification('å­¦ä¹ æˆåŠŸ', 'ä½ å­¦ä¹ äº†æ–°çš„æŠ€èƒ½ï¼Œå£°æœ›æœ‰æ‰€æå‡ã€‚');
            }
            
            showEventResult('å­¦ä¹ ç»“æœ', learnResults);
          } else {
            if (action.failure) {
              for (const [status, amount] of Object.entries(action.failure)) {
                gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                learnResults.status[status] = amount;
              }
            }
            showNotification('å­¦ä¹ å¤±è´¥', 'ä½ æ²¡æœ‰å­¦åˆ°æœ‰ç”¨çš„æŠ€èƒ½ï¼Œç²¾ç¥çŠ¶æ€ä¸‹é™äº†ã€‚');
            showEventResult('å­¦ä¹ ç»“æœ', learnResults);
          }
          break;
          

          
        case 'work':
          // åŠ³ä½œï¼ˆæ¶ˆè€—åŠå¤©æ—¶é—´ï¼‰
          const workSuccess = Math.random() > 0.4; // 60% æˆåŠŸç‡
          const workResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          // æ¶ˆè€—åŠå¤©æ—¶é—´ï¼ˆå¢åŠ 1.5ä¸ªå›åˆï¼‰
          gameData.timeTurns += 1.5;
          advanceTime(); // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¨è¿›æ—¶é—´æ®µ
          
          if (workSuccess) {
            if (action.success) {
              for (const [resource, amount] of Object.entries(action.success)) {
                if (resource in gameData.resources) {
                  gameData.resources[resource].amount += amount;
                  workResults.resources[resource] = amount;
                }
              }
            }
            
            // å‡å°‘åˆ‘æœŸ
            const prisonLocation = gameData.locations.find(loc => loc.id === 'prison');
            if (prisonLocation && prisonLocation.currentLocation) {
              prisonLocation.sentenceDays = Math.max(1, prisonLocation.sentenceDays - 1); // ç¡®ä¿è‡³å°‘å‰©ä½™1å¤©
              const daysMessage = prisonLocation.sentenceDays === 1 ? 'æœ€åä¸€å¤©' : `${prisonLocation.sentenceDays}å¤©`;
              workResults.effects.push(`åˆ‘æœŸå‡å°‘1å¤©ï¼Œå‰©ä½™${daysMessage}`);
            }
            
            showNotification('åŠ³ä½œæˆåŠŸ', 'ä½ å®Œæˆäº†ä»Šå¤©çš„åŠ³åŠ¨ï¼Œè·å¾—äº†å°‘é‡æŠ¥é…¬ï¼Œåˆ‘æœŸå‡å°‘äº†1å¤©ã€‚');
            showEventResult('åŠ³ä½œç»“æœ', workResults);
          } else {
            if (action.failure) {
              for (const [status, amount] of Object.entries(action.failure)) {
                gameData.status[status] = Math.max(0, gameData.status[status] + amount);
                workResults.status[status] = amount;
              }
            }
            
            showNotification('åŠ³ä½œå¤±è´¥', 'ä½ åœ¨åŠ³åŠ¨ä¸­å—ä¼¤äº†ï¼Œæ²¡æœ‰è·å¾—ä»»ä½•æŠ¥é…¬ã€‚');
            showEventResult('åŠ³ä½œç»“æœ', workResults);
          }
          break;
          
        case 'gamble':
          // èµŒåš
          const gambleSuccess = Math.random() > 0.6; // 40% æˆåŠŸç‡
          const gambleResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          if (gambleSuccess) {
            if (action.success) {
              for (const [resource, amount] of Object.entries(action.success)) {
                if (resource in gameData.resources) {
                  gameData.resources[resource].amount += amount;
                  gambleResults.resources[resource] = amount;
                }
              }
            }
            
            showNotification('èµŒåšæˆåŠŸ', 'ä½ åœ¨èµŒåšä¸­èµ¢äº†ï¼');
            showEventResult('èµŒåšç»“æœ', gambleResults);
          } else {
            if (action.failure) {
              for (const [resource, amount] of Object.entries(action.failure)) {
                if (resource in gameData.resources) {
                  gameData.resources[resource].amount = Math.max(0, gameData.resources[resource].amount + amount);
                  gambleResults.resources[resource] = amount;
                } else if (resource in gameData.status) {
                  gameData.status[resource] = Math.max(0, gameData.status[resource] + amount);
                  gambleResults.status[resource] = amount;
                }
              }
            }
            
            showNotification('èµŒåšå¤±è´¥', 'ä½ åœ¨èµŒåšä¸­è¾“äº†ï¼ŒæŸå¤±äº†ä¸€äº›é’±å¸ï¼Œç²¾ç¥çŠ¶æ€ä¹Ÿä¸‹é™äº†ã€‚');
            showEventResult('èµŒåšç»“æœ', gambleResults);
          }
          break;
          
        case 'buy_goods':
          // æ‰“å¼€é»‘å¸‚è´§æ¶
          openBlackMarketShelf();
          return; // ä¸æ¶ˆè€—è¡ŒåŠ¨ç‚¹ï¼Œä¸ç»“æŸå›åˆ
          break;
          
        case 'buy_slave':
          // è´­ä¹°å¥´éš¶
          const buySlaveResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„é‡‘æ¡
          if (gameData.resources.gold_bar.amount >= 3) {
            // æ¶ˆè€—é‡‘æ¡
            gameData.resources.gold_bar.amount -= 3;
            buySlaveResults.resources.gold_bar = -3;
            
            // æ·»åŠ å¥´éš¶
            gameData.resources.slave.amount += 1;
            buySlaveResults.resources.slave = 1;
            
            showNotification('è´­ä¹°æˆåŠŸ', 'ä½ ç”¨3å¼ é»„é‡‘å¡ç‰Œè´­ä¹°äº†ä¸€ä¸ªå¥´éš¶ï¼å¥´éš¶æ¯å¤©ä¼šè‡ªåŠ¨å¸®ä½ æ”¶é›†èµ„æºã€‚');
            showEventResult('è´­ä¹°ç»“æœ', buySlaveResults);
          } else {
            showNotification('è´­ä¹°å¤±è´¥', 'ä½ æ²¡æœ‰è¶³å¤Ÿçš„é»„é‡‘å¡ç‰Œï¼éœ€è¦3å¼ æ‰èƒ½è´­ä¹°å¥´éš¶ã€‚');
            showEventResult('è´­ä¹°ç»“æœ', buySlaveResults);
          }
          break;
          

          
        case 'open_black_market_shelf':
          // æ‰“å¼€é»‘å¸‚è´§æ¶
          openBlackMarketShelf();
          return; // ä¸ç»“æŸå›åˆ
          
        case 'talk_mystery':
          // ä¸ç¥ç§˜äººå¯¹è¯
          const talkMysteryResults = {
            resources: {},
            status: {},
            effects: []
          };
          
          // æ£€æŸ¥æ˜¯å¦å·²ç»è§£é”é»‘å¸‚
          const blackMarketLocation = gameData.locations.find(loc => loc.id === 'black_market');
          if (blackMarketLocation && blackMarketLocation.available) {
            showNotification('å·²è§£é”é»‘å¸‚', 'ä½ å·²ç»çŸ¥é“äº†é»‘å¸‚çš„æ¶ˆæ¯ï¼Œå¯ä»¥éšæ—¶å‰å¾€ã€‚');
            showEventResult('å¯¹è¯ç»“æœ', talkMysteryResults);
            break;
          }
          
          // ç¥ç§˜äººä»»åŠ¡ï¼šå¸®åŠ©ä»–ä¼ é€’ä¸€å°ä¿¡
          // æœ‰50%æ¦‚ç‡éœ€è¦ä¸åŒçš„ç‰©å“
          const taskType = Math.random() > 0.5 ? 'food' : 'cloth';
          const requiredAmount = taskType === 'food' ? 2 : 3;
          
          if (gameData.resources[taskType].amount >= requiredAmount) {
            // æ¶ˆè€—æ‰€éœ€ç‰©å“
            gameData.resources[taskType].amount -= requiredAmount;
            talkMysteryResults.resources[taskType] = -requiredAmount;
            
            // è§£é”é»‘å¸‚
            if (blackMarketLocation) {
              blackMarketLocation.available = true;
              talkMysteryResults.effects.push('è§£é”äº†é»‘å¸‚åœ°ç‚¹');
            }
            
            // è·å¾—å°‘é‡æŠ¥é…¬
            const rewardAmount = taskType === 'food' ? 1 : 2;
            gameData.resources.money.amount += rewardAmount;
            talkMysteryResults.resources.money = rewardAmount;
            
            // é‡æ–°æ¸²æŸ“åœ°ç‚¹æ ï¼Œæ˜¾ç¤ºé»‘å¸‚
            renderLocations();
            
            showNotification('ä»»åŠ¡å®Œæˆ', `ä½ å¸®åŠ©ç¥ç§˜äººä¼ é€’äº†ä¿¡ä»¶ï¼Œä»–å‘Šè¯‰ä½ é»‘å¸‚çš„ä½ç½®ï¼Œå¹¶ç»™äº†ä½ ${rewardAmount}æšé’±å¸ä½œä¸ºæŠ¥é…¬ã€‚`);
            showEventResult('å¯¹è¯ç»“æœ', talkMysteryResults);
          } else {
            // æ²¡æœ‰è¶³å¤Ÿçš„ç‰©å“
            showNotification('ä»»åŠ¡å¤±è´¥', `ç¥ç§˜äººéœ€è¦${requiredAmount}ä»½${gameData.resources[taskType].name}æ¥ä¼ é€’ä¿¡ä»¶ï¼Œä½†ä½ æ²¡æœ‰è¶³å¤Ÿçš„${gameData.resources[taskType].name}ã€‚`);
            showEventResult('å¯¹è¯ç»“æœ', talkMysteryResults);
          }
          break;
          
        case 'craft':
          // åˆ¶ä½œ
          renderRecipes();
          elements.recipeModal.classList.add('active');
          return; // ä¸ç»“æŸå›åˆ
      }
      
      // æ›´æ–°UI
      renderResources();
      renderActions();
      updateGameData();
      
      // æ¶ˆè€—æ—¶é—´
      advanceTime();
    }

    // è§¦å‘éšæœºäº‹ä»¶
    function triggerRandomEvent() {
      const event = gameData.events[Math.floor(Math.random() * gameData.events.length)];
      
      elements.eventTitle.textContent = event.name;
      elements.eventText.textContent = event.text;
      
      // æ¸…ç©ºå¹¶æ·»åŠ é€‰é¡¹
      elements.eventOptions.innerHTML = '';
      
      for (const option of event.options) {
        const optionElement = document.createElement('div');
        optionElement.className = 'event-modal-option';
        
        optionElement.innerHTML = `
          <div class="event-modal-option-text">${option.text}</div>
          <div class="event-modal-option-description">${option.description}</div>
        `;
        
        optionElement.addEventListener('click', () => {
          // åº”ç”¨é€‰é¡¹ç»“æœ
          for (const [resource, amount] of Object.entries(option.result)) {
            if (resource in gameData.resources) {
              gameData.resources[resource].amount = Math.max(0, gameData.resources[resource].amount + amount);
            } else if (resource in gameData.status) {
              gameData.status[resource] = Math.min(100, Math.max(0, gameData.status[resource] + amount));
            }
          }
          
          // æ›´æ–°UI
          renderResources();
          updateGameData();
          
          elements.eventModal.classList.remove('active');
          endTurn();
        });
        
        elements.eventOptions.appendChild(optionElement);
      }
      
      elements.eventModal.classList.add('active');
    }

    // é€è¿›ç‰¢æˆ¿
    function sendToPrison() {
      // è·å–å½“å‰åœ°ç‚¹
      const currentLocation = gameData.locations.find(loc => loc.currentLocation);
      
      if (currentLocation) {
        currentLocation.currentLocation = false;
      }
      
      // æ‰¾åˆ°ç‰¢æˆ¿åœ°ç‚¹å¹¶è®¾ç½®ä¸ºå½“å‰åœ°ç‚¹
      const prisonLocation = gameData.locations.find(loc => loc.id === 'prison');
      if (prisonLocation) {
        prisonLocation.currentLocation = true;
        prisonLocation.available = true;
        
        // è®¾ç½®åˆ‘æœŸï¼ˆ4å¤©ï¼‰
        prisonLocation.sentenceDays = 4;
        
        // æ˜¾ç¤ºè¢«æ•é€šçŸ¥
        showNotification('è¢«æ•å…¥ç‹±', `ä½ å› å·çªƒè¢«æŠ“ï¼Œè¢«åˆ¤å¤„ç›‘ç¦4å¤©ï¼`);
        
        // å‡å°‘å¥åº·å’Œç²¾ç¥
        gameData.status.health -= 20;
        gameData.status.spirit -= 30;
        
        // æ›´æ–°UI
        renderLocations();
        renderActions();
        updateGameData();
      }
    }
    
    // æ¨è¿›æ—¶é—´
    function advanceTime() {
      const timeOrder = ['early_morning', 'morning', 'afternoon', 'evening', 'night'];
      const currentTimeIndex = timeOrder.indexOf(gameData.timeOfDay);
      
      // å¢åŠ å½“å‰æ—¶é—´æ®µçš„å›åˆæ•°
      gameData.timeTurns++;
      
      // å¦‚æœå½“å‰æ—¶é—´æ®µå·²è¿›è¡Œ3ä¸ªå›åˆï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ®µ
      if (gameData.timeTurns >= 3) {
        const nextTimeIndex = (currentTimeIndex + 1) % timeOrder.length;
        gameData.timeOfDay = timeOrder[nextTimeIndex];
        gameData.timeTurns = 0; // é‡ç½®å›åˆæ•°
        
        // å¦‚æœæ—¶é—´ä»æ™šä¸Šå˜ä¸ºæ¸…æ™¨ï¼Œå¢åŠ ä¸€å¤©
        if (gameData.timeOfDay === 'early_morning' && timeOrder[currentTimeIndex] === 'night') {
          gameData.day++;
          
          // é‡ç½®è¡ŒåŠ¨ç‚¹ä¸ºæ»¡å€¼
          gameData.status.actionPoints = 20;
          
          // æ£€æŸ¥æ˜¯å¦åœ¨ç‰¢æˆ¿ä¸­
            const prisonLocation = gameData.locations.find(loc => loc.id === 'prison');
            if (prisonLocation && prisonLocation.currentLocation) {
              // å‡å°‘åˆ‘æœŸ
              prisonLocation.sentenceDays--;
              
              if (prisonLocation.sentenceDays <= 0) {
                // åˆ‘æœŸç»“æŸï¼Œé‡Šæ”¾å‡ºç‹±
                releaseFromPrison();
              } else {
                // æ˜¾ç¤ºå‰©ä½™åˆ‘æœŸé€šçŸ¥ï¼Œå‰©ä½™1å¤©æ˜¾ç¤ºä¸º"æœ€åä¸€å¤©"
                const daysMessage = prisonLocation.sentenceDays === 1 ? 'æœ€åä¸€å¤©' : `${prisonLocation.sentenceDays}å¤©`;
                showNotification('åˆ‘æœŸé€šçŸ¥', `ä½ è¿˜éœ€è¦åœ¨ç‰¢æˆ¿ä¸­åº¦è¿‡${daysMessage}ã€‚`);
                
                // åœ¨ç‰¢æˆ¿ä¸­æ¯å¤©å‡å°‘å¥åº·å’Œç²¾ç¥
                gameData.status.health -= 5;
                gameData.status.spirit -= 5;
              }
            }
          
          // æ›´æ–°å­£èŠ‚
          if (gameData.day % 10 === 1) {
            const seasons = ['spring', 'summer', 'autumn', 'winter'];
            const currentSeasonIndex = seasons.indexOf(gameData.season);
            gameData.season = seasons[(currentSeasonIndex + 1) % 4];
            
            showNotification('å­£èŠ‚å˜åŒ–', `ç°åœ¨æ˜¯${gameData.season === 'spring' ? 'æ˜¥å­£' : gameData.season === 'summer' ? 'å¤å­£' : gameData.season === 'autumn' ? 'ç§‹å­£' : 'å†¬å­£'}äº†ã€‚`);
          }
          
          // æ ¹æ®å­£èŠ‚æ¶ˆè€—èµ„æº
          switch (gameData.season) {
            case 'spring':
              gameData.status.hunger += 5;  // é¥¥é¥¿å¢åŠ 
              gameData.status.cold += 5;    // å¯’å†·å‡å°‘
              break;
            case 'summer':
              gameData.status.hunger += 8;  // é¥¥é¥¿å¢åŠ æ›´å¤š
              gameData.status.cold += 10;   // å¯’å†·å‡å°‘æ›´å¤š
              gameData.status.health -= 3;  // å¤å­£å®¹æ˜“ç”Ÿç—…
              break;
            case 'autumn':
              gameData.status.hunger += 7;  // é¥¥é¥¿å¢åŠ 
              gameData.status.cold -= 5;    // å¯’å†·å¢åŠ 
              break;
            case 'winter':
              gameData.status.hunger += 10; // é¥¥é¥¿å¢åŠ æœ€å¤š
              gameData.status.cold -= 15;   // å¯’å†·å¢åŠ æœ€å¤š
              gameData.status.health -= 5;  // å†¬å­£å®¹æ˜“ç”Ÿç—…
              break;
          }
          
          // ç‰©å“è€ä¹…åº¦å‡å°‘
          decreaseItemDurability();
          
          // å¥´éš¶è‡ªåŠ¨æ”¶é›†èµ„æº
          if (gameData.resources.slave.amount > 0) {
            const slaveResults = {
              resources: {},
              status: {},
              effects: []
            };
            
            // æ¯ä¸ªå¥´éš¶æ¯å¤©éšæœºæ”¶é›†ä¸€äº›èµ„æº
            for (let i = 0; i < gameData.resources.slave.amount; i++) {
              const resources = ['food', 'money', 'cloth', 'stick', 'black_cloth', 'thread'];
              const resource = resources[Math.floor(Math.random() * resources.length)];
              const amount = Math.floor(Math.random() * 2) + 1; // 1-2ä¸ªèµ„æº
              
              gameData.resources[resource].amount += amount;
              slaveResults.resources[resource] = (slaveResults.resources[resource] || 0) + amount;
            }
            
            // æ˜¾ç¤ºå¥´éš¶æ”¶é›†èµ„æºçš„é€šçŸ¥
            if (Object.keys(slaveResults.resources).length > 0) {
              let message = `ä½ çš„${gameData.resources.slave.amount}ä¸ªå¥´éš¶ä¸ºä½ æ”¶é›†äº†ï¼š`;
              for (const [resource, amount] of Object.entries(slaveResults.resources)) {
                message += `${gameData.resources[resource].name}x${amount}ï¼Œ`;
              }
              message = message.slice(0, -1) + 'ã€‚';
              
              showNotification('å¥´éš¶çš„æ”¶è·', message);
              showEventResult('å¥´éš¶æ”¶è·', slaveResults);
            }
          }
          
          // æ˜¾ç¤ºæ–°çš„ä¸€å¤©é€šçŸ¥
          if (!prisonLocation || !prisonLocation.currentLocation) {
            showTimeNotification('æ–°çš„ä¸€å¤©', `è¿™æ˜¯ä½ ç”Ÿå­˜çš„ç¬¬${gameData.day}å¤©ã€‚`);
          }
        } else {
          // æ ¹æ®æ—¶é—´æ®µæ˜¾ç¤ºä¸åŒçš„é€šçŸ¥
          const timeMessages = {
            early_morning: 'æ¸…æ™¨',
            morning: 'ä¸Šåˆ',
            afternoon: 'ä¸‹åˆ',
            evening: 'å‚æ™š',
            night: 'å¤œæ™š'
          };
          
          showTimeNotification('æ—¶é—´æµé€', `ç°åœ¨æ˜¯${timeMessages[gameData.timeOfDay]}äº†ã€‚`);
        }
      } else {
        // æ ¹æ®æ—¶é—´æ®µæ˜¾ç¤ºä¸åŒçš„é€šçŸ¥
        const timeMessages = {
          early_morning: 'æ¸…æ™¨',
          morning: 'ä¸Šåˆ',
          afternoon: 'ä¸‹åˆ',
          evening: 'å‚æ™š',
          night: 'å¤œæ™š'
        };
        
        showNotification('æ—¶é—´æµé€', `ç°åœ¨æ˜¯${timeMessages[gameData.timeOfDay]}ï¼Œå‰©ä½™å›åˆï¼š${3 - gameData.timeTurns}`);
      }
      
      // æ— é™æ¨¡å¼ - ç§»é™¤æ‰€æœ‰æ¸¸æˆç»“æŸæ¡ä»¶
      // çŠ¶æ€å€¼ä¸ä¼šå¯¼è‡´æ¸¸æˆç»“æŸï¼Œä½†ä¼šå½±å“æ¸¸æˆä½“éªŒ
      // ä¿æŒçŠ¶æ€å€¼åœ¨åˆç†èŒƒå›´å†…
      gameData.status.health = Math.max(1, Math.min(100, gameData.status.health));
      gameData.status.hunger = Math.max(0, Math.min(99, gameData.status.hunger));
      gameData.status.cold = Math.max(1, Math.min(100, gameData.status.cold));
      gameData.status.spirit = Math.max(1, Math.min(100, gameData.status.spirit));
      gameData.status.reputation = Math.max(-49, Math.min(99, gameData.status.reputation));
      
      // æ›´æ–°UI
      updateGameData();
      renderActions();
      
      return false;
    }
    
    // æ‰“å¼€é»‘å¸‚è´§æ¶
    function openBlackMarketShelf() {
      // åˆ›å»ºè´§æ¶å¼¹çª—
      const shelfModal = document.createElement('div');
      shelfModal.className = 'shelf-modal';
      shelfModal.id = 'blackMarketShelfModal';
      shelfModal.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #1A202C;
        border: 2px solid #4A5568;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        width: 90%;
        max-width: 900px;
        max-height: 85vh;
        overflow-y: auto;
        transition: all 0.3s ease;
        background-image: linear-gradient(135deg, #1A202C 0%, #2D3748 100%);
      `;
      
      // è´§æ¶å•†å“åˆ—è¡¨
      const shelfItems = [
        { id: 'medicine', name: 'çµè¯', price: 1, description: 'çè´µçš„è‰è¯ï¼Œèƒ½æ¢å¤å¤§é‡å¥åº·' },
        { id: 'house_deed', name: 'æˆ¿å±‹åœ°å¥‘', price: 1, description: 'æ‹¥æœ‰è‡ªå·±çš„æˆ¿äº§ï¼Œæé«˜å£°æœ›å’Œç²¾ç¥çŠ¶æ€' },
        { id: 'fine_clothes', name: 'ç²¾ç¾åæœ', price: 1, description: 'åä¸½çš„æœè£…ï¼Œå¤§å¹…æé«˜å£°æœ›å’Œä¿æš–åº¦' },
        { id: 'silk_shoes', name: 'ç¼é‹', price: 1, description: 'ç²¾è‡´çš„ç¼é¢é‹å­ï¼Œæé«˜å£°æœ›å’Œå¥åº·' },
        { id: 'ornate_shoes', name: 'é”¦å±¥', price: 1, description: 'åä¸½çš„é”¦ç¼é‹å­ï¼Œå¤§å¹…æå‡å£°æœ›å’Œå¥åº·åº¦' },
        { id: 'dog_beating_stick', name: 'æ‰“ç‹—æ£’æ³•', price: 1, description: 'ä¸å¸®ç»æŠ€ï¼Œæé«˜æˆ˜æ–—åŠ›å’Œå£°æœ›', special: true },
        { id: 'herbal_medicine_book', name: 'æœ¬è‰çº²ç›®', price: 1, description: 'åŒ»å­¦ç»å…¸ï¼Œæé«˜å¥åº·æ¢å¤é€Ÿåº¦', special: true },
        { id: 'huangdi_neijing', name: 'é»„å¸å†…ç»', price: 1, description: 'åŒ»å­¦ç»å…¸ï¼Œå¤§å¹…æé«˜å¥åº·ä¸Šé™', special: true },
        { id: 'stealth_book', name: 'å·å¤©æ¢æ—¥', price: 1, description: 'ç›—çªƒæŠ€å·§ï¼Œæé«˜å·çªƒæˆåŠŸç‡', special: true }
      ];
      
      // å¼¹çª—å†…å®¹
      shelfModal.innerHTML = `
        <div class="shelf-modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid #4A5568;">
          <h3 style="font-size: 1.5rem; font-weight: 700; color: #EDF2F7; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">é»‘å¸‚è´§æ¶</h3>
          <button id="closeShelfButton" style="background: #4A5568; border: none; font-size: 1.25rem; cursor: pointer; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">&times;</button>
        </div>
        <div class="shelf-modal-body">
          <div class="current-gold" style="margin-bottom: 1.5rem; text-align: center; font-size: 1.25rem; font-weight: 600; color: #E2E8F0;">
            <span style="background: linear-gradient(45deg, #D69E2E, #FBBF24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;">ğŸ’°</span> å½“å‰é‡‘æ¡: <span id="currentGoldAmount" style="font-weight: bold; color: #D69E2E;">${gameData.resources.gold_bar.amount}</span> æ ¹
          </div>
          <div class="shelf-items" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1.5rem;">
            ${shelfItems.map(item => {
              const resource = gameData.resources[item.id];
              return `
                <div class="shelf-item" style="background-color: #2D3748; border: 1px solid #4A5568; border-radius: 0.75rem; padding: 1.25rem; display: flex; flex-direction: column; align-items: center; text-align: center; transition: all 0.3s ease; transform: translateY(0); box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);">
                  <div class="item-image" style="width: 120px; height: 120px; margin-bottom: 0.75rem; background-color: #1A202C; border: 2px solid #4A5568; border-radius: 0.5rem; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                    <img src="${resource.image}" alt="${resource.name}" style="width: 100%; height: 100%; object-fit: contain; padding: 8px;">
                  </div>
                  <div class="item-name" style="font-weight: 700; margin-bottom: 0.5rem; color: #EDF2F7; font-size: 1.1rem;">${resource.name}</div>
                  <div class="item-description" style="font-size: 0.875rem; color: #A0AEC0; margin-bottom: 0.75rem; line-height: 1.4; min-height: 40px;">${resource.description}</div>
                  <div class="item-price" style="font-weight: 700; color: #FBBF24; margin-bottom: 1rem; font-size: 1.1rem; display: flex; align-items: center; gap: 4px;">
                    <span>ğŸ’°</span> ä»·æ ¼: ${item.price} é‡‘æ¡
                  </div>
                  <button class="buy-button" data-item="${item.id}" data-price="${item.price}" ${item.special && resource.amount > 0 ? 'disabled' : ''} style="background-color: ${item.special && resource.amount > 0 ? '#4A5568' : '#805AD5'}; color: white; border: none; border-radius: 0.5rem; padding: 0.625rem 1.25rem; font-size: 0.875rem; font-weight: 600; cursor: ${item.special && resource.amount > 0 ? 'not-allowed' : 'pointer'}; transition: all 0.3s ease; width: 100%;">
                    ${item.special && resource.amount > 0 ? 'å·²è´­ä¹°' : 'è´­ä¹°'}
                  </button>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
      
      // æ·»åŠ åˆ°æ–‡æ¡£
      document.body.appendChild(shelfModal);
      
      // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶å’Œæ‚¬åœæ•ˆæœ
      const closeButton = document.getElementById('closeShelfButton');
      closeButton.addEventListener('click', function() {
        // æ·»åŠ å…³é—­åŠ¨ç”»
        shelfModal.style.opacity = '0';
        shelfModal.style.transform = 'translate(-50%, -50%) scale(0.95)';
        setTimeout(() => {
          document.body.removeChild(shelfModal);
        }, 200);
      });
      
      closeButton.addEventListener('mouseover', function() {
        this.style.backgroundColor = '#718096';
      });
      
      closeButton.addEventListener('mouseout', function() {
        this.style.backgroundColor = '#4A5568';
      });
      
      // æ·»åŠ å•†å“å¡ç‰‡æ‚¬åœæ•ˆæœ
      const shelfItemElements = shelfModal.querySelectorAll('.shelf-item');
      shelfItemElements.forEach(item => {
        item.addEventListener('mouseover', function() {
          this.style.transform = 'translateY(-5px)';
          this.style.boxShadow = '0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.25)';
          this.style.borderColor = '#63B3ED';
        });
        
        item.addEventListener('mouseout', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.3)';
          this.style.borderColor = '#4A5568';
        });
      });
      
      // æ·»åŠ è´­ä¹°æŒ‰é’®æ‚¬åœæ•ˆæœ
      const buyButtons = shelfModal.querySelectorAll('.buy-button:not(:disabled)');
      buyButtons.forEach(button => {
        button.addEventListener('mouseover', function() {
          this.style.backgroundColor = '#9F7AEA';
          this.style.transform = 'scale(1.05)';
        });
        
        button.addEventListener('mouseout', function() {
          this.style.backgroundColor = '#805AD5';
          this.style.transform = 'scale(1)';
        });
      });
      
      // æ·»åŠ è´­ä¹°æŒ‰é’®äº‹ä»¶
      const allBuyButtons = shelfModal.querySelectorAll('.buy-button');
      allBuyButtons.forEach(button => {
        button.addEventListener('click', function() {
          const itemId = this.getAttribute('data-item');
          const price = parseInt(this.getAttribute('data-price'));
          
          // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„é‡‘æ¡
          if (gameData.resources.gold_bar.amount >= price) {
            // æ¶ˆè€—é‡‘æ¡
            gameData.resources.gold_bar.amount -= price;
            
            // æ·»åŠ å•†å“åˆ°èƒŒåŒ…
            gameData.resources[itemId].amount += 1;
            
            // ç‰¹æ®Šå­¦ä¹ ç‰©å“å·²åœ¨å®šä¹‰ä¸­è®¾ç½®äº†cannotDropå±æ€§ï¼Œç¡®ä¿è´­ä¹°é™åˆ¶æ­£ç¡®åº”ç”¨
            // æ‰€æœ‰ç‰¹æ®Šå­¦ä¹ ç‰©å“åœ¨è´§æ¶ä¸Šåªèƒ½è´­ä¹°ä¸€æ¬¡
            
            // æ›´æ–°é‡‘æ¡æ˜¾ç¤º
            document.getElementById('currentGoldAmount').textContent = gameData.resources.gold_bar.amount;
            
            // æ›´æ–°èƒŒåŒ…UI
            renderResources();
            updateResourceCard('gold_bar');
            
            // æ˜¾ç¤ºè´­ä¹°æˆåŠŸé€šçŸ¥
            showNotification('è´­ä¹°æˆåŠŸ', `ä½ ç”¨${price}å¼ é‡‘æ¡è´­ä¹°äº†${gameData.resources[itemId].name}ï¼`);
            // æ˜¾ç¤ºæ›´é†’ç›®çš„è´­ä¹°æˆåŠŸå¼¹çª—
            showPurchaseResult('è´­ä¹°æˆåŠŸ', `ä½ ç”¨${price}å¼ é‡‘æ¡è´­ä¹°äº†${gameData.resources[itemId].name}ï¼`, true);
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯çµè¯ï¼Œå¦‚æœæ˜¯ï¼Œç¡®ä¿æœ‰durabilityå±æ€§
            if (itemId === 'medicine') {
              if (!('durability' in gameData.resources.medicine)) {
                gameData.resources.medicine.durability = 100;
              }
            }
          } else {
            // æ˜¾ç¤ºé‡‘æ¡ä¸è¶³é€šçŸ¥
            showNotification('è´­ä¹°å¤±è´¥', `ä½ æ²¡æœ‰è¶³å¤Ÿçš„é‡‘æ¡ï¼éœ€è¦${price}æ ¹ï¼Œä½ åªæœ‰${gameData.resources.gold_bar.amount}æ ¹ã€‚`);
            // æ˜¾ç¤ºæ›´é†’ç›®çš„è´­ä¹°å¤±è´¥å¼¹çª—
            showPurchaseResult('è´­ä¹°å¤±è´¥', `ä½ æ²¡æœ‰è¶³å¤Ÿçš„é‡‘æ¡ï¼éœ€è¦${price}æ ¹ï¼Œä½ åªæœ‰${gameData.resources.gold_bar.amount}æ ¹ã€‚`, false);
          }
        });
      });
      
      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      shelfModal.addEventListener('click', function(e) {
        if (e.target === shelfModal) {
          document.body.removeChild(shelfModal);
        }
      });
    }
    
    // ä»ç‰¢æˆ¿é‡Šæ”¾
    function releaseFromPrison() {
      // è·å–ç‰¢æˆ¿åœ°ç‚¹
      const prisonLocation = gameData.locations.find(loc => loc.id === 'prison');
      
      if (prisonLocation) {
        prisonLocation.currentLocation = false;
        prisonLocation.available = false;
        
        // å°†ç©å®¶é€å›è¡—è§’
        const streetLocation = gameData.locations.find(loc => loc.id === 'street');
        if (streetLocation) {
          streetLocation.currentLocation = true;
        }
        
        // å‡å°‘å£°æœ›
        gameData.status.reputation -= 20;
        
        // æ·»åŠ "å°å¿ƒä¸€ç‚¹"buffï¼ˆæŒç»­2å¤©ï¼‰
        gameData.buffs.careful = {
          active: true,
          startDay: gameData.day,
          endDay: gameData.day + 2,
          description: 'åˆ‘æ»¡é‡Šæ”¾åçŠ¶æ€ï¼Œå·çªƒæˆåŠŸç‡-20%'
        };
        
        // æ›´æ–°UI
        renderLocations();
        renderActions();
        updateGameData();
        
        // æ˜¾ç¤ºåˆ‘æ»¡é‡Šæ”¾å¼¹çª—
        showReleaseModal();
      }
    }
    
    // æ˜¾ç¤ºåˆ‘æ»¡é‡Šæ”¾å¼¹çª—
    function showReleaseModal() {
      const modal = document.createElement('div');
      modal.className = 'release-modal active';
      modal.innerHTML = `
        <div class="release-modal-content">
          <h2 class="release-modal-title">åˆ‘æ»¡é‡Šæ”¾</h2>
          <p class="release-modal-text">ä½ çš„åˆ‘æœŸå·²æ»¡ï¼Œè¢«é‡Šæ”¾å‡ºç‹±ï¼</p>
          <p class="release-modal-text">ç”±äºä½ çš„çŠ¯ç½ªè®°å½•ï¼Œå£°æœ›é™ä½äº†20ç‚¹ã€‚</p>
          <div class="release-modal-button" id="closeReleaseModal">ç»§ç»­</div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // æ·»åŠ æ ·å¼
      const style = document.createElement('style');
      style.textContent = `
        .release-modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s ease;
        }
        
        .release-modal.active {
          opacity: 1;
          pointer-events: auto;
        }
        
        .release-modal-content {
          background-color: #fff;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          max-width: 400px;
          width: 90%;
          text-align: center;
          background-image: url('https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f07095c0845f45eb8418958180ca3e77~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815101&x-signature=dENyJs1JB5ZSEtSIkWe9oq4a8us%3D');
          background-size: cover;
          background-position: center;
          color: #333;
        }
        
        .release-modal-title {
          font-size: 24px;
          margin-bottom: 10px;
          color: #8B0000;
        }
        
        .release-modal-text {
          font-size: 16px;
          margin-bottom: 15px;
          line-height: 1.5;
        }
        
        .release-modal-button {
          background-color: #8B0000;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
          margin-top: 10px;
        }
        
        .release-modal-button:hover {
          background-color: #B22222;
        }
      `;
      
      document.head.appendChild(style);
      
      // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶
      document.getElementById('closeReleaseModal').addEventListener('click', () => {
        modal.classList.remove('active');
        setTimeout(() => {
          document.body.removeChild(modal);
          document.head.removeChild(style);
        }, 300);
      });
    }
    
    // æ£€æŸ¥å¹¶ç§»é™¤è¿‡æœŸçš„buff
    function checkAndRemoveExpiredBuffs() {
      if (!gameData.buffs) return;
      
      for (const [buffId, buff] of Object.entries(gameData.buffs)) {
        if (buff.active && buff.endDay && buff.endDay <= gameData.day) {
          // ç§»é™¤è¿‡æœŸçš„buff
          buff.active = false;
          showNotification('çŠ¶æ€æ¶ˆå¤±', `${buff.description || buffId}æ•ˆæœå·²ç»“æŸã€‚`);
        }
      }
    }
    
    // ç»“æŸå›åˆï¼ˆç°åœ¨æ”¹ä¸ºæ¨è¿›æ—¶é—´ï¼‰
    function endTurn() {
      // æ£€æŸ¥è¿‡æœŸbuff
      checkAndRemoveExpiredBuffs();
      
      // éšæœºè§¦å‘äº‹ä»¶
      if (Math.random() > 0.7) {
        triggerRandomEvent();
      } else {
        advanceTime();
      }
    }

    // æ¸¸æˆç»“æŸ
    function gameOver(message, isVictory = false) {
      // æ— é™æ¨¡å¼ - æ¸¸æˆä¸ä¼šç»“æŸï¼Œåªæ˜¾ç¤ºé€šçŸ¥
      showNotification(isVictory ? 'é‡Œç¨‹ç¢‘è¾¾æˆ' : 'è­¦å‘Š', message);
    }

    // é‡ç½®æ¸¸æˆ
    function resetGame() {
      gameData.day = 1;
      gameData.timeOfDay = 'early_morning';
      gameData.timeTurns = 0;
      gameData.season = 'spring';
      gameData.resources = {
        'food': { name: 'é£Ÿç‰©', amount: 3, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f4c7301991ab401283b4e2cc2d24356a~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815097&x-signature=mIgvuq5g4eSEfvQyoQS%2FV3qaGK4%3D' },
        'money': { name: 'é’±å¸', amount: 2, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/a97938c414534765acab687a6f1d646d.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=%2B6qCylajyUoWz1DvUjy8lktowfk%3D' },
        'cloth': { name: 'ç ´å¸ƒ', amount: 5, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f7c4f2cee91e416d8ab8a628d7000d79.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=XPQph6P99%2BZwrztNHBIJcjxsOAU%3D' },
        'stick': { name: 'æœ¨æ£', amount: 4, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f29290bc8c9140ea9065db8b3133d231.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=AN6DZ0tbJLmZN7p2UCol%2FiWoXiU%3D' },
        'paper': { name: 'åºŸçº¸', amount: 3, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/2542a276bd27446f9e1a0f55d015fd4f.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=hHFsfBXhWSuvwrClyWl7ra%2F7hdE%3D' },
        'bowl': { name: 'ç ´ç¢—', amount: 1, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/149074d273dd42c0aa7b766a7864eed7.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=D4WFsJ4%2B6SrdPdxMdZqs6k8Sdtw%3D' },
        'medicine': { name: 'çµè¯', description: 'çè´µçš„è‰è¯ï¼Œèƒ½æ¢å¤å¤§é‡å¥åº·', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/b69aa2cff4e740598fbac832b4965253.png~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=ceGG%2F6lvBQ4Wg412pdZVzpZVYVM%3D', type: 'consumable' },
          'house_deed': { name: 'æˆ¿å±‹åœ°å¥‘', description: 'æ‹¥æœ‰ä¸€å¤„æˆ¿äº§çš„è¯æ˜ï¼Œæå‡å£°æœ›å’Œç²¾ç¥çŠ¶æ€', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/81afdefeb9cf4074866a9aa90480e0d2~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066061&x-signature=ZleciQAWJduJDmoMCvvxh8WAXvY%3D', durability: 100 },
          'fine_clothes': { name: 'ç²¾ç¾åæœ', description: 'é«˜æ¡£çš„ä¸ç»¸æœè£…ï¼Œå¤§å¹…æå‡å£°æœ›å’Œä¿æš–åº¦', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/499ce791f4244a349da0e5c07f411759~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066106&x-signature=z%2B8F%2FTbaRrwSGNsYYOV%2BlbvS6fg%3D', equipmentSlot: 'clothes', durability: 100 },
          'silk_shoes': { name: 'ç¼é‹', description: 'ç²¾è‡´çš„ä¸ç¼é‹å­ï¼Œæå‡å¥åº·åº¦å’Œä¿æš–åº¦', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/519a359bc40d446e96b3722912eefe22~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066159&x-signature=SJ1pIyIHM0i1yDTw7EIxobHTtcQ%3D', equipmentSlot: 'shoes', durability: 100 },
          'dog_beating_stick': { name: 'æ‰“ç‹—æ£’æ³•', description: 'ä¸å¸®é•‡å¸®ä¹‹å®ï¼Œæå‡å¥åº·åº¦å’Œå£°æœ›', amount: 0, image: 'https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/2aeab037759047558970b6bc106eede9~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066205&x-signature=BNT0ywPKQJpHRlBhgOCs9xy8e5o%3D', equipmentSlot: 'weapon', durability: 100 },
          'herbal_manual': { name: 'æœ¬è‰çº²ç›®', description: 'å¤ä»£åŒ»å­¦åè‘—ï¼Œæå‡å¥åº·åº¦å’Œç²¾ç¥çŠ¶æ€', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/bb3a2dfed0b84e9288f44ee641206c34~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066242&x-signature=ZBm9LjKtRzHuE%2BiRoEsiCMZiB3E%3D', durability: 100 },
          'huangdi_canon': { name: 'é»„å¸å†…ç»', description: 'ä¸­åŒ»ç»å…¸è‘—ä½œï¼Œå¤§å¹…æå‡å¥åº·åº¦', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/7ad31567d30840acbeee917f1438e245~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066281&x-signature=NfgvxgoCAXLkr2%2BOOn8xg2qiepc%3D', durability: 100 },
          'stealth_book': { name: 'å·å¤©æ¢æ—¥', description: 'ç›—çªƒæŠ€å·§ç§˜ç±ï¼Œæé«˜å·çªƒæˆåŠŸç‡', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/1e3f6a2c0b224112ba52173aef3cc2d8~tplv-a9rns2rl98-image.image?rcl=202511301135088D5B8BF748021234F67A&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066329&x-signature=sfh6T8o1olSVItjRzPWM1nE%2FDlE%3D', durability: 100 },
          'house_deed': { name: 'æˆ¿å±‹åœ°å¥‘', description: 'æ‹¥æœ‰è‡ªå·±çš„æˆ¿äº§ï¼Œæé«˜å£°æœ›å’Œç²¾ç¥çŠ¶æ€', amount: 0, image: 'https://p11-doubao-search-sign.byteimg.com/labis/d36b4767c04891c63b2fe5277e5aa0f7~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026189&x-signature=4W8MuoilO4yqwb10Q7r6JN9wOwo%3D', equipmentSlot: 'special' },
          'fine_clothes': { name: 'ç²¾ç¾åæœ', description: 'åä¸½çš„æœè£…ï¼Œå¤§å¹…æé«˜å£°æœ›å’Œä¿æš–åº¦', amount: 0, image: 'https://p11-doubao-search-sign.byteimg.com/ecom-shop-material/jpeg_m_a16025c6cf5fed6a5a1f389b30dee776_sx_531572_www640-640~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026149&x-signature=mpksRQoT3DGUtg%2BCWvX2ld6zvU8%3D', equipmentSlot: 'clothes' },
          'silk_shoes': { name: 'ç¼é‹', description: 'ç²¾è‡´çš„ç¼é¢é‹å­ï¼Œæé«˜å£°æœ›å’Œå¥åº·', amount: 0, image: 'https://p3-doubao-search-sign.byteimg.com/labis/fe9ac09f236960a63d6d1b98510ef90f~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026189&x-signature=PvMOwB%2FIizAA%2Fw89Jw8N8iV8bJw%3D', equipmentSlot: 'shoes' },
          'dog_beating_stick': { name: 'æ‰“ç‹—æ£’æ³•', description: 'ä¸å¸®ç»æŠ€ï¼Œæé«˜æˆ˜æ–—åŠ›å’Œå£°æœ›', amount: 0, image: 'https://p26-doubao-search-sign.byteimg.com/labis/6f890dd822f2837539fed09ff7273b07~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026239&x-signature=BiQ6x3i%2FfP1hzPJ5XEaNhivQq08%3D', equipmentSlot: 'weapon' },
          'herbal_medicine_book': { name: 'æœ¬è‰çº²ç›®', description: 'åŒ»å­¦ç»å…¸ï¼Œæé«˜å¥åº·æ¢å¤é€Ÿåº¦', amount: 0, image: 'https://p3-doubao-search-sign.byteimg.com/labis/cbf85a6536ec3a2b6490dd8adc483064~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026189&x-signature=chZXRJzKvzCNOVOhgwEcNBfwIFU%3D', equipmentSlot: 'special' },
          'huangdi_neijing': { name: 'é»„å¸å†…ç»', description: 'åŒ»å­¦ç»å…¸ï¼Œå¤§å¹…æé«˜å¥åº·ä¸Šé™', amount: 0, image: 'https://p26-doubao-search-sign.byteimg.com/ecom-shop-material/mQZXiUA_m_e50a37f3765b1af266dfa742b2d45999_sx_82512_www800-800~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026189&x-signature=2894xPwUF2h7f6lma%2BU%2FZg1XCjg%3D', equipmentSlot: 'special' },
          'stealth_book': { name: 'å·å¤©æ¢æ—¥', description: 'ç›—çªƒæŠ€å·§ï¼Œæé«˜å·çªƒæˆåŠŸç‡', amount: 0, image: 'https://p26-doubao-search-sign.byteimg.com/tos-cn-i-xv4ileqgde/1853b1f2552e4b1aa6331d345e177bd8~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1780026239&x-signature=ZCpgtxe1PhyixP6iFruNlaYpEFs%3D', equipmentSlot: 'special' },
        
        'simple_clothes': { name: 'ç ´è¡£æœ', amount: 0, image: 'https://p11-doubao-search-sign.byteimg.com/labis/05dd1661880e84d851a3eddf46e5ab2a~tplv-be4g95zd3a-image.jpeg?rk3s=542c0f93&x-expires=1779797953&x-signature=J6qsqV8dChplYTRgL3Rw5GWkqLk%3D', equipmentSlot: 'clothes' },
        'flint': { name: 'ç‡§çŸ³', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/95aa9c2aec5b4178b8791a733761ba97.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=ru5fDrQxjdJ38AnnhJOJ3Qvq8p0%3D' },
        'mud': { name: 'æ³¥å·´', amount: 0, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/ea48fcaba9d94fb19938e8c03b0303f6.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=jcdtFDBSfpM4iZLNxXecYJeZF7U%3D' },
        'fire': { name: 'ç¯ç«', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/0b4a538181e345018d8f0c9b9068804e.png~tplv-a9rns2rl98-24:720:720.png?rcl=202511300854180D9F280600AFF2D54ED4&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765068859&x-signature=nFSyyffwTdx8eSALNVNOiu5%2B%2Bo4%3D', durability: 100 },
        'clay_bowl': { name: 'æ³¥ç¢—', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f8c6ad6c7611425eaf5803896468ae1f.png~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=soUOX%2BDUuS2OunIbRA%2F2d5a6Hoo%3D' },
        'crutch': { name: 'æ‹æ–', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/c4897681c6f046e7a1a59a8e38a19272.png~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=Se2ISH%2BTrhYvhL7RY1%2B%2BDipIiO0%3D', equipmentSlot: 'weapon' },
        'gold_bar': { name: 'é‡‘æ¡', amount: 0, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/fa14f32de0f14a1885b67e18935e4b19.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=zS8LKz0g61epwG9LFt8%2BEvbFrgA%3D' },
        'black_cloth': { name: 'é»‘å¸ƒ', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/d8141656a7b34ec583d0218ae3e2ef3c.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=UO1Z9h8jkInoUc4twKgQguRgcHY%3D' },
        'hide': { name: 'å…½çš®', description: 'åŠ¨ç‰©çš„çš®æ¯›ï¼Œå¯ä»¥ç”¨æ¥åˆ¶ä½œä¿æš–è¡£ç‰©å’Œå®¹å™¨', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/23b2da9439cb4906bb1b7ace8614e502.png~tplv-a9rns2rl98-24:720:720.png?rcl=202511300854180D9F280600AFF2D54ED4&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765068859&x-signature=tWHQ01u7WfnhYfcqqsZYnRpFhUA%3D' },
        'thread': { name: 'çº¿å›¢', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/211cc03732aa44a8828108d38b1d61f4.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202511292132282661D8856AC003F2E823&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765027948&x-signature=n456QRjuPs7Z2p8IB%2Bqw3FBAhOI%3D' },
        'water_bag': { name: 'æ°´è¢‹', description: 'å¯ä»¥å‚¨å­˜æ°´åˆ†ï¼Œå‡å°‘å£æ¸´å¸¦æ¥çš„è´Ÿé¢å½±å“', amount: 0, image: 'https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/1672d267bd0040e5a9f2e239f987199b.png~tplv-a9rns2rl98-24:720:720.png?rcl=202511300854180D9F280600AFF2D54ED4&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765068859&x-signature=fU6RBbt6lZUl7H6Cn%2FIOpXm%2BUDI%3D', durability: 100 },
        'black_cloak': { name: 'é»‘è‰²æ–—ç¯·', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/b18019591c1648a692981aaf880a32c6~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815092&x-signature=UzZghS8vYxRjp1eeDG1KU5PfY4Y%3D', equipmentSlot: 'special' },
        'slave': { name: 'å¥´éš¶', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/f07095c0845f45eb8418958180ca3e77~tplv-a9rns2rl98-image.image?rcl=2025112713573750E6BFCA1E0AE0134FF3&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1766815101&x-signature=dENyJs1JB5ZSEtSIkWe9oq4a8us%3D' },
        'shoes': { name: 'ç ´é‹', description: 'ç ´æ—§çš„é‹å­ï¼Œæä¾›åŸºæœ¬çš„è„šéƒ¨ä¿æŠ¤', amount: 0, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/d9d29cdf47cb43e7a99a33378e91189a.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=6SuTfu1JBvlUo4IZlVIZ7M%2BghhQ%3D', equipmentSlot: 'shoes', durability: 100 },
        'cornbread': { name: 'çªçªå¤´', description: 'ç²—ç³™çš„è°·ç‰©åˆ¶å“ï¼Œèƒ½æä¾›è¾ƒå¥½çš„é¥±è…¹æ„Ÿ', amount: 0, image: 'https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/3455faf8845c4a5185508d54822b3f07.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251129205037E8610DA7543A51DB8281&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765025437&x-signature=c4Hn%2BaHveLGPL%2FZKpCkx8AzwON0%3D', type: 'consumable' },
          'land_deed': { name: 'æˆ¿å±‹åœ°å¥‘', description: 'æ‹¥æœ‰æˆ¿äº§çš„è¯æ˜ï¼Œå¯å¤§å¹…æå‡å£°æœ›', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/aa666fbdcce24f31aec0456144be38ab~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066166&x-signature=A%2BFXA7SQ4Fpeqpx82HZ5x59K%2BKM%3D' },
          'fine_clothes': { name: 'ç²¾ç¾åæœ', description: 'åä¸½çš„æœé¥°ï¼Œæå‡å£°æœ›å’Œä¿æš–åº¦', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/7b6ee860c8914308aa179f2695a7601d~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066164&x-signature=9pPgoLabRa2gxNV8kWhwCVKIOQI%3D', equipmentSlot: 'clothes', durability: 100 },
          'silk_shoes': { name: 'ç¼é‹', description: 'ç²¾è‡´çš„ç¼é¢é‹å­ï¼Œæå‡å¥åº·å’Œä¿æš–åº¦', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8114bb57cedc411eb5f0b5a9975b4c9f~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066164&x-signature=Q66eP%2BSs4LiXfBLVBINEf%2BrvXT0%3D', equipmentSlot: 'shoes', durability: 100 },
          'dog_beating_stick': { name: 'æ‰“ç‹—æ£’æ³•', description: 'ä¸å¸®é•‡å¸®ä¹‹å®ï¼Œæå‡å£°æœ›å’Œå¥åº·', amount: 0, image: 'https://p9-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/7ec1b3e80fb24aeab14441e698b74b37~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066167&x-signature=LESWV5HGStyN0kAki7i7R7pUjDA%3D', equipmentSlot: 'weapon', durability: 100 },
          'herbal_canon': { name: 'æœ¬è‰çº²ç›®', description: 'å¤ä»£åŒ»å­¦ç»å…¸ï¼Œæå‡å¥åº·å’Œç²¾ç¥', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/82b6ab38d6ef419292e938a97c35ef8c~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066164&x-signature=adRGAC8Fjj3Jdq6zvR1%2Bjuh8sBg%3D' },
          'huangdi_canon': { name: 'é»„å¸å†…ç»', description: 'ä¸­åŒ»ç»å…¸è‘—ä½œï¼Œå¤§å¹…æå‡å¥åº·å’Œç²¾ç¥', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/905aa9e0f773498f91b2be7b803d3f0e~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066167&x-signature=VLLEJ5wpQrWNkSP%2Bw6Ac3Mvcz5A%3D' },
          'day_stealing': { name: 'å·å¤©æ¢æ—¥', description: 'ç¥ç§˜çš„ç›—çªƒæŠ€å·§ç§˜ç±ï¼Œæå‡å·çªƒæˆåŠŸç‡', amount: 0, image: 'https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/007a2870a64d49e9b759720409e3f915~tplv-a9rns2rl98-image.image?rcl=2025113011361694EBD2F60C8F34FE2A69&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1767066215&x-signature=kLjMdV6hFaucqGaKyzmsD98IA5A%3D' },
      };
      gameData.status = {
        hunger: 50,
        cold: 60,
        health: 80,
        spirit: 70,
        reputation: 20
      };
      gameData.discoveredRecipes = [];
      gameData.combinationSlots = {
        1: null,
        2: null,
        3: null
      };
      gameData.stats = {
        daysSurvived: 0,
        maxReputation: 0,
        resourcesCollected: 0,
        recipesDiscovered: 0
      };
      gameData.gameOver = false;
      
      // æ¸…ç©ºç»„åˆæ§½
      updateCombinationSlots();
      
      // æ›´æ–°UI
      initGame();
    }

    // æ˜¾ç¤ºé€šçŸ¥ - å·²ç¦ç”¨
    function showNotification(title, message) {
      elements.notificationTitle.textContent = title;
      elements.notificationMessage.textContent = message;
      
      // æ˜¾ç¤ºé€šçŸ¥
      elements.notification.style.opacity = '1';
      elements.notification.style.visibility = 'visible';
      
      // 3ç§’åè‡ªåŠ¨å…³é—­
      setTimeout(() => {
        elements.notification.style.opacity = '0';
        elements.notification.style.visibility = 'hidden';
      }, 3000);
    }
    
    // æ˜¾ç¤ºå±…ä¸­çš„æ—¶é—´æµé€æç¤º
    function showTimeNotification(title, message) {
      // åˆ›å»ºå±…ä¸­é€šçŸ¥å…ƒç´ 
      const timeNotification = document.createElement('div');
      timeNotification.className = 'time-notification';
      timeNotification.innerHTML = `
        <div class="time-notification-content">
          <p class="time-notification-message">${message}</p>
        </div>
      `;
      
      document.body.appendChild(timeNotification);
      
      // æ·»åŠ æ ·å¼
      const style = document.createElement('style');
      style.textContent = `
        .time-notification {
          position: fixed;
          bottom: 0;
          left: 0;
          width: auto;
          height: auto;
          display: block;
          padding: 1rem;
          z-index: 1500;
          background-color: transparent; /* èƒŒæ™¯é€æ˜ */
        }
        
        .time-notification-content {
          background-color: transparent; /* å†…å®¹èƒŒæ™¯é€æ˜ */
          padding: 0.5rem 1rem;
          border-radius: 0.5rem;
          text-align: left; /* æ–‡æœ¬å·¦å¯¹é½ */
          max-width: 300px; /* å‡å°æœ€å¤§å®½åº¦ */
          transition: transform 0.5s ease-out, opacity 0.5s ease-out; /* æ¶ˆå¤±åŠ¨ç”» */
        }
        
        .time-notification.closing .time-notification-content {
          transform: translateY(50px); /* å‘ä¸‹ç§»åŠ¨50åƒç´  */
          opacity: 0; /* æ·¡å‡ºæ•ˆæœ */
        }
        
        .time-notification-message {
          font-size: 1.5rem; /* å¢å¤§å­—ä½“ */
          margin: 0;
          line-height: 1.6;
          color: rgba(128, 0, 128, 0.8); /* ç´«è‰²ï¼Œé€æ˜åº¦80% */
          font-weight: bold;
          text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7); /* æ·»åŠ è½»å¾®é˜´å½±å¢å¼ºå¯è¯»æ€§ */
        }
      `;
      
      document.head.appendChild(style);
      
      // 1ç§’åè‡ªåŠ¨å…³é—­
      setTimeout(() => {
        timeNotification.classList.add('closing');
        setTimeout(() => {
          document.body.removeChild(timeNotification);
          document.head.removeChild(style);
        }, 500); // æ¶ˆå¤±é€Ÿåº¦0.5ç§’
      }, 1000);
    }
    
    // æ˜¾ç¤ºè´­ä¹°ç»“æœå¼¹çª—
    function showPurchaseResult(title, message, isSuccess) {
      // åˆ›å»ºæ¨¡æ€æ¡†
      const purchaseModal = document.createElement('div');
      purchaseModal.className = 'purchase-result-modal';
      purchaseModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1500;
        animation: fadeIn 0.3s ease;
      `;
      
      // å¼¹çª—å†…å®¹
      const modalContent = document.createElement('div');
      modalContent.className = 'purchase-result-content';
      modalContent.style.cssText = `
        background-color: ${isSuccess ? '#1A202C' : '#2D3748'};
        border: 2px solid ${isSuccess ? '#38A169' : '#E53E3E'};
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease;
        background-image: linear-gradient(135deg, ${isSuccess ? '#1A202C 0%, #2D3748 100%' : '#2D3748 0%, #1A202C 100%'});
      `;
      
      // æ ‡é¢˜
      const modalTitle = document.createElement('h3');
      modalTitle.className = 'purchase-result-title';
      modalTitle.style.cssText = `
        font-size: 1.5rem;
        font-weight: 700;
        color: ${isSuccess ? '#38A169' : '#E53E3E'};
        margin-bottom: 1rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      `;
      modalTitle.textContent = title;
      
      // æ¶ˆæ¯
      const modalMessage = document.createElement('p');
      modalMessage.className = 'purchase-result-message';
      modalMessage.style.cssText = `
        font-size: 1.1rem;
        color: #EDF2F7;
        margin-bottom: 1.5rem;
        line-height: 1.6;
      `;
      modalMessage.textContent = message;
      
      // å›¾æ ‡
      const iconContainer = document.createElement('div');
      iconContainer.style.cssText = `
        font-size: 3rem;
        margin-bottom: 1rem;
      `;
      iconContainer.textContent = isSuccess ? 'âœ“' : 'âœ—';
      
      // ç¡®è®¤æŒ‰é’®
      const confirmButton = document.createElement('button');
      confirmButton.className = 'purchase-result-button';
      confirmButton.style.cssText = `
        background-color: ${isSuccess ? '#38A169' : '#E53E3E'};
        color: white;
        border: none;
        border-radius: 0.5rem;
        padding: 0.75rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      `;
      confirmButton.textContent = 'ç¡®è®¤';
      
      // æ·»åŠ æ‚¬åœæ•ˆæœ
      confirmButton.addEventListener('mouseover', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.3)';
      });
      
      confirmButton.addEventListener('mouseout', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = 'none';
      });
      
      // å…³é—­å¼¹çª—
      confirmButton.addEventListener('click', function() {
        purchaseModal.style.animation = 'fadeOut 0.3s ease';
        modalContent.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(purchaseModal);
        }, 300);
      });
      
      // æ·»åŠ ç‚¹å‡»å¤–éƒ¨å…³é—­
      purchaseModal.addEventListener('click', function(e) {
        if (e.target === purchaseModal) {
          purchaseModal.style.animation = 'fadeOut 0.3s ease';
          modalContent.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => {
            document.body.removeChild(purchaseModal);
          }, 300);
        }
      });
      
      // ç»„è£…å¼¹çª—
      modalContent.appendChild(iconContainer);
      modalContent.appendChild(modalTitle);
      modalContent.appendChild(modalMessage);
      modalContent.appendChild(confirmButton);
      purchaseModal.appendChild(modalContent);
      
      // æ·»åŠ åŠ¨ç”»æ ·å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }
        @keyframes slideIn {
          from { transform: translateY(-50px) scale(0.9); opacity: 0; }
          to { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes slideOut {
          from { transform: translateY(0) scale(1); opacity: 1; }
          to { transform: translateY(50px) scale(0.9); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(purchaseModal);
    }
    
    // æ˜¾ç¤ºäº‹ä»¶ç»“æœæç¤º
    function showEventResult(title, results) {
      // åˆ›å»ºç»“æœè¯¦æƒ…å­—ç¬¦ä¸²
      let details = '';
      
      // æ·»åŠ èµ„æºå˜åŒ–
      if (results.resources && Object.keys(results.resources).length > 0) {
        details += '<div class="event-result-section"><strong>è·å¾—ç‰©å“ï¼š</strong><ul class="event-result-list">';
        for (const [resource, amount] of Object.entries(results.resources)) {
          if (amount > 0) {
            const resourceName = gameData.resources[resource].name;
            details += `<li>+${amount} ${resourceName}</li>`;
          }
        }
        details += '</ul></div>';
      }
      
      // æ·»åŠ çŠ¶æ€å˜åŒ–
      if (results.status && Object.keys(results.status).length > 0) {
        details += '<div class="event-result-section"><strong>çŠ¶æ€å˜åŒ–ï¼š</strong><ul class="event-result-list">';
        const statusNames = {
          hunger: 'é¥¥é¥¿',
          cold: 'å¯’å†·',
          health: 'å¥åº·',
          spirit: 'ç²¾ç¥',
          reputation: 'å£°æœ›'
        };
        
        for (const [status, amount] of Object.entries(results.status)) {
          const statusName = statusNames[status] || status;
          const changeSign = amount >= 0 ? '+' : '';
          details += `<li>${statusName}: ${changeSign}${amount}%</li>`;
        }
        details += '</ul></div>';
      }
      
      // æ·»åŠ ç‰¹æ®Šæ•ˆæœ
      if (results.effects && results.effects.length > 0) {
        details += '<div class="event-result-section"><strong>ç‰¹æ®Šæ•ˆæœï¼š</strong><ul class="event-result-list">';
        for (const effect of results.effects) {
          details += `<li>${effect}</li>`;
        }
        details += '</ul></div>';
      }
      
      // åˆ›å»ºæ¨¡æ€æ¡†
      const eventResultModal = document.createElement('div');
      eventResultModal.className = 'event-result-modal';
      eventResultModal.innerHTML = `
        <div class="event-result-modal-content">
          <div class="event-result-modal-header">
            <h3 class="event-result-modal-title">${title}</h3>
            <button class="event-result-modal-close">&times;</button>
          </div>
          <div class="event-result-modal-body">
            ${details}
          </div>
        </div>
      `;
      
      document.body.appendChild(eventResultModal);
      
      // æ·»åŠ activeç±»ä»¥æ˜¾ç¤ºå¼¹çª—
      eventResultModal.classList.add('active');
      
      // æ·»åŠ å…³é—­æŒ‰é’®äº‹ä»¶
      const closeButton = eventResultModal.querySelector('.event-result-modal-close');
      closeButton.addEventListener('click', () => {
        eventResultModal.classList.add('closing');
        setTimeout(() => {
          document.body.removeChild(eventResultModal);
        }, 300);
      });
      
      // æ·»åŠ ç‚¹å‡»ä»»æ„ä½ç½®å…³é—­
      eventResultModal.addEventListener('click', (e) => {
        if (e.target === eventResultModal) {
          eventResultModal.classList.add('closing');
          setTimeout(() => {
            document.body.removeChild(eventResultModal);
          }, 300);
        }
      });
      
      // æ·»åŠ åŠ¨ç”»ç±»
      setTimeout(() => {
        eventResultModal.classList.add('active');
      }, 10);
    }

    // æ˜¾ç¤ºæˆå°±
    function showAchievement(title, description) {
      elements.achievementTitle.textContent = title;
      elements.achievementDescription.textContent = description;
      
      elements.achievementModal.classList.add('active');
      
      setTimeout(() => {
        elements.achievementModal.classList.remove('active');
      }, 7000);
    }
    
    // å‡å°‘ç‰©å“è€ä¹…åº¦
    function decreaseItemDurability() {
      const results = {
        resources: {},
        status: {},
        effects: []
      };
      
      // éå†æ‰€æœ‰èµ„æºï¼Œå‡å°‘è€ä¹…åº¦
      for (const [id, resource] of Object.entries(gameData.resources)) {
        // åªå¤„ç†æœ‰è€ä¹…åº¦å±æ€§çš„ç‰©å“
        if (resource.durability !== undefined && resource.amount > 0) {
          // æ¯å¤©å‡å°‘10ç‚¹è€ä¹…åº¦
          resource.durability -= 10;
          
          // å¦‚æœè€ä¹…åº¦é™è‡³0æˆ–ä»¥ä¸‹ï¼Œç‰©å“æŸå
          if (resource.durability <= 0) {
            // è®°å½•æŸåçš„ç‰©å“
            results.resources[id] = -resource.amount;
            
            // æ£€æŸ¥ç‰©å“æ˜¯å¦æ­£åœ¨è£…å¤‡ä¸­
            if (resource.equipped) {
              // ç§»é™¤è£…å¤‡æ•ˆæœ
              applyEquipmentEffect(id, 'unequip');
              // ç§»é™¤è£…å¤‡çŠ¶æ€
              resource.equipped = false;
              results.effects.push(`ä½ çš„${resource.name}æŸåäº†ï¼Œå·²è‡ªåŠ¨å¸ä¸‹ã€‚`);
            }
            
            // ç§»é™¤æŸåçš„ç‰©å“
            resource.amount = 0;
            resource.durability = 100; // é‡ç½®è€ä¹…åº¦ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ¶ä½œæ—¶ä½¿ç”¨
          }
        }
      }
      
      // å¦‚æœæœ‰ç‰©å“æŸåï¼Œæ˜¾ç¤ºé€šçŸ¥
      if (Object.keys(results.resources).length > 0) {
        let message = 'ç‰©å“æŸåï¼š';
        for (const [resource, amount] of Object.entries(results.resources)) {
          message += `${gameData.resources[resource].name}x${Math.abs(amount)}ï¼Œ`;
          
          // æ›´æ–°æŸåç‰©å“çš„æ˜¾ç¤º
          updateResourceCard(resource);
        }
        message = message.slice(0, -1) + 'ã€‚';
        
        showNotification('ç‰©å“æŸå', message);
        showEventResult('ç‰©å“æŸå', results);
        
        // æ›´æ–°è£…å¤‡æ 
        renderEquipmentSlots();
      }
    }
  </script>
</body>
</html>
